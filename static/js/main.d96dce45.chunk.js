(this.webpackJsonpspotifygraph=this.webpackJsonpspotifygraph||[]).push([[0],{28:function(e,t,r){},29:function(e,t,r){},46:function(e,t,r){},50:function(e,t,r){},51:function(e,t,r){},60:function(e,t,r){e.exports=r(90)},65:function(e,t,r){},81:function(e,t,r){},82:function(e,t,r){},83:function(e,t,r){},88:function(e,t,r){},89:function(e,t,r){},90:function(e,t,r){"use strict";r.r(t);var s=r(1),a=r.n(s),n=r(21),i=r.n(n),o=(r(65),r(10)),c=r(23),l=r(53),u=r(54),p=r(32),h=r.n(p),d=[],g=Object(u.createLogger)({predicate:function(e,t){return!1},collapsed:function(e,t){return!0}});d.push(l.a),d.push(g);var f=function(){return{isGraphLoadingError:!1,graphLoaded:!1,graphLoading:!1,chosenArtistLoading:!1,userLoggedIn:!1,graph:{clusters:[],clusterEdges:[],artistEdges:[],clusterSquares:[],artistDict:{}},spotifyWebApiObject:new h.a,graphLoadingRelatedArtistsProgress:0,graphLoadingMessage:"",paused:!1,isGraphFromFileLoaded:!1,nonFavouriteArtistDict:{}}},m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f(),t=arguments.length>1?arguments[1]:void 0;return t.reducer?t.reducer(e):e},v=r(25),y=r(11),b=r(3),E=r(4),S=r(6),k=r(5),O=(r(46),r(28),function(e){Object(S.a)(r,e);var t=Object(k.a)(r);function r(e){return Object(b.a)(this,r),t.call(this,e)}return Object(E.a)(r,[{key:"render",value:function(){var e=this;return a.a.createElement("div",{className:"App"},a.a.createElement("div",{className:"page-wrapper"},a.a.createElement("div",{className:"page-description-div"},a.a.createElement("h1",null,"Spotify graph"),a.a.createElement("p",null,"A project that will show you your musical taste."),a.a.createElement("p",null,"We will fetch data from your spotify account, divide them into groups and visualize these groups in form of a graph.")),a.a.createElement("button",{className:"very-big-button",onClick:function(){e.props.history.push("/login")}},"Continue to get your graph"),a.a.createElement("div",{className:"generic-description"},a.a.createElement("p",null,"Have a look at the code on: ",a.a.createElement("a",{href:"https://gitlab.com/gajdusep/spotifygraph",target:"_blank"},"GitLab")))))}}]),r}(a.a.Component)),j=Object(y.g)(Object(o.b)((function(e){return{loggedIn:e.userLoggedIn}}),{})(O)),x=function(e){Object(S.a)(r,e);var t=Object(k.a)(r);function r(e){return Object(b.a)(this,r),t.call(this,e)}return Object(E.a)(r,[{key:"spotifyLoginLink",value:function(){var e,t={client_id:"dfb05fa5c36b41d48407ad5e3773d39b",response_type:"code",redirect_uri:"https://gajdusep.github.io/spotifygraph/mygraph",scope:["streaming","user-read-email","user-read-private","user-read-playback-state","user-modify-playback-state","user-library-read","user-library-modify","user-follow-read","playlist-modify-private","playlist-read-private"].join(" "),state:"rndstringsomehash"};return"https://accounts.spotify.com/authorize?"+(e=t,Object.entries(e).map((function(e){return e.map(encodeURIComponent).join("=")})).join("&"))}},{key:"loginWithSpotify",value:function(){window.location.assign(this.spotifyLoginLink())}},{key:"render",value:function(){var e=this;return a.a.createElement("div",{className:"App"},a.a.createElement("div",{className:"page-wrapper"},a.a.createElement("div",{className:"generic-description"},a.a.createElement("div",null,"Please login with your spotify account")),a.a.createElement("button",{className:"very-big-button",onClick:function(){return e.loginWithSpotify()}},"Log in with your Spotify account")))}}]),r}(a.a.Component),w=r(59),L=r(13),A=r(43),C=r(8),N=r(12),M=r.n(N),D=r(20),T=r(9),I=r(24),R=r(35),P=function(e,t){for(var r=[],s=0;s<t.length;s++){for(var a=t[s].id,n=[],i={},o=0,c=Object.entries(t[s].artistsPositions);o<c.length;o++){var l=Object(R.a)(c[o],2),u=l[0],p=l[1];n.push(e[u]),i[u]={x:p.x,y:p.y}}n.sort((function(e,t){return t.score-e.score}));var h={id:a,genres:t[s].genres,artistsIds:n.map((function(e){return e.id})),artistsPositions:i,country:t[s].country};r.push(h)}return r},G=function(e){for(var t=[],r=0;r<e.length;r++){var s=e[r],a={};if(Object.values(s).length>0){for(var n in s){var i=s[n].x,o=s[n].y;a[n]={x:i,y:o}}t.push(a)}}return t},z=function(e){return new Promise((function(t){return setTimeout(t,e)}))},U=function(e){if(!document.cookie)return"";var t=document.cookie.split(";").map((function(e){return e.trim()})).filter((function(t){return t.startsWith(e+"=")}));return 0===t.length?"":decodeURIComponent(t[0].split("=")[1])},W=function(e){return null===e.preview_url&&console.debug(e.id,":",e.name,e),{name:e.name,id:e.id,previewLink:e.preview_url,artistsIds:e.artists.map((function(e){return e.id})),externalUrl:e.external_urls.spotify}},H=function(){var e=Object(D.a)(M.a.mark((function e(t){var r,s,a,n,i,o,c,l;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=50,s=[],n=3,i=null;case 4:o=!0,c=0;case 6:return e.prev=6,l=i?{limit:r,after:i}:{limit:r},e.next=10,t.getFollowedArtists(l);case 10:a=e.sent,e.next=19;break;case 13:return e.prev=13,e.t0=e.catch(6),e.next=17,z(e.t0.getResponseHeader["retry-after"]?1e3*parseInt(e.t0.headers["retry-after"]+1):4e3);case 17:o=!1,c+=1;case 19:if(!1===o&&c<n){e.next=6;break}case 20:Object(C.isUndefined)(a)?i=null:(s.push.apply(s,Object(I.a)(a.artists.items.map((function(e){return e.id})))),i=a.artists.cursors.after);case 21:if(i){e.next=4;break}case 22:return e.abrupt("return",s);case 23:case"end":return e.stop()}}),e,null,[[6,13]])})));return function(t){return e.apply(this,arguments)}}(),_=function(){var e=Object(D.a)(M.a.mark((function e(t,r,s,a){var n,i,o,c,l,u,p,h,d;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],i=3,o=r.length,c=0;case 4:if(!(c<o)){e.next=31;break}if(l=r[c],a(c/o),!(l in s)){e.next=11;break}n.push(s[l]),e.next=28;break;case 11:u=void 0,p=!0,h=0;case 14:return e.prev=14,e.next=17,t.getArtistRelatedArtists(l);case 17:u=e.sent,e.next=26;break;case 20:return e.prev=20,e.t0=e.catch(14),e.next=24,z(e.t0.getResponseHeader["retry-after"]?1e3*parseInt(e.t0.headers["retry-after"]+1):4e3);case 24:p=!1,h+=1;case 26:if(!1===p&&h<i){e.next=14;break}case 27:Object(C.isUndefined)(u)?n.push([]):(d=u.artists.map((function(e){return e.id})),s[l]=d,n.push(d));case 28:c++,e.next=4;break;case 31:return e.abrupt("return",n);case 32:case"end":return e.stop()}}),e,null,[[14,20]])})));return function(t,r,s,a){return e.apply(this,arguments)}}(),F=function(){var e=Object(D.a)(M.a.mark((function e(t){var r,s,a,n,i,o,c,l;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=0,s=50,a=[],i=3,o=null;case 5:c=!0,l=0;case 7:return e.prev=7,e.next=10,t.getMySavedTracks({limit:50,offset:r});case 10:n=e.sent,e.next=19;break;case 13:return e.prev=13,e.t0=e.catch(7),e.next=17,z(e.t0.getResponseHeader["retry-after"]?1e3*parseInt(e.t0.headers["retry-after"]+1):4e3);case 17:c=!1,l+=1;case 19:if(!1===c&&l<i){e.next=7;break}case 20:Object(C.isUndefined)(n)?o=null:(r+=s,a.push.apply(a,Object(I.a)(n.items.map((function(e){return e.track})))),o=n.next);case 21:if(o){e.next=5;break}case 22:return e.abrupt("return",a);case 23:case"end":return e.stop()}}),e,null,[[7,13]])})));return function(t){return e.apply(this,arguments)}}(),Y=function(e){var t=e.map((function(e){return e.artists})).reduce((function(e,t){return e.concat(t)}),[]).map((function(e){return e.id}));return Object(I.a)(new Set(t))},V=function(){var e=Object(D.a)(M.a.mark((function e(t,r){var s,a,n,i,o,c,l;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=[],a=3,n=0,i=50;case 4:o=void 0,c=!0,l=0;case 7:return e.prev=7,e.next=10,t.getArtists(r.slice(n,n+i));case 10:o=e.sent,e.next=19;break;case 13:return e.prev=13,e.t0=e.catch(7),e.next=17,z(e.t0.getResponseHeader["retry-after"]?1e3*parseInt(e.t0.headers["retry-after"]+1):4e3);case 17:c=!1,l+=1;case 19:if(!1===c&&l<a){e.next=7;break}case 20:if(!Object(C.isUndefined)(o)){e.next=24;break}throw new Error("Unable to load artists.");case 24:s.push.apply(s,Object(I.a)(o.artists)),n+=i;case 26:if(n<r.length){e.next=4;break}case 27:return e.abrupt("return",s);case 28:case"end":return e.stop()}}),e,null,[[7,13]])})));return function(t,r){return e.apply(this,arguments)}}(),X=function(e,t,r,s){if(e.length!==t.length)return console.debug("ERROR: NOT EVERY ARTIST HAS RELATED ARTISTS"),{};for(var a={},n=0;n<e.length;n++){var i=e[n],o=i.images&&i.images.length>0?i.images[i.images.length-1].url:"",c=r.has(i.id),l=i.popularity,u=c?5:0;a[i.id]={genres:i.genres,id:i.id,image:o,isFollowed:c,likedSongs:[],name:i.name,relatedArtistsIds:t[n],score:.1*l+u}}for(var p=0;p<s.length;p++)for(var h=s[p],d=0;d<h.artists.length;d++){var g=h.artists[d];g.id in a&&a[g.id].likedSongs.push({artistsIds:h.artists.map((function(e){return e.id})),externalUrl:h.external_urls.spotify,name:h.name,id:h.id,previewLink:h.preview_url})}for(var f in a){var m=a[f];a[f].score+=1*m.likedSongs.length}return a},Q=function(e){var t={};for(var r in e){var s=e[r];t[r]={id:s.id,relatedArtistsIds:s.relatedArtistsIds,genres:s.genres}}return t},B=function(){var e=Object(D.a)(M.a.mark((function e(t,r,s,a,n){var i,o,c,l,u,p,h,d,g,f,m,v,y,b,E,S,k,O,j;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",{clusters:[],clusterEdges:[],artistEdges:[],clusterSquares:[],artistDict:{}});case 2:return r.setAccessToken(t),e.next=5,F(r);case 5:return i=e.sent,s("Getting your liked songs from Spotify..."),console.debug("liked songs: ",i),o=Y(i),console.debug("liked songs artists ids: ",o),s("Getting the artists you follow from Spotify..."),e.next=13,H(r);case 13:if(c=e.sent,console.debug("followed artists ids: ",c),l=Object(I.a)(new Set(o.concat(c))),console.debug("all artists ids: ",l),!(l.length<1)){e.next=20;break}return n("Your graph is empty, we have nothing to show to you"),e.abrupt("return",{clusters:[],clusterEdges:[],artistEdges:[],clusterSquares:[],artistDict:{}});case 20:return s("Getting information about all the artists you are interested it..."),e.next=23,Promise.resolve(V(r,l));case 23:if(u=e.sent,console.debug("artists full: ",u),p="relatedArtists",h=localStorage.getItem(p),d={},null===h);else{try{d=JSON.parse(h)}catch(L){d={}}null===d&&(d={})}return s("Getting information about the related artists of all of your favourite artists... \n This might take a while :("),e.next=32,_(r,l,d,a);case 32:if(g=e.sent,localStorage.setItem(p,JSON.stringify(d)),console.debug("related artists final",g),f=X(u,g,new Set(c),i),console.debug("artist dict",f),m=U("csrftoken"),s("We have all the data we need, now computing the graph!"),v="https://spotify-graph-gajdusek.herokuapp.com/graphapp/calculategraph/",!Object(C.isUndefined)(v)){e.next=42;break}return e.abrupt("return",{clusters:[],clusterEdges:[],artistEdges:[],clusterSquares:[],artistDict:{}});case 42:return y={},e.prev=43,e.next=46,fetch(v,{method:"POST",body:JSON.stringify(Q(f)),headers:{"Content-Type":"application/json","X-CSRFToken":m}});case 46:if(!(b=e.sent).ok){e.next=53;break}return e.next=50,b.json();case 50:y=e.sent,e.next=60;break;case 53:return e.t0=Error,e.t1=b.status+".  "+b.statusText+".  ",e.next=57,b.text();case 57:throw e.t2=e.sent,e.t3=e.t1+e.t2,new e.t0(e.t3);case 60:e.next=66;break;case 62:throw e.prev=62,e.t4=e.catch(43),n(e.t4),e.t4;case 66:return console.debug(y),w=y.artistEdges,E=w.map((function(e){return{id1:e.id1,id2:e.id2,weight:e.weight}})),S=P(f,y.clusters),x=y.clusterEdges,k=x.map((function(e){return{id1:e.id1,id2:e.id2,weight:e.weight}})),O=G(y.clusterSquares),j=new Promise((function(e){return e({artistEdges:E,clusters:S,clusterEdges:k,clusterSquares:O,artistDict:f})})),e.t5=console,e.next=75,j;case 75:return e.t6=e.sent,e.t5.debug.call(e.t5,"graph from spotify fetch:",e.t6),e.abrupt("return",j);case 78:case"end":return e.stop()}var x,w}),e,null,[[43,62]])})));return function(t,r,s,a,n){return e.apply(this,arguments)}}(),J=r(55),q=r(2);var Z=q.g({x:q.e,y:q.e}),K=q.g({artistsIds:q.a(q.f),externalUrl:q.f,id:q.f,name:q.f,previewLink:q.i([q.f,q.d])}),$=(q.g({id:q.f,name:q.f}),q.g({genres:q.a(q.f),id:q.f,image:q.f,isFollowed:q.b,likedSongs:q.a(K),name:q.f,relatedArtistsIds:q.a(q.f),score:q.e})),ee=(q.g({genres:q.a(q.f),id:q.f,relatedArtistsIds:q.a(q.f)}),q.g({id:q.f,name:q.f}),q.g({id1:q.f,id2:q.f,weight:q.e})),te=q.g({id:q.f,genres:q.a(q.f),artistsIds:q.a(q.f),artistsPositions:q.c(q.f,Z),country:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"".concat(e.name," | undefined");return q.i([e,q.h],t)}(q.f)}),re=q.g({id1:q.f,id2:q.f,weight:q.e}),se=q.g({clusters:q.a(te),clusterEdges:q.a(re),artistDict:q.c(q.f,$),artistEdges:q.a(ee),clusterSquares:q.a(q.c(q.f,Z))}),ae=function(e){return{type:"SET_CHOSEN_ARTIST",payload:e,reducer:Object(T.a)((function(t){t.chosenArtist=e}))}},ne=function(e){return{type:"SET_CHOSEN_CLUSTER",payload:e,reducer:Object(T.a)((function(t){t.chosenCluster=e}))}},ie=function(e){return{type:"SET_GRAPH",payload:e,reducer:Object(T.a)((function(t){t.graph=e}))}},oe=function(){return{type:"GRAPH_LOADING",reducer:Object(T.a)((function(e){e.graphLoading=!0}))}},ce=function(e){return{type:"SET_GRAPH_LOADING_MESSAGE",reducer:Object(T.a)((function(t){t.graphLoadingMessage=e}))}},le=function(e){return{type:"SET_GRAPH_LOADING_ERROR_MESSAGE",reducer:Object(T.a)((function(t){t.graphLoadingErrorMessage=e}))}},ue=function(e){return{type:"SET_GRAPH_LOADING_MESSAGE",reducer:Object(T.a)((function(t){t.graphLoadingRelatedArtistsProgress=e}))}},pe=function(){return{type:"GRAPH_LOADING_SUCCESS",reducer:Object(T.a)((function(e){e.graphLoading=!1,e.graphLoaded=!0,e.isGraphLoadingError=!1}))}},he=function(e){return{type:"SET_CHOSEN_ARTIST_ERROR",payload:e,reducer:Object(T.a)((function(t){t.chosenArtistError=e}))}},de=function(e){return{type:"SET_CHOSEN_ARTIST_LOADING",payload:e,reducer:Object(T.a)((function(t){t.chosenArtistLoading=e}))}},ge=function(e,t){return{type:"SET_CHOSEN_ARTIST_DATA",payload:e,reducer:Object(T.a)((function(r){r.chosenArtistData=e,r.chosenArtist=t}))}},fe=function(e){return{type:"SET_PAUSED",payload:e,reducer:Object(T.a)((function(t){t.paused=e}))}},me=function(e){return{type:"GRAPH_FROM_FILE_IS_LOADED",payload:e,reducer:Object(T.a)((function(t){t.isGraphFromFileLoaded=e}))}},ve=function(e,t,r){for(var s=0;s<e.length;s++){var a=e[s];for(var n in a){var i=a[n],o=i.x*(r.width-r.clusterWidth-40),c=i.y*r.height;t[n]={x:o,y:c}}}},ye=function(e,t,r,s,a,n){1!==e&&2!==e&&3!==e&&r.length;var i=r.length,o=r[0].length;e:for(var c=0;c<t.length;c++){var l=!1,u=t[c];t:for(var p=0;p<r.length;p++)for(var h=0;h<r[p].length;h++){var d=[];1===e?d=[[[p,h]]]:2===e?d=[[[p,h],[p,h+1]],[[p,h],[p+1,h]]]:3===e&&(d=[[[p,h],[p,h+1],[p+1,h+1]],[[p,h],[p+1,h],[p+1,h+1]],[[p,h],[p,h+1],[p+1,h]],[[p+1,h+1],[p,h+1],[p+1,h]]]);for(var g=0;g<d.length;g++){var f=d[g],m=f.every((function(e){var t=Object(R.a)(e,2),s=t[0],a=t[1];return s<i&&a<o&&0!==r[s][a]})),v=Object.keys(u);if(m){for(var y=0;y<e;y++){var b=s[r[f[y][0]][f[y][1]]-1];n[v[y]]={x:b.left,y:b.top},r[f[y][0]][f[y][1]]=0}l=!0;break t}}}if(!l){for(var E=c;E<t.length;E++)a.push(t[E]);break e}}},be=function(e,t,r,s,a,n){var i=[];for(var o in e){var c=e[o];i.push({left:c.x,top:c.y,width:a.clusterWidth,height:a.clusterHeigth})}var l=Oe(a.width,n,a.clusterWidth+30,a.clusterHeigth+30,i),u=l.possibleRectanglePositions,p=l.freeRectMatrix,h=[],d=[],g=[];ye(3,s,p,u,h,e),ye(2,r,p,u,d,e),ye(1,t,p,u,g,e);for(var f=[],m=n,v=0,y=.7*a.clusterWidth,b=.7*a.clusterHeigth,E=.7*a.clusterWidth,S=0;S<h.length;S++){for(var k=h[S],O=Object.keys(k),j=Math.random(),x=[[E*Math.cos(j*Math.PI)+y+v,E*Math.sin(j*Math.PI)+b+m],[E*Math.cos((j+2/3)*Math.PI)+y+v,E*Math.sin((j+2/3)*Math.PI)+b+m],[E*Math.cos((j+4/3)*Math.PI)+y+v,E*Math.sin((j+4/3)*Math.PI)+b+m]],w=0;w<3;w++)e[O[w]]={x:x[w][0],y:x[w][1]},f.push({left:x[w][0],top:x[w][1],width:a.clusterWidth,height:a.clusterHeigth});var L=1.7*E+a.clusterWidth;(v+=L)+L>a.width&&(v=0,m+=L)}for(var A=0;A<d.length;A++){for(var C=d[A],N=Object.keys(C),M=[[v,m],[v+2*E,m]],D=0;D<2;D++)e[N[D]]={x:M[D][0],y:M[D][1]},f.push({left:M[D][0],top:M[D][1],width:a.clusterWidth,height:a.clusterHeigth});(v+=2*E+a.clusterWidth)>a.width-a.clusterWidth&&(v=0,m+=a.clusterHeigth+20)}m=n;for(var T=0;T<g.length;T++){for(var I=g[T],R=Object.keys(I)[0],P={top:m,left:v,width:a.clusterWidth,height:a.clusterHeigth};ke(P,f);)P.left+=a.clusterWidth,P.left+a.clusterWidth>a.width&&(P.left=0,P.top+=a.clusterHeigth+20);e[R]={x:P.left,y:P.top},v=P.left+a.clusterWidth+20,m=P.top,v+a.clusterWidth>a.width&&(v=0,m+=a.clusterHeigth)}},Ee=function(e,t){var r=0;for(var s in e){var a=e[s];r=a.y>r?a.y:r}return r+t},Se=function(e,t,r,s){return e<s&&r<t},ke=function(e,t){return t.reduce((function(t,r){return t||(a=e,Se((s=r).left,s.left+s.width,a.left,a.left+a.width)&&Se(s.top,s.top+s.height,a.top,a.top+a.height));var s,a}),!1)},Oe=function(e,t,r,s,a){var n=[],i=Math.floor(e/r),o=Math.floor(t/s);i=0===i?1:i,o=0===o?1:o;for(var c=[],l=0,u=0;u<o;u++){n[u]=[];for(var p=0;p<i;p++){var h={top:u*s,left:p*r,width:r,height:s};ke(h,a)?n[u][p]=0:(l+=1,n[u][p]=l,c.push(h))}}return{possibleRectanglePositions:c,freeRectMatrix:n}},je=r(18),xe=(r(29),r(22)),we=r.n(xe),Le=r(34),Ae=r(56),Ce=function(e,t,r,s,a){var n,i,o,c;e>r?(i=r,o=e-r):(i=e,o=r-e),t>s?(n=s,c=t-s):(n=t,c=s-t);var l=c,u=0+a;return(t>s&&e>r||t<s&&e<r)&&(l=0+a,u=c),{x1fin:0+a,y1fin:l,x2fin:o,y2fin:u,top:n,left:i,hei:c,wid:o}},Ne=function(e){Object(S.a)(r,e);var t=Object(k.a)(r);function r(){return Object(b.a)(this,r),t.apply(this,arguments)}return Object(E.a)(r,[{key:"render",value:function(){var e=2*this.props.weigth,t=Ce(this.props.x1,this.props.y1,this.props.x2,this.props.y2,e),r=t.x1fin,s=t.y1fin,n=t.x2fin,i=t.y2fin,o=t.top,c=t.left,l=t.hei,u=t.wid,p={top:o+30,left:c+this.props.artistWidth/2},h="rgb(".concat(2,", ",250,", ",240,", ",this.props.weigth/this.props.maximumEdgeWeigth,")");return a.a.createElement("svg",{style:p,className:"position-absolute",width:u+e+20,height:l+e+20},a.a.createElement("path",{d:"M ".concat(r,",").concat(s," \n                        C ").concat(r+20,",").concat(s+20," ").concat(n+20,",").concat(i+20," ").concat(n,",").concat(i),strokeWidth:e,fill:"none",stroke:h}))}}]),r}(a.a.Component),Me={lightAzureBlue:"rgb(132, 237, 243)",darkAzureBlue:"rgb(2, 109, 104)",pink:"rgb(255, 51, 153)",green:"rgb(0, 204, 0)",grey:"rgb(191, 191, 191)"},De=(r(50),r(81),function(e){Object(S.a)(r,e);var t=Object(k.a)(r);function r(e){var s;return Object(b.a)(this,r),(s=t.call(this,e)).state={currentPositionX:e.positionX,currentPositionY:e.positionY,dragging:!1},s.onDrag=s.onDrag.bind(Object(L.a)(s)),s.onStop=s.onStop.bind(Object(L.a)(s)),s}return Object(E.a)(r,[{key:"onDrag",value:function(e,t){e.stopPropagation(),e.preventDefault(),this.setState({dragging:!0});var r=this.state.currentPositionX+t.deltaX,s=this.state.currentPositionY+t.deltaY;this.setState({currentPositionX:r,currentPositionY:s}),this.props.positionChangedCallback(r,s,this.props.artist.id)}},{key:"onStop",value:function(e){e.stopPropagation(),e.preventDefault();var t=this.state.dragging;this.setState({dragging:!1}),t||this.handleClick()}},{key:"handleClick",value:function(){if(this.props.accessToken){if(this.props.chosenArtist&&this.props.chosenArtist.id===this.props.artist.id)return;this.props.setChosenArtistDataAllFunc(this.props.artist,this.props.accessToken)}}},{key:"render",value:function(){var e=Me.lightAzureBlue;this.props.chosenArtist&&this.props.chosenArtist.id===this.props.artist.id&&(e=Me.pink);var t={backgroundImage:"url(".concat(this.props.artist.image,")"),backgroundSize:"".concat(60,"px ").concat(60,"px"),width:"".concat(60,"px"),height:"".concat(60,"px"),borderRadius:"10px",alignSelf:"center"};return this.props.artist.score<this.props.minimumScore?a.a.createElement("div",null):a.a.createElement(we.a,{key:this.props.artist.id,bounds:"parent",defaultPosition:{x:this.props.positionX,y:this.props.positionY},onDrag:this.onDrag,onStop:this.onStop},a.a.createElement("div",{className:"artist-node-outer-wrapper"},a.a.createElement("div",{style:Object(je.a)(Object(je.a)({},t),{},{backgroundColor:Me.lightAzureBlue})},a.a.createElement("div",{style:t})),a.a.createElement("div",{className:"artist-node-artist-name-div",style:{backgroundColor:e}},this.props.artist.name)))}}]),r}(a.a.Component)),Te=Object(o.b)((function(e){return{accessToken:e.accessToken,chosenArtist:e.chosenArtist}}),(function(e){return{setChosenArtistDataAllFunc:function(t,r){return e(function(e,t){return function(){var r=Object(D.a)(M.a.mark((function r(s){var a,n,i,o,c;return M.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!Object(C.isUndefined)(t)&&null!==t&&""!==t){r.next=3;break}return s(he("The token was not loaded, cannot obtain the artist data.")),r.abrupt("return");case 3:s(ae(e)),s(de(!0)),(a=new h.a).setAccessToken(t),n=[],i=[],o=[],c=function(e,t){return e.id===t.id||e.name===t.name},a.getArtistTopTracks(e.id,"CZ").then((function(t){for(var r=function(r){var s,a,l=(s=t.tracks[r],a=e.id,s.artists.reduce((function(e,t){return t.id!==a&&e.push({id:t.id,name:t.name}),e}),[]));o=o.concat(l);var u=W(t.tracks[r]),p=e.likedSongs.findIndex((function(e){return c(u,e)}));-1===p?i.push(u):(""===u.previewLink&&(u.previewLink=e.likedSongs[p].previewLink),n.push(u))},a=0;a<t.tracks.length;a++)r(a);for(var l,u=function(t){var r=e.likedSongs[t];-1===n.findIndex((function(e){return c(r,e)}))&&n.push(r)},p=0;p<e.likedSongs.length;p++)u(p);s({type:"UPDATE_NOT_FAVOURITE_ARTISTS",payload:l=o,reducer:Object(T.a)((function(e){for(var t=e.nonFavouriteArtistDict,r=e.graph.artistDict,s=0;s<l.length;s++){var a=l[s];a.id in r||(t[a.id]=a)}e.nonFavouriteArtistDict=t}))}),s(ge({likedSongs:n,notLikedSongs:i},e))})).catch((function(e){console.debug(e),s(he("During the artist data fetching, the following error occured:"+e))})).finally((function(){s(de(!1))}));case 12:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()}(t,r))}}}))(De),Ie=(r(82),function(e){Object(S.a)(r,e);var t=Object(k.a)(r);function r(e){var s;Object(b.a)(this,r),(s=t.call(this,e)).boxRef=void 0,s.wrapperRef=void 0;var n=s.getSliderLimits(400),i=n.artistsSliderLimits,o=n.edgesSliderLimits,c=n.currSliderValue;return s.state={width:0,height:0,nodes:[],artistsPositions:{},artistSliderValue:i.minimum,edgesSliderValue:c,artistsSliderLimits:i,edgesSliderLimits:o,descriptionHover:!1,minimumEdgeWeight:.5,maximumEdges:400},s.wrapperRef=a.a.createRef(),s.boxRef=a.a.createRef(),s.positionChangedHandler=s.positionChangedHandler.bind(Object(L.a)(s)),s.changeArtistSliderValue=s.changeArtistSliderValue.bind(Object(L.a)(s)),s.changeEdgeSliderValue=s.changeEdgeSliderValue.bind(Object(L.a)(s)),s}return Object(E.a)(r,[{key:"componentDidUpdate",value:function(e,t){e.graphElements!==this.props.graphElements?this.prepareAfterGraphDataUpdate():t.artistSliderValue!==this.state.artistSliderValue&&this.prepareAfterSliderUpdate()}},{key:"componentDidMount",value:function(){this.prepareAfterGraphDataUpdate()}},{key:"prepareAfterGraphDataUpdate",value:function(){var e=this.getSliderLimits(this.state.maximumEdges),t=e.artistsSliderLimits,r=e.edgesSliderLimits,s=e.currSliderValue;this.setState({artistsSliderLimits:t,edgesSliderLimits:r,artistSliderValue:t.minimum,edgesSliderValue:s});var a=this.boxRef.current.clientWidth,n=this.boxRef.current.clientHeight;this.setState({width:a,height:n});var i=this.createNodes(a,n);this.setState({nodes:i.nodes,artistsPositions:i.positions})}},{key:"prepareAfterSliderUpdate",value:function(){for(var e=[],t=0;t<this.props.graphElements.nodes.length;t++){var r=this.props.graphElements.nodes[t];e.push(a.a.createElement(Te,{key:r.artist.id,positionChangedCallback:this.positionChangedHandler,positionX:this.state.artistsPositions[r.artist.id].x,positionY:this.state.artistsPositions[r.artist.id].y,artist:r.artist,minimumScore:this.state.artistSliderValue}))}this.setState({nodes:e})}},{key:"createNodes",value:function(e,t){for(var r=[],s={},n=0;n<this.props.graphElements.nodes.length;n++){var i=this.props.graphElements.nodes[n],o=i.position.x*(e-100-30)+15,c=i.position.y*(t-100-30)+15;s[i.artist.id]={x:o,y:c},r.push(a.a.createElement(Te,{key:i.artist.id,positionChangedCallback:this.positionChangedHandler,positionX:o,positionY:c,artist:i.artist,minimumScore:this.state.artistSliderValue}))}return{nodes:r,positions:s}}},{key:"getSliderLimits",value:function(e){for(var t={minimum:1e3,maximum:-1e3},r={minimum:1e3,maximum:-1e3},s=0;s<this.props.graphElements.nodes.length;s++){var a=this.props.graphElements.nodes[s].artist.score;t.maximum=a>t.maximum?a:t.maximum,t.minimum=a<t.minimum?a:t.minimum}var n=this.props.graphElements.edges.map((function(e){return e.weigth})).sort((function(e,t){return e-t}));r.minimum=n[0],r.maximum=n[n.length-1],t.maximum=Math.ceil(t.maximum),t.minimum=Math.ceil(t.minimum)-1,r.maximum=Math.ceil(r.maximum),r.minimum=Math.ceil(r.minimum)-1;var i=n.length;return{artistsSliderLimits:t,edgesSliderLimits:r,currSliderValue:i>e?n[i-e]+.1:r.minimum}}},{key:"positionChangedHandler",value:function(e,t,r){if(null==this.state.artistsPositions)return[];var s=this.state.artistsPositions;s[r]={x:e,y:t},this.setState({artistsPositions:s})}},{key:"createEdges",value:function(){var e=[];if(null==this.state.artistsPositions)return[];try{for(var t=0;t<this.props.graphElements.edges.length;t++){var r=this.props.graphElements.edges[t],s=r.id1,n=r.id2,i=r.weigth,o=s+n,c=this.props.idArtistDict[s],l=this.props.idArtistDict[n];c!==l&&i>this.state.edgesSliderValue&&i>this.state.minimumEdgeWeight&&c.score>=this.state.artistSliderValue&&l.score>=this.state.artistSliderValue&&e.push(a.a.createElement(Ne,{key:o,x1:this.state.artistsPositions[s].x,y1:this.state.artistsPositions[s].y,x2:this.state.artistsPositions[n].x,y2:this.state.artistsPositions[n].y,weigth:r.weigth,artistWidth:70,maximumEdgeWeigth:this.state.edgesSliderLimits.maximum}))}}catch(u){e.push(a.a.createElement("div",null))}return e}},{key:"changeArtistSliderValue",value:function(e){this.setState({artistSliderValue:e.currentTarget.valueAsNumber})}},{key:"createArtistSlider",value:function(){var e=this.state.artistsSliderLimits.minimum,t=this.state.artistsSliderLimits.maximum;return a.a.createElement("div",{className:"inner-slider-wrapper"},a.a.createElement("input",{type:"range",min:e,max:t,step:(t-e)/10,value:this.state.artistSliderValue,onChange:this.changeArtistSliderValue,className:"slider-input"}))}},{key:"changeEdgeSliderValue",value:function(e){this.setState({edgesSliderValue:e.currentTarget.valueAsNumber})}},{key:"createEdgeSlider",value:function(){var e=Math.max(this.state.edgesSliderLimits.minimum,this.state.minimumEdgeWeight),t=this.state.edgesSliderLimits.maximum;return a.a.createElement("div",{className:"inner-slider-wrapper"},a.a.createElement("input",{type:"range",min:e,max:t,step:(t-e)/10,value:this.state.edgesSliderValue,onChange:this.changeEdgeSliderValue,className:"slider-input"}))}},{key:"changeHover",value:function(){this.setState({descriptionHover:!this.state.descriptionHover})}},{key:"getDraggableSlider",value:function(){var e=this,t=this.state.descriptionHover?{}:{display:"none"};return a.a.createElement(we.a,{handle:"strong",bounds:"parent"},a.a.createElement("div",{className:"draggable-slider-div"},a.a.createElement("div",null,a.a.createElement("div",{className:"outer-slider-wrapper"},this.createEdgeSlider(),"edges"),a.a.createElement("div",{className:"outer-slider-wrapper"},this.createArtistSlider(),"artists")),a.a.createElement(Ae.a,{onMouseEnter:function(){return e.changeHover()},onMouseLeave:function(){return e.changeHover()},size:30}),a.a.createElement("strong",null,a.a.createElement(Le.b,{size:30})),a.a.createElement("div",{className:"slider-description",style:t},a.a.createElement("p",null,"Drag the sliders to control how many edges and artists will be shown."),a.a.createElement("p",null,"The artists will be hidden in the order based on their importance to you - less important first, more important remainig."),a.a.createElement("p",null,"The importance takes into account these factors: how many their songs you like, if you follow them and popularity on Spotify."),a.a.createElement("p",null,'The score of an edge between two artists is calculated from the number of common genres and Spotify "related artists" information.'))))}},{key:"render",value:function(){return a.a.createElement("div",{className:"noselect chosen-cluster-wrapper",ref:this.wrapperRef},a.a.createElement("div",{className:"insideClusterBox",ref:this.boxRef,style:{width:this.state.width}},this.getDraggableSlider(),0!==this.state.width&&0!==this.state.nodes.length&&this.createEdges(),0!==this.state.width&&this.state.nodes))}}]),r}(a.a.Component)),Re=Object(o.b)((function(e){return{idArtistDict:e.graph.artistDict}}),{})(Ie),Pe=r(36),Ge=r(44),ze=r(57),Ue=(r(83),function(e){Object(S.a)(r,e);var t=Object(k.a)(r);function r(e){var s;Object(b.a)(this,r);var a=(s=t.call(this,e)).prepareSongs(),n=a.liked,i=a.notLiked;return s.state={chosenSongId:"",likedSongs:n,notLikedSongs:i},s}return Object(E.a)(r,[{key:"setChosenSong",value:function(e){e===this.state.chosenSongId?this.setState({chosenSongId:""}):this.setState({chosenSongId:e})}},{key:"componentDidUpdate",value:function(e,t){e.chosenArtistData!==this.props.chosenArtistData&&this.props.chosenArtistData&&this.setState({chosenSongId:"",likedSongs:this.props.chosenArtistData.likedSongs,notLikedSongs:this.props.chosenArtistData.notLikedSongs})}},{key:"prepareSongs",value:function(){if(!this.props.chosenArtistData||Object(C.isUndefined)(this.props.chosenArtist))return{liked:[],notLiked:[]};for(var e=[],t=[],r=0;r<this.props.chosenArtistData.likedSongs.length;r++){var s=this.props.chosenArtistData.likedSongs[r];this.props.chosenArtist.likedSongs&&!e.includes(s)?e.push(s):t.includes(s)||t.push(s)}return console.debug("liked:",e),console.debug("liked by artist",this.props.chosenArtist.likedSongs),console.debug("not liked:",t),{liked:e,notLiked:t}}},{key:"getSongDiv",value:function(e,t){var r=this,s=this.state.chosenSongId===e.id?{maxHeight:80}:{maxHeight:0},n=a.a.createElement(Pe.b,{size:40,onClick:function(t){t.stopPropagation(),r.props.setSongToPlay(e)}}),i=Me.lightAzureBlue;this.props.songToPlay&&this.props.songToPlay.id===e.id&&(i=Me.pink,n=this.props.paused?a.a.createElement(Pe.b,{size:40,onClick:function(e){e.stopPropagation(),r.props.setPause(!1)}}):a.a.createElement(Pe.a,{size:40,onClick:function(e){e.stopPropagation(),r.props.setPause(!0)}}));var o=Me.lightAzureBlue;return t&&(o=Me.green),(""===e.previewLink||null===e.previewLink||Object(C.isUndefined)(e.previewLink))&&(n=a.a.createElement(ze.a,{size:40,onClick:function(e){e.stopPropagation(),alert("No preview found on Spotify")}}),i=Me.grey),a.a.createElement("div",{key:e.id,className:"flex-column song-div",style:{backgroundColor:i}},a.a.createElement("div",{className:"song-preview",style:{backgroundColor:o},onClick:function(){return r.setChosenSong(e.id)}},a.a.createElement("div",{className:"pointer",style:{marginRight:"5px",display:"inline-flex",flexDirection:"column",justifyContent:"center",alignContent:"center"}},n),a.a.createElement("div",{className:"song-wrapper"},e.name)),a.a.createElement("div",{className:"song-description",style:s},a.a.createElement("div",{className:"full-song-link-div",onClick:function(){window.open(e.externalUrl)}},a.a.createElement(Ge.b,null),"Full song"),!t&&a.a.createElement("div",{className:"full-song-link-div",onClick:function(){r.props.spotifyApiObject.addToMySavedTracks([e.id]).then((function(){console.debug("TRACK SAVED");var t=r.state.likedSongs;t=t.concat(e);var s=r.state.notLikedSongs.filter((function(t){return t.id!==e.id}));r.setState({likedSongs:t,notLikedSongs:s})})).catch((function(e){console.debug("THIS ERROR DURING TRACK SAVING OCCURED:",e)}))}},a.a.createElement(Ge.a,null),"Save to liked songs")))}},{key:"getSongsDivs",value:function(e,t){if(!e)return[];for(var r=[],s=0;s<e.length;s++)r.push(this.getSongDiv(e[s],t));return r}},{key:"render",value:function(){return this.props.chosenArtistError?a.a.createElement("div",{className:"chosen-artist-bar"},a.a.createElement("h2",null,a.a.createElement("i",null,this.props.chosenArtistError))):Object(C.isUndefined)(this.props.chosenArtist)||Object(C.isUndefined)(this.props.chosenArtistData)?a.a.createElement("div",{className:"chosen-artist-bar"},a.a.createElement("h2",null,"CLICK SOME ARTIST")):this.props.chosenArtistLoading?a.a.createElement("div",{className:"chosen-artist-bar"},a.a.createElement("h2",null,"LOADING...")):a.a.createElement("div",{className:"chosen-artist-bar"},a.a.createElement("div",{className:"chosen-artist-bar-top"},a.a.createElement("h1",{style:{margin:0}},this.props.chosenArtist.name),a.a.createElement("div",{style:{backgroundImage:"url(".concat(this.props.chosenArtist.image,")"),width:70,height:70,borderRadius:"".concat(20,"%"),backgroundSize:"70px 70px",display:"inline-grid"}}),this.props.chosenArtist.isFollowed&&a.a.createElement("h2",{style:{margin:"5px 0px 0px 0px"}},"You are following this artist.")),a.a.createElement("div",{className:"chosen-artist-bar-scroll"},this.getSongsDivs(this.state.likedSongs,!0),this.getSongsDivs(this.state.notLikedSongs,!1)))}}]),r}(a.a.Component)),We=Object(o.b)((function(e){return{songToPlay:e.songToPlay,chosenArtist:e.chosenArtist,chosenArtistLoading:e.chosenArtistLoading,chosenArtistError:e.chosenArtistError,chosenArtistData:e.chosenArtistData,spotifyApiObject:e.spotifyWebApiObject,paused:e.paused}}),(function(e){return{setPause:function(t){return e(fe(t))},setSongToPlay:function(t){return e(function(e){return{type:"SET_SONG_TO_PLAY",payload:e,reducer:Object(T.a)((function(t){t.songToPlay&&t.songToPlay.id===e.id||(t.songToPlay=e,t.paused=!1)}))}}(t))}}}))(Ue),He=function(e){Object(S.a)(r,e);var t=Object(k.a)(r);function r(e){var s;return Object(b.a)(this,r),(s=t.call(this,e)).onClick=function(){s.props.closeChosenClusterGraph(),s.props.closeChosenArtist()},s.state={elements:s.getChosenClusterGraphElements(s.props.chosenCluster)},s}return Object(E.a)(r,[{key:"getChosenClusterGraphElements",value:function(e){for(var t=[],r=[],s=0;s<e.artistsIds.length;s++){var a=e.artistsIds[s],n=e.artistsPositions[a];t.push({artist:this.props.artistDict[a],position:{x:n.x,y:n.y}})}for(var i=0;i<this.props.artistEdges.length;i++){var o=this.props.artistEdges[i].id1,c=this.props.artistEdges[i].id2;e.artistsIds.includes(o)&&e.artistsIds.includes(c)&&r.push({id:o+c,id1:o,id2:c,weigth:this.props.artistEdges[i].weight})}return{nodes:t,edges:r}}},{key:"getSimilarClusters",value:function(){for(var e=this,t=this.props.chosenCluster.id,r=[],a=0;a<this.props.clusterEdges.length;a++){var n=this.props.clusterEdges[a];n.id2===n.id1||n.id1!==t&&n.id2!==t||r.push(n)}r.sort((function(e,t){return e.weight>t.weight?-1:1}));for(var i=[],o={width:"".concat(60,"px"),height:"".concat(60,"px"),backgroundSize:"".concat(60,"px ").concat(60,"px")},c=0;c<r.length;c++){var l=r[c];l.weight>2&&function(){for(var r=t===l.id1?l.id2:l.id1,a=e.props.clusters[e.props.clusters.map((function(e){return e.id})).indexOf(r)],n=[],c=0;c<Math.min(a.artistsIds.length,3);c++){var u=a.artistsIds[c],p=e.props.artistDict[u],h=Object(je.a)(Object(je.a)({},o),{},{backgroundImage:"url(".concat(p.image,")")});n.push(s.createElement("div",{className:"artistWrapper"},s.createElement("div",{title:p.name,style:h,className:"artistDiv"})))}i.push(s.createElement("div",{className:"similar-cluster-div padding-margin pointer",onClick:function(){e.props.closeChosenArtist(),e.props.setChosenCluster(a),e.setState({elements:e.getChosenClusterGraphElements(a)})}},s.createElement("p",null,"Similar to: ",a.genres[0]),s.createElement("div",{className:"artistsRow"},n)))}()}return i}},{key:"render",value:function(){var e=this.getSimilarClusters();return s.createElement("div",{className:"chosen-cluster-div"},s.createElement("div",{className:"chosen-cluster-column"},s.createElement("div",{className:"similar-cluster-row"},s.createElement("div",{className:"go-back-div padding-margin pointer",onClick:this.onClick},s.createElement(Le.a,{size:50}),s.createElement("h3",{className:"h3-no-padding"},"Go back to the graph")),e),s.createElement("div",{className:"chosen-cluster-graph-div"},s.createElement(Re,{graphElements:this.state.elements}))),s.createElement(We,null))}}]),r}(s.Component),_e=Object(o.b)((function(e){return{artistEdges:e.graph.artistEdges,clusters:e.graph.clusters,clusterEdges:e.graph.clusterEdges,artistDict:e.graph.artistDict}}),{closeChosenClusterGraph:function(){return{type:"CLOSE_CHOSEN_CLUSTER_GRAPH",reducer:Object(T.a)((function(e){e.chosenCluster=void 0}))}},closeChosenArtist:function(){return{type:"CLOSE_CHOSEN_ARTIST",reducer:Object(T.a)((function(e){e.chosenArtist=void 0}))}},setChosenCluster:ne})(He),Fe=r(58),Ye=r(84);Ye.registerLocale(r(87));var Ve=function(e){Object(S.a)(r,e);var t=Object(k.a)(r);function r(e){var s;return Object(b.a)(this,r),(s=t.call(this,e)).state={positionX:e.positionX,positionY:e.positionY,dragging:!1,fontSizeDefault:12},s.onDrag=s.onDrag.bind(Object(L.a)(s)),s.onStop=s.onStop.bind(Object(L.a)(s)),s}return Object(E.a)(r,[{key:"componentDidUpdate",value:function(e,t){e.positionX!==this.props.positionX&&this.setState({positionX:this.props.positionX})}},{key:"onDrag",value:function(e,t){e.stopPropagation(),e.preventDefault();var r=this.state.positionX,s=this.state.positionY,a=r+t.deltaX,n=s+t.deltaY;this.setState({dragging:!0,positionX:a,positionY:n}),this.props.positionChanged(a,n,this.props.cluster.id)}},{key:"onStop",value:function(e){e.stopPropagation(),e.preventDefault();var t=this.state.dragging;this.setState({dragging:!1}),t||this.handleClick(e)}},{key:"handleClick",value:function(e){this.props.setChosenCluster(this.props.cluster)}},{key:"createArtistWrapper",value:function(e,t,r){return a.a.createElement("div",{key:r,className:"artistWrapper"},a.a.createElement("div",{className:"colourWrapper"},a.a.createElement("div",{title:e,style:t,className:"artistDiv"})))}},{key:"createEmptyWrapper",value:function(e){return a.a.createElement("div",{key:e,className:"artistWrapper"},a.a.createElement("div",null))}},{key:"clusterDiv",value:function(){for(var e=this.props.clusterWidth/4.6,t={width:"".concat(e,"px"),height:"".concat(e,"px"),backgroundSize:"".concat(e,"px ").concat(e,"px")},r=[],s=this.props.cluster.artistsIds.length,n=0,i=[],o=0;o<Math.min(s,4);o++){var c=this.props.artistDict[this.props.cluster.artistsIds[o]],l=Object(je.a)(Object(je.a)({},t),{},{backgroundImage:"url(".concat(c.image,")")});i.push(this.createArtistWrapper(c.name,l,n++))}if(r.push(a.a.createElement("div",{key:1,className:"artistsRow"},i)),i=[],s>4){i.push(this.createEmptyWrapper(n++)),i.push(this.createEmptyWrapper(n++));for(var u=4;u<Math.min(6,s);u++){var p=this.props.artistDict[this.props.cluster.artistsIds[u]],h=Object(je.a)(Object(je.a)({},t),{},{backgroundImage:"url(".concat(p.image,")")});i.push(this.createArtistWrapper(p.name,h,n++))}if(s>6){var d=Object(je.a)(Object(je.a)({},t),{},{backgroundImage:"url(".concat("/spotifygraph/three-dots.png",")")});i.push(this.createArtistWrapper("AND OTHERS",d,n++))}i.push(this.createEmptyWrapper(n++)),i.push(this.createEmptyWrapper(n++)),r.push(a.a.createElement("div",{key:2,className:"artistsRow"},i))}var g="",f=this.props.cluster.genres.length;if(0===f)g="...unknown genre...";else for(var m=0;m<Math.min(f,this.props.fontSizeConst+1);m++)g+=0===m?this.props.cluster.genres[m]:", "+this.props.cluster.genres[m];var v={width:"".concat(this.props.clusterWidth,"px")};return a.a.createElement("div",{className:"nodeWrapper",style:v},this.props.cluster.country&&a.a.createElement("div",{style:{position:"absolute",margin:0,left:0,opacity:.4,zIndex:-1,alignItems:"center"}},a.a.createElement(Fe.a,{countryCode:Ye.alpha3ToAlpha2(this.props.cluster.country),svg:!0,style:{width:this.props.clusterWidth+30,height:"260px"}})),a.a.createElement("div",{className:"nodeHeader"},a.a.createElement("div",{className:"header noselect",style:{fontSize:this.state.fontSizeDefault/this.props.fontSizeConst+this.props.fontSizeConst}},g)),r)}},{key:"render",value:function(){var e=this.clusterDiv();return a.a.createElement(we.a,{onDrag:this.onDrag,onStop:this.onStop,onStart:function(e){e.stopPropagation(),e.preventDefault()},bounds:"parent",defaultPosition:{x:this.props.positionX,y:this.props.positionY},position:{x:this.state.positionX,y:this.state.positionY}},e)}}]),r}(a.a.Component),Xe=Object(o.b)((function(e){return{artistDict:e.graph.artistDict}}),{setChosenCluster:ne})(Ve),Qe=function(e){Object(S.a)(r,e);var t=Object(k.a)(r);function r(){return Object(b.a)(this,r),t.apply(this,arguments)}return Object(E.a)(r,[{key:"render",value:function(){var e=this.props.weigth,t=Ce(this.props.x1,this.props.y1,this.props.x2,this.props.y2,e),r=t.x1fin,s=t.y1fin,n=t.x2fin,i=t.y2fin,o=t.top,c=t.left,l=t.hei,u=t.wid,p={top:o+30,left:c+this.props.clusterWidth/2};return a.a.createElement("svg",{style:p,className:"position-absolute",width:u+e+20,height:l+e+20},a.a.createElement("path",{d:"M ".concat(r,",").concat(s,"\n                        C ").concat(r+20,",").concat(s+20," ").concat(n+20,",").concat(i+20," ").concat(n,",").concat(i),strokeWidth:e,fill:"none",stroke:"black"}))}}]),r}(a.a.Component),Be=function(e){Object(S.a)(r,e);var t=Object(k.a)(r);function r(e){return Object(b.a)(this,r),t.call(this,e)}return Object(E.a)(r,[{key:"render",value:function(){return a.a.createElement("div",{className:"progressbar"},a.a.createElement("div",{className:"progress",style:{width:"".concat(100*this.props.progress,"%")}}))}}]),r}(a.a.Component),Je=(r(51),function(e){Object(S.a)(r,e);var t=Object(k.a)(r);function r(e){var s;return Object(b.a)(this,r),(s=t.call(this,e)).boxRef=void 0,s.wrapperRef=void 0,s.state={clusterWidth:150,clusterHeight:150,currentScale:1,originalRefHeight:0,originalRefWidth:0},s.wrapperRef=a.a.createRef(),s.boxRef=a.a.createRef(),s.positionChangedHandler=s.positionChangedHandler.bind(Object(L.a)(s)),s}return Object(E.a)(r,[{key:"positionChangedHandler",value:function(e,t,r){if(null==this.state.clusterPositions)return[];var s=this.state.clusterPositions;s[r]={x:e,y:t},this.setState({clusterPositions:s})}},{key:"graphLoadedCallback",value:function(e,t){var r=this.state.clusterWidth,s=this.state.clusterHeight,a=t;this.props.graph.clusters.length<15?a-=s+20:this.props.graph.clusters.length>30&&(a+=s);var n=function(e,t,r,s,a){var n={};e-=15;for(var i=[],o=[],c=[],l=[],u=0;u<a.length;u++){var p=a[u],h=Object.keys(p).length;1===h?i.push(p):2===h?o.push(p):3===h?c.push(p):l.push(p)}var d={width:e,height:t,clusterWidth:r+25,clusterHeigth:s+10};ve(l,n,d);var g=Ee(n,s);return be(n,i,o,c,d,g),n}(e,a,r,s,this.props.graph.clusterSquares),i=Ee(n,s);(this.state.dimensions?this.state.dimensions:{w:500,h:1e3}).h=i,this.setState({clusterPositions:n})}},{key:"onResizeRecomputePositions",value:function(){if(!Object(C.isUndefined)(this.state.dimensions)&&!Object(C.isUndefined)(this.state.clusterPositions)){var e=this.state.dimensions.w,t=this.state.dimensions.h,r=this.wrapperRef.current.clientWidth;if(e!==r){var s=this.state.clusterPositions,a=Math.floor(r/e*1024)/1024;for(var n in s)s[n].x=a*s[n].x;this.setState({dimensions:{w:r,h:t},clusterPositions:s})}}}},{key:"componentDidMount",value:function(){var e=this;window.addEventListener("resize",(function(){e.onResizeRecomputePositions()}));var t=this.wrapperRef.current.clientWidth,r=this.wrapperRef.current.clientHeight;this.setState({dimensions:{w:t,h:r},originalRefWidth:t,originalRefHeight:r},(function(){return e.props.loadGraph(e.props.accessToken,e.props.sp,(function(){return e.graphLoadedCallback(t,r)}))}))}},{key:"componentDidUpdate",value:function(e,t){if(this.props.isGraphFromFileLoaded){var r=500,s=500;Object(C.isUndefined)(this.state.dimensions)||(r=this.state.dimensions.w,s=this.state.dimensions.h),s=this.state.originalRefHeight,this.graphLoadedCallback(r,s),this.props.graphFromFileIsLoaded(!1)}}},{key:"createNodes",value:function(){if(null===this.state.clusterPositions||Object(C.isUndefined)(this.state.clusterPositions))return[];for(var e=[],t=0;t<this.props.graph.clusters.length;t++){var r=this.props.graph.clusters[t];e.push(a.a.createElement(Xe,{key:r.id,fontSizeConst:this.state.currentScale,cluster:r,positionX:this.state.clusterPositions[r.id].x,positionY:this.state.clusterPositions[r.id].y,positionChanged:this.positionChangedHandler,clusterWidth:this.state.clusterWidth}))}return e}},{key:"createEdges",value:function(){var e=[];if(null==this.state.clusterPositions)return[];for(var t=0;t<this.props.graph.clusterEdges.length;t++){var r=this.props.graph.clusterEdges[t].id1,s=this.props.graph.clusterEdges[t].id2,n=r+s;if(r!==s){var i=3*Math.log2(this.props.graph.clusterEdges[t].weight);e.push(a.a.createElement(Qe,{key:n,x1:this.state.clusterPositions[r].x,y1:this.state.clusterPositions[r].y,x2:this.state.clusterPositions[s].x,y2:this.state.clusterPositions[s].y,weigth:i,clusterWidth:this.state.clusterWidth}))}}return e}},{key:"createGraphLoadingDiv",value:function(){return a.a.createElement("div",{className:"page-wrapper"},a.a.createElement("div",{className:"generic-description"},this.props.graphLoadingMessage),a.a.createElement(Be,{progress:this.props.graphLoadingRelatedArtistsProgress}))}},{key:"createSpotifyErrorDiv",value:function(){var e="Error while loading!\n\n";return this.props.graphLoadingErrorMessage&&(e+=this.props.graphLoadingErrorMessage),a.a.createElement("div",{className:"page-wrapper"},a.a.createElement("div",{className:"generic-description"},e))}},{key:"render",value:function(){var e=this;if(this.props.graphLoading)return this.createGraphLoadingDiv();if(this.props.isGraphLoadingError)return this.createSpotifyErrorDiv();var t=void 0!==this.props.chosenCluster,r=t?"none":"",s=this.state.dimensions?this.state.dimensions.w:500,n=this.state.dimensions?this.state.dimensions.h:500;return a.a.createElement("div",{className:"wrapper",ref:this.wrapperRef},a.a.createElement(A.b,{defaultScale:1,defaultPositionX:1,defaultPositionY:1,options:{maxScale:4,limitToWrapper:!0},onWheelStop:function(t){e.setState({currentScale:t.scale})}},(function(i){i.zoomIn,i.zoomOut,i.setTransform,Object(w.a)(i,["zoomIn","zoomOut","setTransform"]);return a.a.createElement(a.a.Fragment,null,t&&a.a.createElement(_e,{key:e.props.chosenCluster.id,chosenCluster:e.props.chosenCluster}),a.a.createElement(A.a,null,a.a.createElement("div",{className:"box",ref:e.boxRef,style:{width:s,height:n,display:r}},e.state.dimensions&&e.createEdges(),e.state.dimensions&&e.createNodes())))})))}}]),r}(a.a.Component)),qe=Object(o.b)((function(e){return{graphLoaded:e.graphLoaded,graphLoading:e.graphLoading,isGraphLoadingError:e.isGraphLoadingError,graphLoadingMessage:e.graphLoadingMessage,graphLoadingErrorMessage:e.graphLoadingErrorMessage,graphLoadingRelatedArtistsProgress:e.graphLoadingRelatedArtistsProgress,graph:e.graph,chosenCluster:e.chosenCluster,accessToken:e.accessToken,sp:e.spotifyWebApiObject,isGraphFromFileLoaded:e.isGraphFromFileLoaded}}),(function(e){return{setGraph:ie,graphFromFileIsLoaded:function(t){return e(me(t))},loadGraph:function(t,r,s){return e(function(e,t,r){return function(){var s=Object(D.a)(M.a.mark((function s(a){return M.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:a(oe()),B(e,t,(function(e){a(ce(e))}),(function(e){a(ue(e))}),(function(e){a(le(e))})).then((function(e){return a(ie(e))})).then((function(){return r()})).then((function(){return a(pe())})).catch((function(e){console.debug(e),a({type:"GRAPH_LOADING_ERROR",reducer:Object(T.a)((function(e){e.graphLoading=!1,e.isGraphLoadingError=!0}))})}));case 2:case"end":return s.stop()}}),s)})));return function(e){return s.apply(this,arguments)}}()}(t,r,s))}}}))(Je),Ze=function(e){Object(S.a)(r,e);var t=Object(k.a)(r);function r(e){var s;return Object(b.a)(this,r),(s=t.call(this,e)).playerRef=void 0,s.playerRef=a.a.createRef(),s}return Object(E.a)(r,[{key:"componentDidUpdate",value:function(){null!==this.playerRef.current&&(this.props.paused?this.playerRef.current.pause():this.playerRef.current.play())}},{key:"render",value:function(){var e=this;if(Object(C.isUndefined)(this.props.accessToken))return a.a.createElement("div",null);if(Object(C.isUndefined)(this.props.songToPlay))return a.a.createElement("div",{className:"empty-player"},a.a.createElement("div",{className:"generic-description-small-margin"},"Choose some artist and some song and listen to a preview"));for(var t,r=[],s=0;s<this.props.songToPlay.artistsIds.length;s++){var n=this.props.songToPlay.artistsIds[s];n in this.props.favouriteArtistDict?r.push(this.props.favouriteArtistDict[n].name):n in this.props.nonFavouriteArtistDict?r.push(this.props.nonFavouriteArtistDict[n].name):r.push(n)}var i=r.join(", ");return t=null==this.props.songToPlay.previewLink?"":this.props.songToPlay.previewLink,a.a.createElement("div",{className:"player"},a.a.createElement("div",{className:"flex1"},a.a.createElement("p",{className:"playingSongName"},a.a.createElement("b",null,this.props.songToPlay.name)),a.a.createElement("p",{className:"playingSongArtists"},i)),a.a.createElement("audio",{onPlay:function(){return e.props.setPaused(!1)},onPause:function(){return e.props.setPaused(!0)},ref:this.playerRef,autoPlay:!0,controls:!0,src:t,className:"playerControls"},"Your browser does not support the",a.a.createElement("code",null,"audio")," element."))}}]),r}(a.a.Component),Ke=Object(o.b)((function(e){return{paused:e.paused,accessToken:e.accessToken,songToPlay:e.songToPlay,favouriteArtistDict:e.graph.artistDict,nonFavouriteArtistDict:e.nonFavouriteArtistDict}}),{setPaused:fe})(Ze),$e=(r(88),function(e){Object(S.a)(r,e);var t=Object(k.a)(r);function r(){return Object(b.a)(this,r),t.apply(this,arguments)}return Object(E.a)(r,[{key:"render",value:function(){return s.createElement("div",{className:"mainDiv"},s.createElement("div",{className:"mainDivContent"},s.createElement(qe,null)),s.createElement(Ke,null))}}]),r}(s.Component)),et=(r(89),function(e){Object(S.a)(r,e);var t=Object(k.a)(r);function r(e){var s;return Object(b.a)(this,r),(s=t.call(this,e)).dowloadGraph=s.dowloadGraph.bind(Object(L.a)(s)),s.uploadGraph=s.uploadGraph.bind(Object(L.a)(s)),s}return Object(E.a)(r,[{key:"dowloadGraph",value:function(){if(this.props.graph){var e=document.createElement("a");e.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(JSON.stringify(this.props.graph,null,4))),e.setAttribute("download","mySpotifyGraph.json"),e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e)}}},{key:"uploadGraph",value:function(e){var t=this,r="Sorry, this file seems to be not in the correct format.\n Error:";console.log(e);var s=e[0],a=new FileReader;a.onload=function(e){if(null!==e.target&&null!==e.target.result)try{var s=e.target.result.toString();!function(e){t.props.loadGraphFromFile(e)}(Object(C.isUndefined)(s)?{}:JSON.parse(s))}catch(a){alert(r+a),console.debug("error while graph loading from file:",a)}else alert(r)},a.readAsText(s)}},{key:"createChosenClusterArtists",value:function(){var e=this;return Object(C.isUndefined)(this.props.chosenCluster)?s.createElement("div",null):s.createElement("ul",null,this.props.chosenCluster.artistsIds.map((function(t){return s.createElement("li",{className:"shift-left"},e.props.artistDict[t].name)})))}},{key:"createChosenClusterGenres",value:function(){var e=[];return void 0!==this.props.chosenCluster&&(e=this.props.chosenCluster.genres.map((function(e){return s.createElement("li",{className:"shift-left"},e)}))),s.createElement("ul",null,e)}},{key:"render",value:function(){var e=this;return s.createElement("div",{className:"sideBar"},s.createElement("div",{className:"sideBarHeader"},s.createElement("img",{width:40,height:40,className:"spotify-image",alt:"",src:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiPjxwYXRoIGQ9Ik0xOS4wOTggMTAuNjM4Yy0zLjg2OC0yLjI5Ny0xMC4yNDgtMi41MDgtMTMuOTQxLTEuMzg3LS41OTMuMTgtMS4yMi0uMTU1LTEuMzk5LS43NDgtLjE4LS41OTMuMTU0LTEuMjIuNzQ4LTEuNCA0LjIzOS0xLjI4NyAxMS4yODUtMS4wMzggMTUuNzM4IDEuNjA1LjUzMy4zMTcuNzA4IDEuMDA1LjM5MiAxLjUzOC0uMzE2LjUzMy0xLjAwNS43MDktMS41MzguMzkyem0tLjEyNiAzLjQwM2MtLjI3Mi40NC0uODQ3LjU3OC0xLjI4Ny4zMDgtMy4yMjUtMS45ODItOC4xNDItMi41NTctMTEuOTU4LTEuMzk5LS40OTQuMTUtMS4wMTctLjEyOS0xLjE2Ny0uNjIzLS4xNDktLjQ5NS4xMy0xLjAxNi42MjQtMS4xNjcgNC4zNTgtMS4zMjIgOS43NzYtLjY4MiAxMy40OCAxLjU5NS40NC4yNy41NzguODQ3LjMwOCAxLjI4NnptLTEuNDY5IDMuMjY3Yy0uMjE1LjM1NC0uNjc2LjQ2NS0xLjAyOC4yNDktMi44MTgtMS43MjItNi4zNjUtMi4xMTEtMTAuNTQyLTEuMTU3LS40MDIuMDkyLS44MDMtLjE2LS44OTUtLjU2Mi0uMDkyLS40MDMuMTU5LS44MDQuNTYyLS44OTYgNC41NzEtMS4wNDUgOC40OTItLjU5NSAxMS42NTUgMS4zMzguMzUzLjIxNS40NjQuNjc2LjI0OCAxLjAyOHptLTUuNTAzLTE3LjMwOGMtNi42MjcgMC0xMiA1LjM3My0xMiAxMiAwIDYuNjI4IDUuMzczIDEyIDEyIDEyIDYuNjI4IDAgMTItNS4zNzIgMTItMTIgMC02LjYyNy01LjM3Mi0xMi0xMi0xMnoiLz48L3N2Zz4="}),s.createElement("h1",null,"Spotify graph")),s.createElement("div",null,"Graph of your musical taste \u266c\u266b"),this.props.graphLoaded&&s.createElement("div",{className:"download-button pointer",onClick:this.dowloadGraph},"Download graph to JSON"),(this.props.graphLoaded||this.props.graphLoadingError)&&s.createElement("input",{className:"download-button",type:"file",accept:".json",onChange:function(t){null!==t.target.files&&e.uploadGraph(t.target.files)}}),s.createElement("div",{className:"sideBarContent"},this.props.chosenCluster&&s.createElement("div",{className:"box-with-margin"},s.createElement("h2",null,"mostly these genres"),this.createChosenClusterGenres()),this.props.chosenCluster&&s.createElement("div",{className:"box-with-margin"},s.createElement("h2",{className:"text-align-center"},"group of artists"),this.createChosenClusterArtists()),!this.props.chosenCluster&&this.props.graph&&s.createElement("div",{className:"box-with-margin"},s.createElement("p",null,"We took the artists from your ",s.createElement("b",null,"liked")," songs and the artists that ",s.createElement("b",null,"you follow"),"."),s.createElement("p",null,"We found ",s.createElement("b",null,Object.values(this.props.graph.artistDict).length," artist")," that you like."),s.createElement("p",null,"We divided them into clusters you're seing right now. The clusters are based on ",s.createElement("b",null,"genres")," and ",s.createElement("b",null,"preferences")," of other users of Spotify"),s.createElement("p",null,"Click the cluster and explore how the artists are connected."))))}}]),r}(s.Component)),tt=Object(o.b)((function(e){return{chosenCluster:e.chosenCluster,graph:e.graph,sp:e.spotifyWebApiObject,artistDict:e.graph.artistDict,graphLoaded:e.graphLoaded,graphLoadingError:e.isGraphLoadingError}}),{loadGraphFromFile:function(e){return function(){var t=Object(D.a)(M.a.mark((function t(r){var s,a,n;return M.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=se.decode(e),Object(J.isRight)(s)){t.next=4;break}return alert("SORRY, THE FILE IS CORRUPTED!"),t.abrupt("return");case 4:for(a=0;a<e.clusters.length;a++)n=e.clusters[a],(Object(C.isUndefined)(n.artistsIds)||0===n.artistsIds.length)&&(n.artistsIds=Object.keys(n.artistsPositions));return t.next=7,Promise.resolve(r({type:"CLEAR_CHOSEN_CLUSTER_ARTIST",reducer:Object(T.a)((function(e){e.chosenCluster=void 0,e.chosenArtist=void 0}))})).then((function(){return r(oe())})).then((function(){return r(ie(e))})).then((function(){return r(me(!0))})).then((function(){return r(pe())}));case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}})(et),rt=function(e){Object(S.a)(r,e);var t=Object(k.a)(r);function r(e){var s;return Object(b.a)(this,r),(s=t.call(this,e)).state={loggingLoading:!0,loggingFailed:!1},s.afterSpotifyLogin(),s}return Object(E.a)(r,[{key:"afterSpotifyLogin",value:function(){var e=this,t=window.location.search.substr(1),r={};if(t.split("&").forEach((function(e){var t=e.split("=");r[t[0]]=decodeURIComponent(t[1])})),"code"in r&&""!==r.code&&null!==r.code){var s=this.props.history.location.pathname;this.props.history.push({pathname:s,search:""});var a="https://spotify-graph-gajdusek.herokuapp.com/graphapp/logged_in/?code="+r.code,n="";fetch(a).then((function(t){if(200!==t.status)throw t.status;var r=t.headers.get("access-token");null!==r&&(n=r,e.props.setAccessToken(n)),e.setState({loggingLoading:!1})})).catch((function(t){console.debug(t),e.setState({loggingFailed:!0,loggingLoading:!1}),alert("Sorry, we did not manage to log you in Spotify.")}))}else this.state={loggingFailed:!0,loggingLoading:!1}}},{key:"render",value:function(){return this.state.loggingLoading?a.a.createElement("div",{className:"App"},a.a.createElement("div",{className:"page-wrapper"},a.a.createElement("div",{className:"loader"}),a.a.createElement("div",{className:"generic-description"},"Logging into Spotify"))):this.state.loggingFailed?a.a.createElement(y.a,{to:"/login"}):a.a.createElement("div",{className:"App"},a.a.createElement(tt,null),a.a.createElement($e,null))}}]),r}(a.a.Component),st=Object(y.g)(Object(o.b)((function(e){return{}}),(function(e){return{setAccessToken:function(t){return e(function(e){return{type:"SET_ACCESS_TOKEN",payload:e,reducer:Object(T.a)((function(t){t.accessToken=e,t.userLoggedIn=!0}))}}(t))}}}))(rt)),at=Object(c.d)(m,f(),Object(c.c)(c.a.apply(void 0,d))),nt=function(){return a.a.createElement(o.a,{store:at},a.a.createElement(v.a,{basename:"/spotifygraph"},a.a.createElement(y.d,null,a.a.createElement(y.b,{path:"/login",component:x}),a.a.createElement(y.b,{path:"/mygraph",component:st}),a.a.createElement(y.b,{path:"/",component:j}))))};i.a.render(a.a.createElement(nt,null),document.getElementById("root"))}},[[60,1,2]]]);
//# sourceMappingURL=main.d96dce45.chunk.js.map