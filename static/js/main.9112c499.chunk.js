(this.webpackJsonpspotifygraph=this.webpackJsonpspotifygraph||[]).push([[0],{28:function(t,e,r){},29:function(t,e,r){},43:function(t,e,r){},45:function(t,e,r){},46:function(t,e,r){},47:function(t,e,r){},56:function(t,e,r){t.exports=r(79)},61:function(t,e,r){},70:function(t,e,r){},71:function(t,e,r){},72:function(t,e,r){},73:function(t,e,r){},78:function(t,e,r){},79:function(t,e,r){"use strict";r.r(e);var s=r(1),n=r.n(s),i=r(26),a=r.n(i),o=(r(61),r(8)),c=r(24),u=r(49),l=r(50),p=r(31),h=r.n(p),d=[],g=Object(l.createLogger)({predicate:function(t,e){return!1},collapsed:function(t,e){return!0}});d.push(u.a),d.push(g);var f=function(){return{isGraphLoadingError:!1,graphLoaded:!1,graphLoading:!1,chosenArtistLoading:!1,userLoggedIn:!1,graph:{clusters:[],clusterEdges:[],artistEdges:[],clusterSquares:[],artistDict:{}},spotifyWebApiObject:new h.a,graphLoadingRelatedArtistsProgress:0,graphLoadingMessage:"",paused:!1,isGraphFromFileLoaded:!1,nonFavouriteArtistDict:{}}},m=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f(),e=arguments.length>1?arguments[1]:void 0;return e.reducer?e.reducer(t):t},v=r(21),y=r(20),b=r(2),E=r(3),O=r(5),S=r(4),j=r(6),k=(r(43),r(28),function(t){function e(t){Object(b.a)(this,e);return Object(O.a)(this,Object(S.a)(e).call(this,t))}return Object(j.a)(e,t),Object(E.a)(e,[{key:"render",value:function(){var t=this;return n.a.createElement("div",{className:"App"},n.a.createElement("div",{className:"page-wrapper"},n.a.createElement("div",{className:"page-description-div"},n.a.createElement("h1",null,"Spotify graph"),n.a.createElement("p",null,"a project that will show you your musical taste in form of a graph")),n.a.createElement("button",{className:"very-big-button",onClick:function(){t.props.history.push("/login")}},"Continue to get your graph")))}}]),e}(n.a.Component)),x=Object(y.g)(Object(o.b)((function(t){return{loggedIn:t.userLoggedIn}}),(function(t){return{}}))(k)),A=r(11),w=r.n(A),C=r(18),L=r(10),N=r(9),D=r(25),M=r(33),T=function(t,e){for(var r=[],s=0;s<e.length;s++){for(var n=e[s].id,i=[],a={},o=0,c=Object.entries(e[s].artistsPositions);o<c.length;o++){var u=c[o],l=Object(M.a)(u,2),p=l[0],h=l[1];i.push(t[p]),a[p]={x:h.x,y:h.y}}i.sort((function(t,e){return e.score-t.score}));var d={id:n,genres:e[s].genres,artistsIds:i.map((function(t){return t.id})),artistsPositions:a,country:e[s].country};r.push(d)}return r},P=function(t){for(var e=[],r=0;r<t.length;r++){var s=t[r],n={};if(Object.values(s).length>0){for(var i in s){var a=s[i].x,o=s[i].y;n[i]={x:a,y:o}}e.push(n)}}return e},I=function(t){return new Promise((function(e){return setTimeout(e,t)}))},R=function(t){if(!document.cookie)return"";var e=document.cookie.split(";").map((function(t){return t.trim()})).filter((function(e){return e.startsWith(t+"=")}));return 0===e.length?"":decodeURIComponent(e[0].split("=")[1])},U=function(t){return null===t.preview_url&&console.debug(t.id,":",t.name,t),{name:t.name,id:t.id,previewLink:t.preview_url,artistsIds:t.artists.map((function(t){return t.id})),externalUrl:t.external_urls.spotify}},z=function(){var t=Object(C.a)(w.a.mark((function t(e){var r,s,n,i,a,o,c,u;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=50,s=[],i=3,a=null;case 4:o=!0,c=0;case 6:return t.prev=6,u=a?{limit:r,after:a}:{limit:r},t.next=10,e.getFollowedArtists(u);case 10:n=t.sent,t.next=19;break;case 13:return t.prev=13,t.t0=t.catch(6),t.next=17,I(t.t0.getResponseHeader["retry-after"]?1e3*parseInt(t.t0.headers["retry-after"]+1):4e3);case 17:o=!1,c+=1;case 19:if(!1===o&&c<i){t.next=6;break}case 20:Object(N.isUndefined)(n)?a=null:(s.push.apply(s,Object(D.a)(n.artists.items.map((function(t){return t.id})))),a=n.artists.cursors.after);case 21:if(a){t.next=4;break}case 22:return t.abrupt("return",s);case 23:case"end":return t.stop()}}),t,null,[[6,13]])})));return function(e){return t.apply(this,arguments)}}(),W=function(){var t=Object(C.a)(w.a.mark((function t(e,r,s,n){var i,a,o,c,u,l,p,h,d;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=[],a=3,o=r.length,c=0;case 4:if(!(c<o)){t.next=31;break}if(u=r[c],n(c/o),!(u in s)){t.next=11;break}i.push(s[u]),t.next=28;break;case 11:l=void 0,p=!0,h=0;case 14:return t.prev=14,t.next=17,e.getArtistRelatedArtists(u);case 17:l=t.sent,t.next=26;break;case 20:return t.prev=20,t.t0=t.catch(14),t.next=24,I(t.t0.getResponseHeader["retry-after"]?1e3*parseInt(t.t0.headers["retry-after"]+1):4e3);case 24:p=!1,h+=1;case 26:if(!1===p&&h<a){t.next=14;break}case 27:Object(N.isUndefined)(l)?i.push([]):(d=l.artists.map((function(t){return t.id})),s[u]=d,i.push(d));case 28:c++,t.next=4;break;case 31:return t.abrupt("return",i);case 32:case"end":return t.stop()}}),t,null,[[14,20]])})));return function(e,r,s,n){return t.apply(this,arguments)}}(),G=function(){var t=Object(C.a)(w.a.mark((function t(e){var r,s,n,i,a,o,c,u;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=0,s=50,n=[],a=3,o=null;case 5:c=!0,u=0;case 7:return t.prev=7,t.next=10,e.getMySavedTracks({limit:50,offset:r});case 10:i=t.sent,t.next=19;break;case 13:return t.prev=13,t.t0=t.catch(7),t.next=17,I(t.t0.getResponseHeader["retry-after"]?1e3*parseInt(t.t0.headers["retry-after"]+1):4e3);case 17:c=!1,u+=1;case 19:if(!1===c&&u<a){t.next=7;break}case 20:Object(N.isUndefined)(i)?o=null:(r+=s,n.push.apply(n,Object(D.a)(i.items.map((function(t){return t.track})))),o=i.next);case 21:if(o){t.next=5;break}case 22:return t.abrupt("return",n);case 23:case"end":return t.stop()}}),t,null,[[7,13]])})));return function(e){return t.apply(this,arguments)}}(),H=function(t){var e=t.map((function(t){return t.artists})).reduce((function(t,e){return t.concat(e)}),[]).map((function(t){return t.id}));return Object(D.a)(new Set(e))},_=function(){var t=Object(C.a)(w.a.mark((function t(e,r){var s,n,i,a,o,c,u;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:s=[],n=3,i=0,a=50;case 4:o=void 0,c=!0,u=0;case 7:return t.prev=7,t.next=10,e.getArtists(r.slice(i,i+a));case 10:o=t.sent,t.next=19;break;case 13:return t.prev=13,t.t0=t.catch(7),t.next=17,I(t.t0.getResponseHeader["retry-after"]?1e3*parseInt(t.t0.headers["retry-after"]+1):4e3);case 17:c=!1,u+=1;case 19:if(!1===c&&u<n){t.next=7;break}case 20:Object(N.isUndefined)(o)||(s.push.apply(s,Object(D.a)(o.artists)),i+=a);case 21:if(i<r.length){t.next=4;break}case 22:return t.abrupt("return",s);case 23:case"end":return t.stop()}}),t,null,[[7,13]])})));return function(e,r){return t.apply(this,arguments)}}(),F=function(t,e,r,s){if(t.length!==e.length)return console.debug("ERROR: NOT EVERY ARTIST HAS RELATED ARTISTS"),{};for(var n={},i=0;i<t.length;i++){var a=t[i],o=a.images&&a.images.length>0?a.images[a.images.length-1].url:"",c=r.has(a.id),u=a.popularity,l=c?5:0;n[a.id]={genres:a.genres,id:a.id,image:o,isFollowed:c,likedSongs:[],name:a.name,relatedArtistsIds:e[i],score:.1*u+l}}for(var p=0;p<s.length;p++)for(var h=s[p],d=0;d<h.artists.length;d++){var g=h.artists[d];g.id in n&&n[g.id].likedSongs.push({artistsIds:h.artists.map((function(t){return t.id})),externalUrl:h.external_urls.spotify,name:h.name,id:h.id,previewLink:h.preview_url})}for(var f in n){var m=n[f];n[f].score+=1*m.likedSongs.length}return n},Y=function(t){var e={};for(var r in t){var s=t[r];e[r]={id:s.id,relatedArtistsIds:s.relatedArtistsIds,genres:s.genres}}return e},V=function(){var t=Object(C.a)(w.a.mark((function t(e,r,s,n,i){var a,o,c,u,l,p,h,d,g,f,m,v,y,b,E,O,S,j,k;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return",{clusters:[],clusterEdges:[],artistEdges:[],clusterSquares:[],artistDict:{}});case 2:return r.setAccessToken(e),t.next=5,G(r);case 5:return a=t.sent,n("Getting your liked songs from Spotify..."),console.debug("liked songs: ",a),o=H(a),console.debug("liked songs artists ids: ",o),n("Getting the artists you follow from Spotify..."),t.next=13,z(r);case 13:if(c=t.sent,console.debug("followed artists ids: ",c),u=Object(D.a)(new Set(o.concat(c))),console.debug("all artists ids: ",u),!(u.length<1)){t.next=19;break}return t.abrupt("return",{clusters:[],clusterEdges:[],artistEdges:[],clusterSquares:[],artistDict:{}});case 19:return n("Getting information about all the artists you are interested it..."),t.next=22,Promise.resolve(_(r,u));case 22:if(l=t.sent,console.debug("artists full: ",l),p="relatedArtists",h=localStorage.getItem(p),d={},null===h);else{try{d=JSON.parse(h)}catch(w){d={}}null===d&&(d={})}return n("Getting information about the related artists of all of your favourite artists... \n This might take a while :("),t.next=31,W(r,u,d,i);case 31:if(g=t.sent,localStorage.setItem(p,JSON.stringify(d)),console.debug("related artists final",g),f=F(l,g,new Set(c),a),console.debug("artist dict",f),m=R("csrftoken"),n("We have all the data we need, now computing the graph!"),v="https://spotify-graph-gajdusek.herokuapp.com/graphapp/calculategraph/",!Object(N.isUndefined)(v)){t.next=41;break}return t.abrupt("return",{clusters:[],clusterEdges:[],artistEdges:[],clusterSquares:[],artistDict:{}});case 41:return y={},t.prev=42,t.next=45,fetch(v,{method:"POST",body:JSON.stringify(Y(f)),headers:{"Content-Type":"application/json","X-CSRFToken":m}});case 45:if(!(b=t.sent).ok){t.next=52;break}return t.next=49,b.json();case 49:y=t.sent,t.next=58;break;case 52:return t.next=54,b.json();case 54:throw t.t0=t.sent,t.t1=b.status,t.t2=b.statusText,{json:t.t0,status:t.t1,statusText:t.t2};case 58:t.next=65;break;case 60:if(t.prev=60,t.t3=t.catch(42),!t.t3.json){t.next=65;break}return alert(t.t3.json.message),t.abrupt("return",{clusters:[],clusterEdges:[],artistEdges:[],clusterSquares:[],artistDict:{}});case 65:return s({blbostToDelete:u.join("\n")}),console.debug(y),A=y.artistEdges,E=A.map((function(t){return{id1:t.id1,id2:t.id2,weight:t.weight}})),O=T(f,y.clusters),x=y.clusterEdges,S=x.map((function(t){return{id1:t.id1,id2:t.id2,weight:t.weight}})),j=P(y.clusterSquares),k=new Promise((function(t){return t({artistEdges:E,clusters:O,clusterEdges:S,clusterSquares:j,artistDict:f})})),t.t4=console,t.next=75,k;case 75:return t.t5=t.sent,t.t4.debug.call(t.t4,"graph from spotify fetch:",t.t5),t.abrupt("return",k);case 78:case"end":return t.stop()}var x,A}),t,null,[[42,60]])})));return function(e,r,s,n,i){return t.apply(this,arguments)}}(),X=function(){return{type:"LOG_IN",reducer:Object(L.a)((function(t){t.userLoggedIn=!0}))}},Q=function(t){return{type:"SET_CHOSEN_ARTIST",payload:t,reducer:Object(L.a)((function(e){e.chosenArtist=t}))}},B=function(t){return{type:"SET_CHOSEN_CLUSTER",payload:t,reducer:Object(L.a)((function(e){e.chosenCluster=t}))}},J=function(t){return{type:"SET_GRAPH",payload:t,reducer:Object(L.a)((function(e){e.graph=t}))}},q=function(){return{type:"GRAPH_LOADING",reducer:Object(L.a)((function(t){t.graphLoading=!0}))}},Z=function(t){return{type:"SET_GRAPH_LOADING_MESSAGE",reducer:Object(L.a)((function(e){e.graphLoadingMessage=t}))}},K=function(t){return{type:"SET_GRAPH_LOADING_MESSAGE",reducer:Object(L.a)((function(e){e.graphLoadingRelatedArtistsProgress=t}))}},$=function(){return{type:"GRAPH_LOADING_SUCCESS",reducer:Object(L.a)((function(t){t.graphLoading=!1,t.graphLoaded=!0}))}},tt=function(t){return{type:"SET_CHOSEN_ARTIST_ERROR",payload:t,reducer:Object(L.a)((function(e){e.chosenArtistError=t}))}},et=function(t){return{type:"SET_CHOSEN_ARTIST_LOADING",payload:t,reducer:Object(L.a)((function(e){e.chosenArtistLoading=t}))}},rt=function(t,e){return{type:"SET_CHOSEN_ARTIST_DATA",payload:t,reducer:Object(L.a)((function(r){r.chosenArtistData=t,r.chosenArtist=e}))}},st=function(t){return{type:"SET_PAUSED",payload:t,reducer:Object(L.a)((function(e){e.paused=t}))}},nt=function(t){return{type:"GRAPH_FROM_FILE_IS_LOADED",payload:t,reducer:Object(L.a)((function(e){e.isGraphFromFileLoaded=t}))}},it=function(t){function e(t){return Object(b.a)(this,e),Object(O.a)(this,Object(S.a)(e).call(this,t))}return Object(j.a)(e,t),Object(E.a)(e,[{key:"spotifyLoginLink",value:function(){var t,e={client_id:"dfb05fa5c36b41d48407ad5e3773d39b",response_type:"code",redirect_uri:"https://gajdusep.github.io/spotifygraph/mygraph",scope:["streaming","user-read-email","user-read-private","user-read-playback-state","user-modify-playback-state","user-library-read","user-library-modify","user-follow-read","playlist-modify-private","playlist-read-private"].join(" "),state:"rndstringsomehash"};return"https://accounts.spotify.com/authorize?"+(t=e,Object.entries(t).map((function(t){return t.map(encodeURIComponent).join("=")})).join("&"))}},{key:"loginWithSpotify",value:function(){window.location.assign(this.spotifyLoginLink())}},{key:"render",value:function(){var t=this;return this.props.loggedIn?n.a.createElement(y.a,{to:"/mygraph"}):n.a.createElement("div",{className:"App"},n.a.createElement("div",{className:"page-wrapper"},n.a.createElement("div",{className:"generic-description"},n.a.createElement("div",null,"Please login with your spotify account")),n.a.createElement("button",{className:"very-big-button",onClick:function(){return t.loginWithSpotify()}},"Log in with your Spotify account")))}}]),e}(n.a.Component),at=Object(o.b)((function(t){return{loggedIn:t.userLoggedIn}}),(function(t){return{setUserLoggedIn:X}}))(it),ot=(r(70),r(52)),ct=r(12),ut=r(40),lt=function(t,e,r,s,n,i){1!==t&&2!==t&&3!==t&&r.length;var a=r.length,o=r[0].length;t:for(var c=0;c<e.length;c++){var u=!1,l=e[c];e:for(var p=0;p<r.length;p++)for(var h=0;h<r[p].length;h++){var d=[];1===t?d=[[[p,h]]]:2===t?d=[[[p,h],[p,h+1]],[[p,h],[p+1,h]]]:3===t&&(d=[[[p,h],[p,h+1],[p+1,h+1]],[[p,h],[p+1,h],[p+1,h+1]],[[p,h],[p,h+1],[p+1,h]],[[p+1,h+1],[p,h+1],[p+1,h]]]);for(var g=0;g<d.length;g++){var f=d[g],m=f.every((function(t){var e=Object(M.a)(t,2),s=e[0],n=e[1];return s<a&&n<o&&0!==r[s][n]})),v=Object.keys(l);if(m){for(var y=0;y<t;y++){var b=s[r[f[y][0]][f[y][1]]-1];i[v[y]]={x:b.left,y:b.top},r[f[y][0]][f[y][1]]=0}u=!0;break e}}}if(!u){for(var E=c;E<e.length;E++)n.push(e[E]);break t}}},pt=function(t,e,r,s,n){var i={};t-=15;for(var a=[],o=[],c=[],u=[],l=0;l<n.length;l++){var p=n[l],h=Object.keys(p).length;1===h?a.push(p):2===h?o.push(p):3===h?c.push(p):u.push(p)}var d={width:t,height:e,clusterWidth:r+25,clusterHeigth:s+10};return function(t,e,r){for(var s=0;s<t.length;s++){var n=t[s];for(var i in n){var a=n[i],o=a.x*(r.width-r.clusterWidth-40),c=a.y*r.height;e[i]={x:o,y:c}}}}(u,i,d),function(t,e,r,s,n,i){var a=[];for(var o in t){var c=t[o];a.push({left:c.x,top:c.y,width:n.clusterWidth,height:n.clusterHeigth})}var u=ft(n.width,i,n.clusterWidth+30,n.clusterHeigth+30,a),l=u.possibleRectanglePositions,p=u.freeRectMatrix,h=[],d=[],g=[];lt(3,s,p,l,h,t),lt(2,r,p,l,d,t),lt(1,e,p,l,g,t);for(var f=[],m=i,v=0,y=.7*n.clusterWidth,b=.7*n.clusterHeigth,E=.7*n.clusterWidth,O=0;O<h.length;O++){for(var S=h[O],j=Object.keys(S),k=Math.random(),x=[[E*Math.cos(k*Math.PI)+y+v,E*Math.sin(k*Math.PI)+b+m],[E*Math.cos((k+2/3)*Math.PI)+y+v,E*Math.sin((k+2/3)*Math.PI)+b+m],[E*Math.cos((k+4/3)*Math.PI)+y+v,E*Math.sin((k+4/3)*Math.PI)+b+m]],A=0;A<3;A++)t[j[A]]={x:x[A][0],y:x[A][1]},f.push({left:x[A][0],top:x[A][1],width:n.clusterWidth,height:n.clusterHeigth});var w=1.7*E+n.clusterWidth;(v+=w)+w>n.width&&(v=0,m+=w)}for(var C=0;C<d.length;C++){for(var L=d[C],N=Object.keys(L),D=[[v,m],[v+2*E,m]],M=0;M<2;M++)t[N[M]]={x:D[M][0],y:D[M][1]},f.push({left:D[M][0],top:D[M][1],width:n.clusterWidth,height:n.clusterHeigth});(v+=2*E+n.clusterWidth)>n.width-n.clusterWidth&&(v=0,m+=n.clusterHeigth+20)}m=i;for(var T=0;T<g.length;T++){for(var P=g[T],I=Object.keys(P)[0],R={top:m,left:v,width:n.clusterWidth,height:n.clusterHeigth};gt(R,f);)R.left+=n.clusterWidth,R.left+n.clusterWidth>n.width&&(R.left=0,R.top+=n.clusterHeigth+20);t[I]={x:R.left,y:R.top},v=R.left+n.clusterWidth+20,m=R.top,v+n.clusterWidth>n.width&&(v=0,m+=n.clusterHeigth)}}(i,a,o,c,d,ht(i,s)),i},ht=function(t,e){var r=0;for(var s in t){var n=t[s];r=n.y>r?n.y:r}return r+e},dt=function(t,e,r,s){return t<s&&r<e},gt=function(t,e){return e.reduce((function(e,r){return e||(n=t,dt((s=r).left,s.left+s.width,n.left,n.left+n.width)&&dt(s.top,s.top+s.height,n.top,n.top+n.height));var s,n}),!1)},ft=function(t,e,r,s,n){var i=[],a=Math.floor(t/r),o=Math.floor(e/s);a=0===a?1:a,o=0===o?1:o;for(var c=[],u=0,l=0;l<o;l++){i[l]=[];for(var p=0;p<a;p++){var h={top:l*s,left:p*r,width:r,height:s};gt(h,n)?i[l][p]=0:(u+=1,i[l][p]=u,c.push(h))}}return{possibleRectanglePositions:c,freeRectMatrix:i}},mt=r(22),vt=(r(29),r(45),function(t){function e(){return Object(b.a)(this,e),Object(O.a)(this,Object(S.a)(e).apply(this,arguments))}return Object(j.a)(e,t),Object(E.a)(e,[{key:"render",value:function(){var t,e,r,s,i=2*this.props.weigth;this.props.x1>this.props.x2?(e=this.props.x2,r=this.props.x1-this.props.x2):(e=this.props.x1,r=this.props.x2-this.props.x1),this.props.y1>this.props.y2?(t=this.props.y2,s=this.props.y1-this.props.y2):(t=this.props.y1,s=this.props.y2-this.props.y1);var a=0+i,o=s,c=r,u=0+i;(this.props.y1>this.props.y2&&this.props.x1>this.props.x2||this.props.y1<this.props.y2&&this.props.x1<this.props.x2)&&(o=0+i,u=s);var l={top:t+30,left:e+this.props.artistWidth/2},p="rgb(".concat(2,", ",250,", ",240,", ",this.props.weigth/this.props.maximumEdgeWeigth,")");return n.a.createElement("svg",{style:l,className:"svgWrapper",width:r+i+20,height:s+i+20},n.a.createElement("path",{d:"M ".concat(a,",").concat(o," C ").concat(a+20,",").concat(o+20," ").concat(c+20,",").concat(u+20," ").concat(c,",").concat(u),strokeWidth:i,fill:"none",stroke:p}))}}]),e}(n.a.Component)),yt=r(23),bt=r.n(yt),Et={lightAzureBlue:"rgb(132, 237, 243)",darkAzureBlue:"rgb(2, 109, 104)",pink:"rgb(255, 51, 153)",green:"rgb(0, 204, 0)",grey:"rgb(191, 191, 191)"};r(46),r(71);function Ot(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,s)}return r}function St(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Ot(r,!0).forEach((function(e){Object(mt.a)(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ot(r).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var jt=function(t){function e(t){var r;return Object(b.a)(this,e),(r=Object(O.a)(this,Object(S.a)(e).call(this,t))).state={currentPositionX:t.positionX,currentPositionY:t.positionY,dragging:!1},r.onDrag=r.onDrag.bind(Object(ct.a)(r)),r.onStop=r.onStop.bind(Object(ct.a)(r)),r}return Object(j.a)(e,t),Object(E.a)(e,[{key:"componentDidUpdate",value:function(){}},{key:"onDrag",value:function(t,e){t.stopPropagation(),t.preventDefault(),this.setState({dragging:!0});var r=this.state.currentPositionX+e.deltaX,s=this.state.currentPositionY+e.deltaY;this.setState({currentPositionX:r,currentPositionY:s}),this.props.positionChangedCallback(r,s,this.props.artist.id)}},{key:"onStop",value:function(t){t.stopPropagation(),t.preventDefault();var e=this.state.dragging;this.setState({dragging:!1}),e||this.handleClick()}},{key:"handleClick",value:function(){if(this.props.accessToken){if(this.props.chosenArtist&&this.props.chosenArtist.id===this.props.artist.id)return;this.props.setChosenArtistDataAllFunc(this.props.artist,this.props.accessToken)}}},{key:"render",value:function(){var t=Et.lightAzureBlue;this.props.chosenArtist&&this.props.chosenArtist.id===this.props.artist.id&&(t=Et.pink);var e={backgroundImage:"url(".concat(this.props.artist.image,")"),backgroundSize:"".concat(60,"px ").concat(60,"px"),width:"".concat(60,"px"),height:"".concat(60,"px"),borderRadius:"10px",alignSelf:"center"};return this.props.artist.score<this.props.minimumScore?n.a.createElement("div",null):n.a.createElement(bt.a,{key:this.props.artist.id,bounds:"parent",defaultPosition:{x:this.props.positionX,y:this.props.positionY},onDrag:this.onDrag,onStop:this.onStop},n.a.createElement("div",{className:"artist-node-outer-wrapper"},n.a.createElement("div",{style:St({},e,{backgroundColor:Et.lightAzureBlue})},n.a.createElement("div",{style:e})),n.a.createElement("div",{className:"artist-node-artist-name-div",style:{backgroundColor:t}},this.props.artist.name)))}}]),e}(n.a.Component),kt=Object(o.b)((function(t){return{accessToken:t.accessToken,chosenArtist:t.chosenArtist}}),(function(t){return{setChosenArtistDataAllFunc:function(e,r){return t(function(t,e){return function(){var r=Object(C.a)(w.a.mark((function r(s){var n,i,a,o,c;return w.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!Object(N.isUndefined)(e)&&null!==e&&""!==e){r.next=3;break}return s(tt("The token was not loaded, cannot obtain the artist data.")),r.abrupt("return");case 3:s(Q(t)),s(et(!0)),(n=new h.a).setAccessToken(e),i=[],a=[],o=[],c=function(t,e){return t.id===e.id||t.name===e.name},n.getArtistTopTracks(t.id,"US").then((function(e){for(var r=function(r){var s,n,u=(s=e.tracks[r],n=t.id,s.artists.reduce((function(t,e){return e.id!==n&&t.push({id:e.id,name:e.name}),t}),[]));o=o.concat(u);var l=U(e.tracks[r]),p=t.likedSongs.findIndex((function(t){return c(l,t)}));-1===p?a.push(l):(""===l.previewLink&&(l.previewLink=t.likedSongs[p].previewLink),i.push(l))},n=0;n<e.tracks.length;n++)r(n);for(var u,l=function(e){var r=t.likedSongs[e];-1===i.findIndex((function(t){return c(r,t)}))&&i.push(r)},p=0;p<t.likedSongs.length;p++)l(p);s({type:"UPDATE_NOT_FAVOURITE_ARTISTS",payload:u=o,reducer:Object(L.a)((function(t){for(var e=t.nonFavouriteArtistDict,r=t.graph.artistDict,s=0;s<u.length;s++){var n=u[s];n.id in r||(e[n.id]=n)}t.nonFavouriteArtistDict=e}))}),s(rt({likedSongs:i,notLikedSongs:a},t))})).catch((function(t){console.debug(t),s(tt("During the artist data fetching, the following error occured:"+t))})).finally((function(){s(et(!1))}));case 12:case"end":return r.stop()}}),r)})));return function(t){return r.apply(this,arguments)}}()}(e,r))}}}))(jt),xt=r(32),At=r(53),wt=(r(72),function(t){function e(t){var r;Object(b.a)(this,e),(r=Object(O.a)(this,Object(S.a)(e).call(this,t))).boxRef=void 0,r.wrapperRef=void 0;var s=r.getIdArtistDictAndSliderLimits(),i=s.idArtistDict,a=s.artistsSliderLimits,o=s.edgesSliderLimits;return r.state={width:0,height:0,nodes:[],artistsPositions:{},dragging:!1,artistSliderValue:a.minimum,edgesSliderValue:o.minimum,idArtistDict:i,artistsSliderLimits:a,edgesSliderLimits:o},r.wrapperRef=n.a.createRef(),r.boxRef=n.a.createRef(),r.positionChangedHandler=r.positionChangedHandler.bind(Object(ct.a)(r)),r.changeArtistSliderValue=r.changeArtistSliderValue.bind(Object(ct.a)(r)),r.changeEdgeSliderValue=r.changeEdgeSliderValue.bind(Object(ct.a)(r)),r}return Object(j.a)(e,t),Object(E.a)(e,[{key:"componentDidUpdate",value:function(t,e){t.graphElements!==this.props.graphElements?this.prepareAfterGraphDataUpdate():e.artistSliderValue!==this.state.artistSliderValue&&this.prepareAfterSliderUpdate()}},{key:"componentDidMount",value:function(){this.prepareAfterGraphDataUpdate()}},{key:"getIdArtistDictAndSliderLimits",value:function(){for(var t={},e={minimum:1e3,maximum:-1e3},r={minimum:1e3,maximum:-1e3},s=0;s<this.props.graphElements.nodes.length;s++){var n=this.props.graphElements.nodes[s];t[n.artist.id]=n.artist,e.maximum=n.artist.score>e.maximum?n.artist.score:e.maximum,e.minimum=n.artist.score<e.minimum?n.artist.score:e.minimum}for(var i=0;i<this.props.graphElements.edges.length;i++){var a=this.props.graphElements.edges[i];r.maximum=a.weigth>r.maximum?a.weigth:r.maximum,r.minimum=a.weigth<r.minimum?a.weigth:r.minimum}return e.maximum=Math.ceil(e.maximum),e.minimum=Math.ceil(e.minimum)-1,r.maximum=Math.ceil(r.maximum),r.minimum=Math.ceil(r.minimum)-1,{idArtistDict:t,artistsSliderLimits:e,edgesSliderLimits:r}}},{key:"prepareAfterGraphDataUpdate",value:function(){var t=this.getIdArtistDictAndSliderLimits(),e=t.idArtistDict,r=t.artistsSliderLimits,s=t.edgesSliderLimits;this.setState({artistsSliderLimits:r,edgesSliderLimits:s,artistSliderValue:r.minimum,edgesSliderValue:s.minimum,idArtistDict:e});var n=this.boxRef.current.clientWidth,i=this.boxRef.current.clientHeight;this.setState({width:n,height:i});var a=this.createNodes(n,i);this.setState({nodes:a.nodes,artistsPositions:a.positions})}},{key:"prepareAfterSliderUpdate",value:function(){for(var t=[],e=0;e<this.props.graphElements.nodes.length;e++){var r=this.props.graphElements.nodes[e];t.push(n.a.createElement(kt,{key:r.artist.id,positionChangedCallback:this.positionChangedHandler,positionX:this.state.artistsPositions[r.artist.id].x,positionY:this.state.artistsPositions[r.artist.id].y,artist:r.artist,minimumScore:this.state.artistSliderValue}))}this.setState({nodes:t})}},{key:"positionChangedHandler",value:function(t,e,r){if(null==this.state.artistsPositions)return[];var s=this.state.artistsPositions;s[r]={x:t,y:e},this.setState({artistsPositions:s})}},{key:"createNodes",value:function(t,e){for(var r=[],s={},i=0;i<this.props.graphElements.nodes.length;i++){var a=this.props.graphElements.nodes[i],o=a.position.x*(t-100-30)+15,c=a.position.y*(e-100-30)+15;s[a.artist.id]={x:o,y:c},r.push(n.a.createElement(kt,{key:a.artist.id,positionChangedCallback:this.positionChangedHandler,positionX:o,positionY:c,artist:a.artist,minimumScore:this.state.artistSliderValue}))}return{nodes:r,positions:s}}},{key:"createEdges",value:function(){var t=[];if(null==this.state.artistsPositions)return[];try{for(var e=0;e<this.props.graphElements.edges.length;e++){var r=this.props.graphElements.edges[e],s=r.id1,i=r.id2,a=r.weigth,o=s+i,c=this.state.idArtistDict[s],u=this.state.idArtistDict[i];c!==u&&a>this.state.edgesSliderValue&&c.score>=this.state.artistSliderValue&&u.score>=this.state.artistSliderValue&&t.push(n.a.createElement(vt,{key:o,x1:this.state.artistsPositions[s].x,y1:this.state.artistsPositions[s].y,x2:this.state.artistsPositions[i].x,y2:this.state.artistsPositions[i].y,weigth:r.weigth,artistWidth:70,maximumEdgeWeigth:this.state.edgesSliderLimits.maximum}))}}catch(l){t.push(n.a.createElement("div",null))}return t}},{key:"changeArtistSliderValue",value:function(t){this.setState({artistSliderValue:t.currentTarget.valueAsNumber})}},{key:"createArtistSlider",value:function(){var t=this.state.artistsSliderLimits.minimum,e=this.state.artistsSliderLimits.maximum;return n.a.createElement("div",{className:"inner-slider-wrapper"},n.a.createElement("input",{type:"range",min:t,max:e,step:(e-t)/10,value:this.state.artistSliderValue,onChange:this.changeArtistSliderValue,className:"slider-input"}))}},{key:"changeEdgeSliderValue",value:function(t){this.setState({edgesSliderValue:t.currentTarget.valueAsNumber})}},{key:"createEdgeSlider",value:function(){var t=this.state.edgesSliderLimits.minimum,e=this.state.edgesSliderLimits.maximum;return n.a.createElement("div",{className:"inner-slider-wrapper"},n.a.createElement("input",{type:"range",min:t,max:e,step:(e-t)/10,value:this.state.edgesSliderValue,onChange:this.changeEdgeSliderValue,className:"slider-input"}))}},{key:"render",value:function(){return n.a.createElement("div",{className:"noselect chosen-cluster-wrapper",ref:this.wrapperRef},n.a.createElement("div",{className:"insideClusterBox",ref:this.boxRef,style:{width:this.state.width}},n.a.createElement(bt.a,{handle:"strong",bounds:"parent"},n.a.createElement("div",{className:"draggable-slider-div"},n.a.createElement("div",null,n.a.createElement("div",{className:"outer-slider-wrapper"},this.createEdgeSlider(),"edges"),n.a.createElement("div",{className:"outer-slider-wrapper"},this.createArtistSlider(),"artists")),n.a.createElement(At.a,{size:30}),n.a.createElement("strong",null,n.a.createElement(xt.b,{size:30})))),0!==this.state.width&&0!==this.state.nodes.length&&this.createEdges(),0!==this.state.width&&this.state.nodes))}}]),e}(n.a.Component)),Ct=Object(o.b)((function(t){return{accessToken:t.accessToken,chosenArtist:t.chosenArtist}}),(function(t){return{}}))(wt),Lt=(r(73),r(34)),Nt=r(41),Dt=r(54),Mt=function(t){function e(t){var r;Object(b.a)(this,e);var s=(r=Object(O.a)(this,Object(S.a)(e).call(this,t))).prepareSongs(),n=s.liked,i=s.notLiked;return r.state={chosenSongId:"",likedSongs:n,notLikedSongs:i},r}return Object(j.a)(e,t),Object(E.a)(e,[{key:"setChosenSong",value:function(t){t===this.state.chosenSongId?this.setState({chosenSongId:""}):this.setState({chosenSongId:t})}},{key:"componentDidUpdate",value:function(t,e){t.chosenArtistData!==this.props.chosenArtistData&&this.setState({chosenSongId:"",likedSongs:this.props.chosenArtistData.likedSongs,notLikedSongs:this.props.chosenArtistData.notLikedSongs})}},{key:"prepareSongs",value:function(){if(!this.props.chosenArtistData||Object(N.isUndefined)(this.props.chosenArtist))return{liked:[],notLiked:[]};for(var t=[],e=[],r=0;r<this.props.chosenArtistData.likedSongs.length;r++){var s=this.props.chosenArtistData.likedSongs[r];this.props.chosenArtist.likedSongs&&!t.includes(s)?t.push(s):e.includes(s)||e.push(s)}return console.debug("liked:",t),console.debug("liked by artist",this.props.chosenArtist.likedSongs),console.debug("not liked:",e),{liked:t,notLiked:e}}},{key:"getSongDiv",value:function(t,e){var r=this,s=this.state.chosenSongId===t.id?{maxHeight:80}:{maxHeight:0},i=n.a.createElement(Lt.b,{size:40,onClick:function(e){e.stopPropagation(),r.props.setSongToPlay(t)}}),a=Et.lightAzureBlue;this.props.songToPlay&&this.props.songToPlay.id===t.id&&(a=Et.pink,i=this.props.paused?n.a.createElement(Lt.b,{size:40,onClick:function(t){t.stopPropagation(),r.props.setPause(!1)}}):n.a.createElement(Lt.a,{size:40,onClick:function(t){t.stopPropagation(),r.props.setPause(!0)}}));var o=Et.lightAzureBlue;return e&&(o=Et.green),(""===t.previewLink||null===t.previewLink||Object(N.isUndefined)(t.previewLink))&&(i=n.a.createElement(Dt.a,{size:40,onClick:function(t){t.stopPropagation(),alert("No preview found on Spotify")}}),a=Et.grey),n.a.createElement("div",{key:t.id,className:"flex-column song-div",style:{backgroundColor:a}},n.a.createElement("div",{className:"song-preview",style:{backgroundColor:o},onClick:function(){return r.setChosenSong(t.id)}},n.a.createElement("div",{className:"pointer",style:{marginRight:"5px",display:"inline-flex",flexDirection:"column",justifyContent:"center",alignContent:"center"}},i),n.a.createElement("div",{className:"song-wrapper"},t.name)),n.a.createElement("div",{className:"song-description",style:s},n.a.createElement("div",{className:"full-song-link-div",onClick:function(){window.open(t.externalUrl)}},n.a.createElement(Nt.b,null),"Full song"),n.a.createElement("div",{className:"full-song-link-div",onClick:function(){r.props.spotifyApiObject.addToMySavedTracks([t.id]).then((function(){console.debug("TRACK SAVED")})).catch((function(t){console.debug("THIS ERROR DURING TRACK SAVING OCCURED:",t)}))}},n.a.createElement(Nt.a,null),"Save to liked songs")))}},{key:"getSongsDivs",value:function(t,e){if(!t)return[];for(var r=[],s=0;s<t.length;s++)r.push(this.getSongDiv(t[s],e));return r}},{key:"render",value:function(){return this.props.chosenArtistError?n.a.createElement("div",{className:"chosen-artist-bar"},n.a.createElement("h2",null,n.a.createElement("i",null,this.props.chosenArtistError))):Object(N.isUndefined)(this.props.chosenArtist)||Object(N.isUndefined)(this.props.chosenArtistData)?n.a.createElement("div",{className:"chosen-artist-bar"},n.a.createElement("h2",null,"CLICK SOME ARTIST")):this.props.chosenArtistLoading?n.a.createElement("div",{className:"chosen-artist-bar"},n.a.createElement("h2",null,"LOADING...")):n.a.createElement("div",{className:"chosen-artist-bar"},n.a.createElement("h1",null,this.props.chosenArtist.name),this.props.chosenArtist.isFollowed&&n.a.createElement("h2",null,"You are following this artist.."),this.getSongsDivs(this.props.chosenArtistData.likedSongs,!0),this.getSongsDivs(this.props.chosenArtistData.notLikedSongs,!1))}}]),e}(n.a.Component),Tt=Object(o.b)((function(t){return{songToPlay:t.songToPlay,chosenArtist:t.chosenArtist,chosenArtistLoading:t.chosenArtistLoading,chosenArtistError:t.chosenArtistError,chosenArtistData:t.chosenArtistData,spotifyApiObject:t.spotifyWebApiObject,paused:t.paused}}),(function(t){return{setPause:function(e){return t(st(e))},setSongToPlay:function(e){return t(function(t){return{type:"SET_SONG_TO_PLAY",payload:t,reducer:Object(L.a)((function(e){e.songToPlay&&e.songToPlay.id===t.id||(e.songToPlay=t,e.paused=!1)}))}}(e))}}}))(Mt);function Pt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,s)}return r}function It(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Pt(r,!0).forEach((function(e){Object(mt.a)(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Pt(r).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var Rt=function(t){function e(t){var r;return Object(b.a)(this,e),(r=Object(O.a)(this,Object(S.a)(e).call(this,t))).onClick=function(){r.props.closeChosenClusterGraph(),r.props.closeChosenArtist()},r.state={elements:r.getChosenClusterGraphElements(r.props.chosenCluster)},r}return Object(j.a)(e,t),Object(E.a)(e,[{key:"getChosenClusterGraphElements",value:function(t){for(var e=[],r=[],s=0;s<t.artistsIds.length;s++){var n=t.artistsIds[s],i=t.artistsPositions[n];e.push({artist:this.props.artistDict[n],position:{x:i.x,y:i.y}})}for(var a=0;a<this.props.artistEdges.length;a++){var o=this.props.artistEdges[a].id1,c=this.props.artistEdges[a].id2;t.artistsIds.includes(o)&&t.artistsIds.includes(c)&&r.push({id:o+c,id1:o,id2:c,weigth:this.props.artistEdges[a].weight})}return{nodes:e,edges:r}}},{key:"getSimilarClusters",value:function(){for(var t=this,e=this.props.chosenCluster.id,r=[],n=0;n<this.props.clusterEdges.length;n++){var i=this.props.clusterEdges[n];i.id2===i.id1||i.id1!==e&&i.id2!==e||r.push(i)}r.sort((function(t,e){return t.weight>e.weight?-1:1}));for(var a=[],o={width:"".concat(60,"px"),height:"".concat(60,"px"),backgroundSize:"".concat(60,"px ").concat(60,"px")},c=0;c<r.length;c++){var u=r[c];u.weight>2&&function(){for(var r=e===u.id1?u.id2:u.id1,n=t.props.clusters[t.props.clusters.map((function(t){return t.id})).indexOf(r)],i=[],c=0;c<Math.min(n.artistsIds.length,3);c++){var l=n.artistsIds[c],p=t.props.artistDict[l],h=It({},o,{backgroundImage:"url(".concat(p.image,")")});i.push(s.createElement("div",{className:"artistWrapper"},s.createElement("div",{title:p.name,style:h,className:"artistDiv"})))}a.push(s.createElement("div",{className:"similar-cluster-div padding-margin pointer",onClick:function(){t.props.closeChosenArtist(),t.props.setChosenCluster(n),t.setState({elements:t.getChosenClusterGraphElements(n)})}},s.createElement("p",null,"Similar to: ",n.genres[0]),s.createElement("div",{className:"artistsRow"},i)))}()}return a}},{key:"render",value:function(){var t=this.getSimilarClusters();return s.createElement("div",{className:"chosen-cluster-div"},s.createElement("div",{className:"chosen-cluster-column"},s.createElement("div",{className:"similar-cluster-row"},s.createElement("div",{className:"go-back-div padding-margin pointer",onClick:this.onClick},s.createElement(xt.a,{size:50}),s.createElement("h3",{className:"h3-no-padding"},"Go back to the graph")),t),s.createElement("div",{className:"chosen-cluster-graph-div"},s.createElement(Ct,{graphElements:this.state.elements}))),s.createElement(Tt,null))}}]),e}(s.Component),Ut=Object(o.b)((function(t){return{artistEdges:t.graph.artistEdges,clusters:t.graph.clusters,clusterEdges:t.graph.clusterEdges,artistDict:t.graph.artistDict}}),{closeChosenClusterGraph:function(){return{type:"CLOSE_CHOSEN_CLUSTER_GRAPH",reducer:Object(L.a)((function(t){t.chosenCluster=void 0}))}},closeChosenArtist:function(){return{type:"CLOSE_CHOSEN_ARTIST",reducer:Object(L.a)((function(t){t.chosenArtist=void 0}))}},setChosenCluster:B})(Rt),zt=r(55);function Wt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,s)}return r}function Gt(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Wt(r,!0).forEach((function(e){Object(mt.a)(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Wt(r).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var Ht=r(74);Ht.registerLocale(r(77));var _t=function(t){function e(t){var r;return Object(b.a)(this,e),(r=Object(O.a)(this,Object(S.a)(e).call(this,t))).state={positionX:t.positionX,positionY:t.positionY,dragging:!1,fontSizeDefault:12},r.onDrag=r.onDrag.bind(Object(ct.a)(r)),r.onStop=r.onStop.bind(Object(ct.a)(r)),r}return Object(j.a)(e,t),Object(E.a)(e,[{key:"componentDidUpdate",value:function(t,e){t.positionX!==this.props.positionX&&this.setState({positionX:this.props.positionX})}},{key:"onDrag",value:function(t,e){t.stopPropagation(),t.preventDefault();var r=this.state.positionX,s=this.state.positionY,n=r+e.deltaX,i=s+e.deltaY;this.setState({dragging:!0,positionX:n,positionY:i}),this.props.positionChanged(n,i,this.props.cluster.id)}},{key:"onStop",value:function(t){t.stopPropagation(),t.preventDefault();var e=this.state.dragging;this.setState({dragging:!1}),e||this.handleClick(t)}},{key:"handleClick",value:function(t){this.props.setChosenCluster(this.props.cluster)}},{key:"createArtistWrapper",value:function(t,e,r){return n.a.createElement("div",{key:r,className:"artistWrapper"},n.a.createElement("div",{className:"colourWrapper"},n.a.createElement("div",{title:t,style:e,className:"artistDiv"})))}},{key:"createEmptyWrapper",value:function(t){return n.a.createElement("div",{key:t,className:"artistWrapper"},n.a.createElement("div",null))}},{key:"clusterDiv",value:function(){for(var t=this.props.clusterWidth/4.6,e={width:"".concat(t,"px"),height:"".concat(t,"px"),backgroundSize:"".concat(t,"px ").concat(t,"px")},r=[],s=this.props.cluster.artistsIds.length,i=0,a=[],o=0;o<Math.min(s,4);o++){var c=this.props.artistDict[this.props.cluster.artistsIds[o]],u=Gt({},e,{backgroundImage:"url(".concat(c.image,")")});a.push(this.createArtistWrapper(c.name,u,i++))}if(r.push(n.a.createElement("div",{key:1,className:"artistsRow"},a)),a=[],s>4){a.push(this.createEmptyWrapper(i++)),a.push(this.createEmptyWrapper(i++));for(var l=4;l<Math.min(6,s-1);l++){var p=this.props.artistDict[this.props.cluster.artistsIds[l]],h=Gt({},e,{backgroundImage:"url(".concat(p.image,")")});a.push(this.createArtistWrapper(p.name,h,i++))}if(s>6){var d=Gt({},e,{backgroundImage:"url(".concat("/spotifygraph/three-dots.png",")")});a.push(this.createArtistWrapper("AND OTHERS",d,i++))}a.push(this.createEmptyWrapper(i++)),a.push(this.createEmptyWrapper(i++)),r.push(n.a.createElement("div",{key:2,className:"artistsRow"},a))}var g="",f=this.props.cluster.genres.length;if(0===f)g="...unknown genre...";else for(var m=0;m<Math.min(f,this.props.fontSizeConst+1);m++)g+=0===m?this.props.cluster.genres[m]:", "+this.props.cluster.genres[m];var v={width:"".concat(this.props.clusterWidth,"px")};return n.a.createElement("div",{className:"nodeWrapper",style:v},this.props.cluster.country&&n.a.createElement("div",{style:{position:"absolute",margin:0,left:0,opacity:.4,zIndex:-1,alignItems:"center"}},n.a.createElement(zt.a,{countryCode:Ht.alpha3ToAlpha2(this.props.cluster.country),svg:!0,style:{width:this.props.clusterWidth+30,height:"260px"}})),n.a.createElement("div",{className:"nodeHeader"},n.a.createElement("div",{className:"header noselect",style:{fontSize:this.state.fontSizeDefault/this.props.fontSizeConst+this.props.fontSizeConst}},g)),r)}},{key:"render",value:function(){var t=this.clusterDiv();return n.a.createElement(bt.a,{onDrag:this.onDrag,onStop:this.onStop,onStart:function(t){t.stopPropagation(),t.preventDefault()},bounds:"parent",defaultPosition:{x:this.props.positionX,y:this.props.positionY},position:{x:this.state.positionX,y:this.state.positionY}},t)}}]),e}(n.a.Component),Ft=Object(o.b)((function(t){return{chosenCluster:t.chosenCluster,artistDict:t.graph.artistDict}}),{setChosenCluster:B})(_t),Yt=function(t){function e(){return Object(b.a)(this,e),Object(O.a)(this,Object(S.a)(e).apply(this,arguments))}return Object(j.a)(e,t),Object(E.a)(e,[{key:"render",value:function(){var t,e,r,s,i=this.props.weigth;this.props.x1>this.props.x2?(e=this.props.x2,r=this.props.x1-this.props.x2):(e=this.props.x1,r=this.props.x2-this.props.x1),this.props.y1>this.props.y2?(t=this.props.y2,s=this.props.y1-this.props.y2):(t=this.props.y1,s=this.props.y2-this.props.y1);var a=0+i,o=s,c=r,u=0+i;(this.props.y1>this.props.y2&&this.props.x1>this.props.x2||this.props.y1<this.props.y2&&this.props.x1<this.props.x2)&&(o=0+i,u=s);var l={top:t+30,left:e+this.props.clusterWidth/2};return n.a.createElement("svg",{style:l,className:"svgWrapper",width:r+i+20,height:s+i+20},n.a.createElement("path",{d:"M ".concat(a,",").concat(o," C ").concat(a+20,",").concat(o+20," ").concat(c+20,",").concat(u+20," ").concat(c,",").concat(u),strokeWidth:i,fill:"none",stroke:"black"}))}}]),e}(n.a.Component),Vt=(r(47),function(t){function e(t){return Object(b.a)(this,e),Object(O.a)(this,Object(S.a)(e).call(this,t))}return Object(j.a)(e,t),Object(E.a)(e,[{key:"render",value:function(){return n.a.createElement("div",{className:"progressbar"},n.a.createElement("div",{className:"progress",style:{width:"".concat(100*this.props.progress,"%")}}))}}]),e}(n.a.Component)),Xt=function(t){function e(t){var r;return Object(b.a)(this,e),(r=Object(O.a)(this,Object(S.a)(e).call(this,t))).boxRef=void 0,r.wrapperRef=void 0,r.state={clusterWidth:150,clusterHeight:150,currentScale:1,originalRefHeight:0,originalRefWidth:0},r.wrapperRef=n.a.createRef(),r.boxRef=n.a.createRef(),r.positionChangedHandler=r.positionChangedHandler.bind(Object(ct.a)(r)),r}return Object(j.a)(e,t),Object(E.a)(e,[{key:"getClusterPositions",value:function(t,e){var r=this.state.clusterWidth,s=this.state.clusterHeight,n=pt(t,e,r,s,this.props.graph.clusterSquares),i=ht(n,s);return(this.state.dimensions?this.state.dimensions:{w:500,h:1e3}).h=i,n}},{key:"positionChangedHandler",value:function(t,e,r){if(null==this.state.clusterPositions)return[];var s=this.state.clusterPositions;s[r]={x:t,y:e},this.setState({clusterPositions:s})}},{key:"createNodes",value:function(){if(null===this.state.clusterPositions||Object(N.isUndefined)(this.state.clusterPositions))return[];for(var t=[],e=0;e<this.props.graph.clusters.length;e++){var r=this.props.graph.clusters[e];t.push(n.a.createElement(Ft,{key:r.id,fontSizeConst:this.state.currentScale,cluster:r,positionX:this.state.clusterPositions[r.id].x,positionY:this.state.clusterPositions[r.id].y,positionChanged:this.positionChangedHandler,clusterWidth:this.state.clusterWidth}))}return t}},{key:"createEdges",value:function(){var t=[];if(null==this.state.clusterPositions)return[];for(var e=0;e<this.props.graph.clusterEdges.length;e++){var r=this.props.graph.clusterEdges[e].id1,s=this.props.graph.clusterEdges[e].id2,i=r+s;if(r!==s){var a=3*Math.log2(this.props.graph.clusterEdges[e].weight);t.push(n.a.createElement(Yt,{key:i,x1:this.state.clusterPositions[r].x,y1:this.state.clusterPositions[r].y,x2:this.state.clusterPositions[s].x,y2:this.state.clusterPositions[s].y,weigth:a,clusterWidth:this.state.clusterWidth}))}}return t}},{key:"graphLoadedCallback",value:function(t,e){var r=this.getClusterPositions(t,e);this.setState({clusterPositions:r})}},{key:"onResizeRecomputePositions",value:function(){if(!Object(N.isUndefined)(this.state.dimensions)&&!Object(N.isUndefined)(this.state.clusterPositions)){var t=this.state.dimensions.w,e=this.state.dimensions.h,r=this.wrapperRef.current.clientWidth;if(t!==r){var s=this.state.clusterPositions,n=Math.floor(r/t*1024)/1024;for(var i in s)s[i].x=n*s[i].x;this.setState({dimensions:{w:r,h:e},clusterPositions:s})}}}},{key:"componentDidMount",value:function(){var t=this;window.addEventListener("resize",(function(){t.onResizeRecomputePositions()}));var e=this.wrapperRef.current.clientWidth,r=this.wrapperRef.current.clientHeight;this.setState({dimensions:{w:e,h:r},originalRefWidth:e,originalRefHeight:r},(function(){return t.props.loadGraph(t.props.accessToken,t.props.sp,(function(){return t.graphLoadedCallback(e,r)}))}))}},{key:"componentDidUpdate",value:function(t,e){if(this.props.isGraphFromFileLoaded){var r=500,s=500;Object(N.isUndefined)(this.state.dimensions)||(r=this.state.dimensions.w,s=this.state.dimensions.h),s=this.state.originalRefHeight,this.graphLoadedCallback(r,s),this.props.graphFromFileIsLoaded(!1)}}},{key:"render",value:function(){var t=this;if(this.props.graphLoading)return n.a.createElement("div",{className:"page-wrapper"},n.a.createElement("div",{className:"generic-description"},this.props.graphLoadingMessage),n.a.createElement(Vt,{progress:this.props.graphLoadingRelatedArtistsProgress}));if(this.props.spotifyError)return n.a.createElement("div",null,"Error while loading");var e=void 0!==this.props.chosenCluster,r="";e&&(r="none");var s=this.state.dimensions?this.state.dimensions.w:500,i=this.state.dimensions?this.state.dimensions.h:500;return n.a.createElement("div",{className:"wrapper",ref:this.wrapperRef},n.a.createElement(ut.b,{defaultScale:1,defaultPositionX:1,defaultPositionY:1,options:{maxScale:4,limitToWrapper:!0},onWheelStop:function(e){t.setState({currentScale:e.scale})}},(function(a){a.zoomIn,a.zoomOut,a.setTransform,Object(ot.a)(a,["zoomIn","zoomOut","setTransform"]);return n.a.createElement(n.a.Fragment,null,e&&n.a.createElement(Ut,{key:t.props.chosenCluster.id,chosenCluster:t.props.chosenCluster}),n.a.createElement(ut.a,null,n.a.createElement("div",{className:"box",ref:t.boxRef,style:{width:s,height:i,display:r}},t.state.dimensions&&t.createEdges(),t.state.dimensions&&t.createNodes())))})))}}]),e}(n.a.Component),Qt=Object(o.b)((function(t){return{graphLoaded:t.graphLoaded,graphLoading:t.graphLoading,spotifyError:t.isGraphLoadingError,graphLoadingMessage:t.graphLoadingMessage,graphLoadingRelatedArtistsProgress:t.graphLoadingRelatedArtistsProgress,graph:t.graph,chosenCluster:t.chosenCluster,accessToken:t.accessToken,sp:t.spotifyWebApiObject,isGraphFromFileLoaded:t.isGraphFromFileLoaded}}),(function(t){return{setGraph:J,graphFromFileIsLoaded:function(e){return t(nt(e))},loadGraph:function(e,r,s){return t(function(t,e,r){return function(){var s=Object(C.a)(w.a.mark((function s(n){return w.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:n(q()),V(t,e,(function(){}),(function(t){n(Z(t))}),(function(t){n(K(t))})).then((function(t){return n(J(t))})).then((function(){return r()})).then((function(){return n($())})).catch((function(t){console.debug(t),n({type:"GRAPH_LOADING_ERROR",reducer:Object(L.a)((function(t){t.graphLoading=!1,t.isGraphLoadingError=!0}))})}));case 2:case"end":return s.stop()}}),s)})));return function(t){return s.apply(this,arguments)}}()}(e,r,s))}}}))(Xt),Bt=function(t){function e(t){var r;return Object(b.a)(this,e),(r=Object(O.a)(this,Object(S.a)(e).call(this,t))).playerRef=void 0,r.playerRef=n.a.createRef(),r}return Object(j.a)(e,t),Object(E.a)(e,[{key:"componentDidUpdate",value:function(){null!==this.playerRef.current&&(this.props.paused?this.playerRef.current.pause():this.playerRef.current.play())}},{key:"render",value:function(){var t=this;if(Object(N.isUndefined)(this.props.accessToken))return n.a.createElement("div",null);if(Object(N.isUndefined)(this.props.songToPlay))return n.a.createElement("div",{className:"empty-player"},n.a.createElement("div",{className:"generic-description-small-margin"},"Chose some artist and some song and listen to a preview"));for(var e,r=[],s=0;s<this.props.songToPlay.artistsIds.length;s++){var i=this.props.songToPlay.artistsIds[s];i in this.props.favouriteArtistDict?r.push(this.props.favouriteArtistDict[i].name):i in this.props.nonFavouriteArtistDict?r.push(this.props.nonFavouriteArtistDict[i].name):r.push(i)}var a=r.join(", ");return e=this.props.songToPlay.previewLink,n.a.createElement("div",{className:"player"},n.a.createElement("div",{className:"flex1"},n.a.createElement("p",{className:"playingSongName"},n.a.createElement("b",null,this.props.songToPlay.name)),n.a.createElement("p",{className:"playingSongArtists"},a)),n.a.createElement("audio",{onPlay:function(){return t.props.setPaused(!1)},onPause:function(){return t.props.setPaused(!0)},ref:this.playerRef,autoPlay:!0,controls:!0,src:e,className:"playerControls"},"Your browser does not support the",n.a.createElement("code",null,"audio")," element."))}}]),e}(n.a.Component),Jt=Object(o.b)((function(t){return{paused:t.paused,accessToken:t.accessToken,songToPlay:t.songToPlay,favouriteArtistDict:t.graph.artistDict,nonFavouriteArtistDict:t.nonFavouriteArtistDict}}),(function(t){return{setPaused:function(e){return t(st(e))}}}))(Bt),qt=function(t){function e(){return Object(b.a)(this,e),Object(O.a)(this,Object(S.a)(e).apply(this,arguments))}return Object(j.a)(e,t),Object(E.a)(e,[{key:"render",value:function(){return s.createElement("div",{className:"mainDiv"},s.createElement("div",{className:"mainDivContent"},s.createElement(Qt,null)),s.createElement(Jt,null))}}]),e}(s.Component),Zt=(r(78),function(t){function e(t){var r;return Object(b.a)(this,e),(r=Object(O.a)(this,Object(S.a)(e).call(this,t))).dowloadGraph=r.dowloadGraph.bind(Object(ct.a)(r)),r.uploadGraph=r.uploadGraph.bind(Object(ct.a)(r)),r}return Object(j.a)(e,t),Object(E.a)(e,[{key:"chosenClusterArtists",value:function(){var t=this,e=[];return void 0!==this.props.chosenCluster&&(e=this.props.chosenCluster.artistsIds.map((function(e){return s.createElement("li",{className:"shift-left"},t.props.artistDict[e].name)}))),s.createElement("ul",null,e)}},{key:"chosenClusterProperties",value:function(){var t=[];return void 0!==this.props.chosenCluster&&(t=this.props.chosenCluster.genres.map((function(t){return s.createElement("li",{className:"shift-left"},t)}))),s.createElement("ul",null,t)}},{key:"dowloadGraph",value:function(){if(this.props.graph){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(JSON.stringify(this.props.graph,null,4))),t.setAttribute("download","mySpotifyGraph.json"),t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)}}},{key:"uploadGraph",value:function(t){var e=this;console.log(t);var r=t[0],s=new FileReader;s.onload=function(t){if(null!==t.target&&null!==t.target.result){var r=t.target.result.toString(),s=Object(N.isUndefined)(r)?{}:JSON.parse(r);try{!function(t){e.props.loadGraphFromFile(t)}(s)}catch(n){alert("Sorry, this file seems to be not in the correct format"+n),console.debug("error while graph loading from file:",n)}}else alert("Sorry, this file seems to be not in the correct format")},s.readAsText(r)}},{key:"render",value:function(){var t=this;return s.createElement("div",{className:"sideBar"},s.createElement("div",{className:"sideBarHeader"},s.createElement("img",{width:40,height:40,className:"spotify-image",alt:"",src:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiPjxwYXRoIGQ9Ik0xOS4wOTggMTAuNjM4Yy0zLjg2OC0yLjI5Ny0xMC4yNDgtMi41MDgtMTMuOTQxLTEuMzg3LS41OTMuMTgtMS4yMi0uMTU1LTEuMzk5LS43NDgtLjE4LS41OTMuMTU0LTEuMjIuNzQ4LTEuNCA0LjIzOS0xLjI4NyAxMS4yODUtMS4wMzggMTUuNzM4IDEuNjA1LjUzMy4zMTcuNzA4IDEuMDA1LjM5MiAxLjUzOC0uMzE2LjUzMy0xLjAwNS43MDktMS41MzguMzkyem0tLjEyNiAzLjQwM2MtLjI3Mi40NC0uODQ3LjU3OC0xLjI4Ny4zMDgtMy4yMjUtMS45ODItOC4xNDItMi41NTctMTEuOTU4LTEuMzk5LS40OTQuMTUtMS4wMTctLjEyOS0xLjE2Ny0uNjIzLS4xNDktLjQ5NS4xMy0xLjAxNi42MjQtMS4xNjcgNC4zNTgtMS4zMjIgOS43NzYtLjY4MiAxMy40OCAxLjU5NS40NC4yNy41NzguODQ3LjMwOCAxLjI4NnptLTEuNDY5IDMuMjY3Yy0uMjE1LjM1NC0uNjc2LjQ2NS0xLjAyOC4yNDktMi44MTgtMS43MjItNi4zNjUtMi4xMTEtMTAuNTQyLTEuMTU3LS40MDIuMDkyLS44MDMtLjE2LS44OTUtLjU2Mi0uMDkyLS40MDMuMTU5LS44MDQuNTYyLS44OTYgNC41NzEtMS4wNDUgOC40OTItLjU5NSAxMS42NTUgMS4zMzguMzUzLjIxNS40NjQuNjc2LjI0OCAxLjAyOHptLTUuNTAzLTE3LjMwOGMtNi42MjcgMC0xMiA1LjM3My0xMiAxMiAwIDYuNjI4IDUuMzczIDEyIDEyIDEyIDYuNjI4IDAgMTItNS4zNzIgMTItMTIgMC02LjYyNy01LjM3Mi0xMi0xMi0xMnoiLz48L3N2Zz4="}),s.createElement("h1",null,"Spotify graph")),s.createElement("div",null," Graph of your musical taste \u266c\u266b "),s.createElement("div",{className:"download-button pointer",onClick:this.dowloadGraph},"Download graph to JSON"),s.createElement("input",{className:"download-button",type:"file",onChange:function(e){null!==e.target.files&&t.uploadGraph(e.target.files)}}),s.createElement("div",{className:"sideBarContent"},this.props.chosenCluster&&s.createElement("div",{className:"box-with-margin"},s.createElement("h2",null,"mostly these genres"),this.chosenClusterProperties()),this.props.chosenCluster&&s.createElement("div",{className:"box-with-margin"},s.createElement("h2",{className:"text-align-center"},"group of artists"),this.chosenClusterArtists()),!this.props.chosenCluster&&this.props.graph&&s.createElement("div",{className:"box-with-margin"},s.createElement("p",null,"We took the artists from your ",s.createElement("b",null,"liked")," songs and the artists that ",s.createElement("b",null,"you follow"),"."),s.createElement("p",null,"We found ",s.createElement("b",null,Object.values(this.props.graph.artistDict).length," artist")," that you like."),s.createElement("p",null,"We divided them into clusters you're seing right now. The clusters are based on ",s.createElement("b",null,"genres")," and ",s.createElement("b",null,"preferences")," of other users of Spotify"),s.createElement("p",null,"Click the cluster and explore how the artists are connected."))))}}]),e}(s.Component)),Kt=Object(o.b)((function(t){return{chosenCluster:t.chosenCluster,chosenArtist:t.chosenArtist,graph:t.graph,sp:t.spotifyWebApiObject,artistDict:t.graph.artistDict}}),(function(t){return{loadGraphFromFile:function(e){return t((r=e,function(){var t=Object(C.a)(w.a.mark((function t(e){var s,n;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(s=0;s<r.clusters.length;s++)n=r.clusters[s],(Object(N.isUndefined)(n.artistsIds)||0===n.artistsIds.length)&&(n.artistsIds=Object.keys(n.artistsPositions));return t.next=3,Promise.resolve(e({type:"CLEAR_CHOSEN_CLUSTER_ARTIST",reducer:Object(L.a)((function(t){t.chosenCluster=void 0,t.chosenArtist=void 0}))})).then((function(){return e(q())})).then((function(){return e(J(r))})).then((function(){return e(nt(!0))})).then((function(){return e($())}));case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));var r}}}))(Zt),$t=function(t){function e(t){var r;return Object(b.a)(this,e),(r=Object(O.a)(this,Object(S.a)(e).call(this,t))).state={loggingLoading:!0,loggingFailed:!1},r.afterSpotifyLogin(),r}return Object(j.a)(e,t),Object(E.a)(e,[{key:"afterSpotifyLogin",value:function(){var t=this,e=window.location.search.substr(1),r={};if(e.split("&").forEach((function(t){var e=t.split("=");r[e[0]]=decodeURIComponent(e[1])})),"code"in r&&""!==r.code&&null!==r.code){var s=this.props.history.location.pathname;this.props.history.push({pathname:s,search:""});var n="https://spotify-graph-gajdusek.herokuapp.com/graphapp/logged_in/?code="+r.code,i="";fetch(n).then((function(e){if(200!==e.status)throw e.status;var r=e.headers.get("access-token");null!==r&&(i=r,t.props.setAccessToken(i)),t.setState({loggingLoading:!1})})).catch((function(e){console.debug(e),t.setState({loggingFailed:!0,loggingLoading:!1}),alert("Sorry, we did not manage to log you in Spotify.")}))}else this.state={loggingFailed:!0,loggingLoading:!1}}},{key:"render",value:function(){return this.state.loggingLoading?n.a.createElement("div",{className:"App"},n.a.createElement("div",{className:"page-wrapper"},n.a.createElement("div",{className:"loader"}),n.a.createElement("div",{className:"generic-description"},"Logging into Spotify"))):this.state.loggingFailed?n.a.createElement(y.a,{to:"/login"}):n.a.createElement("div",{className:"App"},n.a.createElement(Kt,null),n.a.createElement(qt,null))}}]),e}(n.a.Component),te=Object(y.g)(Object(o.b)((function(t){return{loggedIn:t.userLoggedIn}}),(function(t){return{setAccessToken:function(e){return t(function(t){return{type:"SET_ACCESS_TOKEN",payload:t,reducer:Object(L.a)((function(e){e.accessToken=t,e.userLoggedIn=!0}))}}(e))}}}))($t)),ee=Object(c.d)(m,f(),Object(c.c)(c.a.apply(void 0,d))),re=function(){return n.a.createElement(o.a,{store:ee},n.a.createElement(v.a,{basename:"/spotifygraph"},n.a.createElement(y.d,null,n.a.createElement(y.b,{path:"/login",component:at}),n.a.createElement(y.b,{path:"/mygraph",component:te}),n.a.createElement(y.b,{path:"/",component:x}))))};a.a.render(n.a.createElement(re,null),document.getElementById("root"))}},[[56,1,2]]]);
//# sourceMappingURL=main.9112c499.chunk.js.map