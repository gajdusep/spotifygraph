(this.webpackJsonpspotifygraph=this.webpackJsonpspotifygraph||[]).push([[0],{28:function(e,t,r){},29:function(e,t,r){},41:function(e,t,r){},48:function(e,t,r){},52:function(e,t,r){},53:function(e,t,r){},61:function(e,t,r){e.exports=r(91)},66:function(e,t,r){},82:function(e,t,r){},83:function(e,t,r){},84:function(e,t,r){},89:function(e,t,r){},90:function(e,t,r){},91:function(e,t,r){"use strict";r.r(t);var s=r(1),n=r.n(s),a=r(21),i=r.n(a),o=(r(66),r(10)),c=r(23),l=r(55),u=r(56),p=r(32),h=r.n(p),d=[],g=Object(u.createLogger)({predicate:function(e,t){return!1},collapsed:function(e,t){return!0}});d.push(l.a),d.push(g);var m=function(){return{isGraphLoadingError:!1,graphLoaded:!1,graphLoading:!1,chosenArtistLoading:!1,userLoggedIn:!1,graph:{clusters:[],clusterEdges:[],artistEdges:[],clusterSquares:[],artistDict:{}},spotifyWebApiObject:new h.a,graphLoadingRelatedArtistsProgress:0,graphLoadingMessage:"",paused:!1,isGraphFromFileLoaded:!1,nonFavouriteArtistDict:{}}},f=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m(),t=arguments.length>1?arguments[1]:void 0;return t.reducer?t.reducer(e):e},v=r(25),y=r(11),b=r(3),E=r(4),k=r(6),S=r(5),O=(r(48),r(28),function(e){Object(k.a)(r,e);var t=Object(S.a)(r);function r(e){return Object(b.a)(this,r),t.call(this,e)}return Object(E.a)(r,[{key:"render",value:function(){var e=this;return n.a.createElement("div",{className:"App"},n.a.createElement("div",{className:"page-wrapper"},n.a.createElement("div",{className:"page-description-div"},n.a.createElement("h1",null,"Spotify graph"),n.a.createElement("p",null,"A project that will show you your musical taste."),n.a.createElement("p",null,"We will fetch data from your spotify account, divide them into groups and visualize these groups in form of a graph.")),n.a.createElement("button",{className:"very-big-button",onClick:function(){e.props.history.push("/login")}},"Continue to get your graph"),n.a.createElement("div",{className:"generic-description"},n.a.createElement("p",null,"Have a look at the code on: ",n.a.createElement("a",{href:"https://gitlab.com/gajdusep/spotifygraph",target:"_blank"},"GitLab")))))}}]),r}(n.a.Component)),j=Object(y.g)(Object(o.b)((function(e){return{loggedIn:e.userLoggedIn}}),{})(O)),x=function(e){Object(k.a)(r,e);var t=Object(S.a)(r);function r(e){return Object(b.a)(this,r),t.call(this,e)}return Object(E.a)(r,[{key:"spotifyLoginLink",value:function(){var e,t={client_id:"dfb05fa5c36b41d48407ad5e3773d39b",response_type:"code",redirect_uri:"https://gajdusep.github.io/spotifygraph/mygraph",scope:["streaming","user-read-email","user-read-private","user-read-playback-state","user-modify-playback-state","user-library-read","user-library-modify","user-follow-read","playlist-modify-private","playlist-read-private"].join(" "),state:"rndstringsomehash"};return"https://accounts.spotify.com/authorize?"+(e=t,Object.entries(e).map((function(e){return e.map(encodeURIComponent).join("=")})).join("&"))}},{key:"loginWithSpotify",value:function(){window.location.assign(this.spotifyLoginLink())}},{key:"render",value:function(){var e=this;return n.a.createElement("div",{className:"App"},n.a.createElement("div",{className:"page-wrapper"},n.a.createElement("div",{className:"generic-description"},n.a.createElement("div",null,"Please login with your spotify account")),n.a.createElement("button",{className:"very-big-button",onClick:function(){return e.loginWithSpotify()}},"Log in with your Spotify account")))}}]),r}(n.a.Component),A=r(60),w=r(13),L=r(45),C=r(8),N=r(12),D=r.n(N),M=r(20),T=r(9),I=r(24),R=r(36),P=function(e,t){for(var r=[],s=0;s<t.length;s++){for(var n=t[s].id,a=[],i={},o=0,c=Object.entries(t[s].artistsPositions);o<c.length;o++){var l=Object(R.a)(c[o],2),u=l[0],p=l[1];a.push(e[u]),i[u]={x:p.x,y:p.y}}a.sort((function(e,t){return t.score-e.score}));var h={id:n,genres:t[s].genres,artistsIds:a.map((function(e){return e.id})),artistsPositions:i,country:t[s].country};r.push(h)}return r},z=function(e){for(var t=[],r=0;r<e.length;r++){var s=e[r],n={};if(Object.values(s).length>0){for(var a in s){var i=s[a].x,o=s[a].y;n[a]={x:i,y:o}}t.push(n)}}return t},G=function(e){return new Promise((function(t){return setTimeout(t,e)}))},U=function(e){if(!document.cookie)return"";var t=document.cookie.split(";").map((function(e){return e.trim()})).filter((function(t){return t.startsWith(e+"=")}));return 0===t.length?"":decodeURIComponent(t[0].split("=")[1])},H=function(e){return null===e.preview_url&&console.debug(e.id,":",e.name,e),{name:e.name,id:e.id,previewLink:e.preview_url,artistsIds:e.artists.map((function(e){return e.id})),externalUrl:e.external_urls.spotify}},W=function(){var e=Object(M.a)(D.a.mark((function e(t){var r,s,n,a,i,o,c,l;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=50,s=[],a=3,i=null;case 4:o=!0,c=0;case 6:return e.prev=6,l=i?{limit:r,after:i}:{limit:r},e.next=10,t.getFollowedArtists(l);case 10:n=e.sent,e.next=19;break;case 13:return e.prev=13,e.t0=e.catch(6),e.next=17,G(e.t0.getResponseHeader["retry-after"]?1e3*parseInt(e.t0.headers["retry-after"]+1):4e3);case 17:o=!1,c+=1;case 19:if(!1===o&&c<a){e.next=6;break}case 20:Object(C.isUndefined)(n)?i=null:(s.push.apply(s,Object(I.a)(n.artists.items.map((function(e){return e.id})))),i=n.artists.cursors.after);case 21:if(i){e.next=4;break}case 22:return e.abrupt("return",s);case 23:case"end":return e.stop()}}),e,null,[[6,13]])})));return function(t){return e.apply(this,arguments)}}(),_=function(){var e=Object(M.a)(D.a.mark((function e(t,r,s,n){var a,i,o,c,l,u,p,h,d;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=[],i=3,o=r.length,c=0;case 4:if(!(c<o)){e.next=31;break}if(l=r[c],n(c/o),!(l in s)){e.next=11;break}a.push(s[l]),e.next=28;break;case 11:u=void 0,p=!0,h=0;case 14:return e.prev=14,e.next=17,t.getArtistRelatedArtists(l);case 17:u=e.sent,e.next=26;break;case 20:return e.prev=20,e.t0=e.catch(14),e.next=24,G(e.t0.getResponseHeader["retry-after"]?1e3*parseInt(e.t0.headers["retry-after"]+1):4e3);case 24:p=!1,h+=1;case 26:if(!1===p&&h<i){e.next=14;break}case 27:Object(C.isUndefined)(u)?a.push([]):(d=u.artists.map((function(e){return e.id})),s[l]=d,a.push(d));case 28:c++,e.next=4;break;case 31:return e.abrupt("return",a);case 32:case"end":return e.stop()}}),e,null,[[14,20]])})));return function(t,r,s,n){return e.apply(this,arguments)}}(),F=function(){var e=Object(M.a)(D.a.mark((function e(t){var r,s,n,a,i,o,c,l;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=0,s=50,n=[],i=3,o=null;case 5:c=!0,l=0;case 7:return e.prev=7,e.next=10,t.getMySavedTracks({limit:50,offset:r});case 10:a=e.sent,e.next=19;break;case 13:return e.prev=13,e.t0=e.catch(7),e.next=17,G(e.t0.getResponseHeader["retry-after"]?1e3*parseInt(e.t0.headers["retry-after"]+1):4e3);case 17:c=!1,l+=1;case 19:if(!1===c&&l<i){e.next=7;break}case 20:Object(C.isUndefined)(a)?o=null:(r+=s,n.push.apply(n,Object(I.a)(a.items.map((function(e){return e.track})))),o=a.next);case 21:if(o){e.next=5;break}case 22:return e.abrupt("return",n);case 23:case"end":return e.stop()}}),e,null,[[7,13]])})));return function(t){return e.apply(this,arguments)}}(),Y=function(e){var t=e.map((function(e){return e.artists})).reduce((function(e,t){return e.concat(t)}),[]).map((function(e){return e.id}));return Object(I.a)(new Set(t))},V=function(){var e=Object(M.a)(D.a.mark((function e(t,r){var s,n,a,i,o,c,l;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=[],n=3,a=0,i=50;case 4:o=void 0,c=!0,l=0;case 7:return e.prev=7,e.next=10,t.getArtists(r.slice(a,a+i));case 10:o=e.sent,e.next=19;break;case 13:return e.prev=13,e.t0=e.catch(7),e.next=17,G(e.t0.getResponseHeader["retry-after"]?1e3*parseInt(e.t0.headers["retry-after"]+1):4e3);case 17:c=!1,l+=1;case 19:if(!1===c&&l<n){e.next=7;break}case 20:if(!Object(C.isUndefined)(o)){e.next=24;break}throw new Error("Unable to load artists.");case 24:s.push.apply(s,Object(I.a)(o.artists)),a+=i;case 26:if(a<r.length){e.next=4;break}case 27:return e.abrupt("return",s);case 28:case"end":return e.stop()}}),e,null,[[7,13]])})));return function(t,r){return e.apply(this,arguments)}}(),X=function(e,t,r,s){if(e.length!==t.length)return console.debug("ERROR: NOT EVERY ARTIST HAS RELATED ARTISTS"),{};for(var n={},a=0;a<e.length;a++){var i=e[a],o=i.images&&i.images.length>0?i.images[i.images.length-1].url:"",c=r.has(i.id),l=i.popularity,u=c?5:0;n[i.id]={genres:i.genres,id:i.id,image:o,isFollowed:c,likedSongs:[],name:i.name,relatedArtistsIds:t[a],score:.1*l+u}}for(var p=0;p<s.length;p++)for(var h=s[p],d=0;d<h.artists.length;d++){var g=h.artists[d];g.id in n&&n[g.id].likedSongs.push({artistsIds:h.artists.map((function(e){return e.id})),externalUrl:h.external_urls.spotify,name:h.name,id:h.id,previewLink:h.preview_url})}for(var m in n){var f=n[m];n[m].score+=1*f.likedSongs.length}return n},B=function(e){var t={};for(var r in e){var s=e[r];t[r]={id:s.id,relatedArtistsIds:s.relatedArtistsIds,genres:s.genres}}return t},Q=function(){var e=Object(M.a)(D.a.mark((function e(t,r,s,n,a){var i,o,c,l,u,p,h,d,g,m,f,v,y,b,E,k,S,O,j;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",{clusters:[],clusterEdges:[],artistEdges:[],clusterSquares:[],artistDict:{}});case 2:return r.setAccessToken(t),e.next=5,F(r);case 5:return i=e.sent,s("Getting your liked songs from Spotify..."),console.debug("liked songs: ",i),o=Y(i),console.debug("liked songs artists ids: ",o),s("Getting the artists you follow from Spotify..."),e.next=13,W(r);case 13:if(c=e.sent,console.debug("followed artists ids: ",c),l=Object(I.a)(new Set(o.concat(c))),console.debug("all artists ids: ",l),!(l.length<1)){e.next=20;break}return a("Your graph is empty, we have nothing to show to you"),e.abrupt("return",{clusters:[],clusterEdges:[],artistEdges:[],clusterSquares:[],artistDict:{}});case 20:return s("Getting information about all the artists you are interested it..."),e.next=23,Promise.resolve(V(r,l));case 23:if(u=e.sent,console.debug("artists full: ",u),p="relatedArtists",h=localStorage.getItem(p),d={},null===h);else{try{d=JSON.parse(h)}catch(w){d={}}null===d&&(d={})}return s("Getting information about the related artists of all of your favourite artists... \n This might take a while :("),e.next=32,_(r,l,d,n);case 32:if(g=e.sent,localStorage.setItem(p,JSON.stringify(d)),console.debug("related artists final",g),m=X(u,g,new Set(c),i),console.debug("artist dict",m),f=U("csrftoken"),s("We have all the data we need, now computing the graph!"),v="https://spotify-graph-gajdusek.herokuapp.com/graphapp/calculategraph/",!Object(C.isUndefined)(v)){e.next=42;break}return e.abrupt("return",{clusters:[],clusterEdges:[],artistEdges:[],clusterSquares:[],artistDict:{}});case 42:return y={},e.prev=43,e.next=46,fetch(v,{method:"POST",body:JSON.stringify(B(m)),headers:{"Content-Type":"application/json","X-CSRFToken":f}});case 46:if(!(b=e.sent).ok){e.next=53;break}return e.next=50,b.json();case 50:y=e.sent,e.next=60;break;case 53:return e.t0=Error,e.t1=b.status+".  "+b.statusText+".  ",e.next=57,b.text();case 57:throw e.t2=e.sent,e.t3=e.t1+e.t2,new e.t0(e.t3);case 60:e.next=66;break;case 62:throw e.prev=62,e.t4=e.catch(43),a(e.t4),e.t4;case 66:return console.debug(y),A=y.artistEdges,E=A.map((function(e){return{id1:e.id1,id2:e.id2,weight:e.weight}})),k=P(m,y.clusters),x=y.clusterEdges,S=x.map((function(e){return{id1:e.id1,id2:e.id2,weight:e.weight}})),O=z(y.clusterSquares),j=new Promise((function(e){return e({artistEdges:E,clusters:k,clusterEdges:S,clusterSquares:O,artistDict:m})})),e.t5=console,e.next=75,j;case 75:return e.t6=e.sent,e.t5.debug.call(e.t5,"graph from spotify fetch:",e.t6),e.abrupt("return",j);case 78:case"end":return e.stop()}var x,A}),e,null,[[43,62]])})));return function(t,r,s,n,a){return e.apply(this,arguments)}}(),q=r(57),J=r(2);var Z=J.g({x:J.e,y:J.e}),K=J.g({artistsIds:J.a(J.f),externalUrl:J.f,id:J.f,name:J.f,previewLink:J.i([J.f,J.d])}),$=(J.g({id:J.f,name:J.f}),J.g({genres:J.a(J.f),id:J.f,image:J.f,isFollowed:J.b,likedSongs:J.a(K),name:J.f,relatedArtistsIds:J.a(J.f),score:J.e})),ee=(J.g({genres:J.a(J.f),id:J.f,relatedArtistsIds:J.a(J.f)}),J.g({id:J.f,name:J.f}),J.g({id1:J.f,id2:J.f,weight:J.e})),te=J.g({id:J.f,genres:J.a(J.f),artistsIds:J.a(J.f),artistsPositions:J.c(J.f,Z),country:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"".concat(e.name," | undefined");return J.i([e,J.h],t)}(J.f)}),re=J.g({id1:J.f,id2:J.f,weight:J.e}),se=J.g({clusters:J.a(te),clusterEdges:J.a(re),artistDict:J.c(J.f,$),artistEdges:J.a(ee),clusterSquares:J.a(J.c(J.f,Z))}),ne=function(e){return{type:"SET_CHOSEN_ARTIST",payload:e,reducer:Object(T.a)((function(t){t.chosenArtist=e}))}},ae=function(e){return{type:"SET_CHOSEN_CLUSTER",payload:e,reducer:Object(T.a)((function(t){t.chosenCluster=e}))}},ie=function(e){return{type:"SET_GRAPH",payload:e,reducer:Object(T.a)((function(t){t.graph=e}))}},oe=function(){return{type:"GRAPH_LOADING",reducer:Object(T.a)((function(e){e.graphLoading=!0}))}},ce=function(e){return{type:"SET_GRAPH_LOADING_MESSAGE",reducer:Object(T.a)((function(t){t.graphLoadingMessage=e}))}},le=function(e){return{type:"SET_GRAPH_LOADING_ERROR_MESSAGE",reducer:Object(T.a)((function(t){t.graphLoadingErrorMessage=e}))}},ue=function(e){return{type:"SET_GRAPH_LOADING_MESSAGE",reducer:Object(T.a)((function(t){t.graphLoadingRelatedArtistsProgress=e}))}},pe=function(){return{type:"GRAPH_LOADING_SUCCESS",reducer:Object(T.a)((function(e){e.graphLoading=!1,e.graphLoaded=!0,e.isGraphLoadingError=!1}))}},he=function(e){return{type:"SET_CHOSEN_ARTIST_ERROR",payload:e,reducer:Object(T.a)((function(t){t.chosenArtistError=e}))}},de=function(e){return{type:"SET_CHOSEN_ARTIST_LOADING",payload:e,reducer:Object(T.a)((function(t){t.chosenArtistLoading=e}))}},ge=function(e,t){return{type:"SET_CHOSEN_ARTIST_DATA",payload:e,reducer:Object(T.a)((function(r){r.chosenArtistData=e,r.chosenArtist=t}))}},me=function(e){return{type:"SET_PAUSED",payload:e,reducer:Object(T.a)((function(t){t.paused=e}))}},fe=function(e){return{type:"UPDATE_NOT_FAVOURITE_ARTISTS",payload:e,reducer:Object(T.a)((function(t){for(var r=t.nonFavouriteArtistDict,s=t.graph.artistDict,n=0;n<e.length;n++){var a=e[n];a.id in s||(r[a.id]=a)}t.nonFavouriteArtistDict=r}))}},ve=function(e,t){return function(){var r=Object(M.a)(D.a.mark((function r(s){var n,a,i,o,c;return D.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!Object(C.isUndefined)(t)&&null!==t&&""!==t){r.next=3;break}return s(he("The token was not loaded, cannot obtain the artist data.")),r.abrupt("return");case 3:s(ne(e)),s(de(!0)),(n=new h.a).setAccessToken(t),a=[],i=[],o=[],c=function(e,t){return e.id===t.id||e.name===t.name},n.getArtistTopTracks(e.id,"CZ").then((function(t){for(var r=function(r){var s,n,l=(s=t.tracks[r],n=e.id,s.artists.reduce((function(e,t){return t.id!==n&&e.push({id:t.id,name:t.name}),e}),[]));o=o.concat(l);var u=H(t.tracks[r]),p=e.likedSongs.findIndex((function(e){return c(u,e)}));-1===p?i.push(u):(""===u.previewLink&&(u.previewLink=e.likedSongs[p].previewLink),a.push(u))},n=0;n<t.tracks.length;n++)r(n);for(var l=function(t){var r=e.likedSongs[t];-1===a.findIndex((function(e){return c(r,e)}))&&a.push(r)},u=0;u<e.likedSongs.length;u++)l(u);s(fe(o)),s(ge({likedSongs:a,notLikedSongs:i},e))})).catch((function(e){console.debug(e),s(he("During the artist data fetching, the following error occured:"+e))})).finally((function(){s(de(!1))}));case 12:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()},ye=function(e){return{type:"GRAPH_FROM_FILE_IS_LOADED",payload:e,reducer:Object(T.a)((function(t){t.isGraphFromFileLoaded=e}))}},be=function(e,t,r){for(var s=0;s<e.length;s++){var n=e[s];for(var a in n){var i=n[a],o=i.x*(r.width-r.clusterWidth-40),c=i.y*r.height;t[a]={x:o,y:c}}}},Ee=function(e,t,r,s,n,a){1!==e&&2!==e&&3!==e&&r.length;var i=r.length,o=r[0].length;e:for(var c=0;c<t.length;c++){var l=!1,u=t[c];t:for(var p=0;p<r.length;p++)for(var h=0;h<r[p].length;h++){var d=[];1===e?d=[[[p,h]]]:2===e?d=[[[p,h],[p,h+1]],[[p,h],[p+1,h]]]:3===e&&(d=[[[p,h],[p,h+1],[p+1,h+1]],[[p,h],[p+1,h],[p+1,h+1]],[[p,h],[p,h+1],[p+1,h]],[[p+1,h+1],[p,h+1],[p+1,h]]]);for(var g=0;g<d.length;g++){var m=d[g],f=m.every((function(e){var t=Object(R.a)(e,2),s=t[0],n=t[1];return s<i&&n<o&&0!==r[s][n]})),v=Object.keys(u);if(f){for(var y=0;y<e;y++){var b=s[r[m[y][0]][m[y][1]]-1];a[v[y]]={x:b.left,y:b.top},r[m[y][0]][m[y][1]]=0}l=!0;break t}}}if(!l){for(var E=c;E<t.length;E++)n.push(t[E]);break e}}},ke=function(e,t,r,s,n,a){var i=[];for(var o in e){var c=e[o];i.push({left:c.x,top:c.y,width:n.clusterWidth,height:n.clusterHeigth})}var l=xe(n.width,a,n.clusterWidth+30,n.clusterHeigth+30,i),u=l.possibleRectanglePositions,p=l.freeRectMatrix,h=[],d=[],g=[];Ee(3,s,p,u,h,e),Ee(2,r,p,u,d,e),Ee(1,t,p,u,g,e);for(var m=[],f=a,v=0,y=.7*n.clusterWidth,b=.7*n.clusterHeigth,E=.7*n.clusterWidth,k=0;k<h.length;k++){for(var S=h[k],O=Object.keys(S),j=Math.random(),x=[[E*Math.cos(j*Math.PI)+y+v,E*Math.sin(j*Math.PI)+b+f],[E*Math.cos((j+2/3)*Math.PI)+y+v,E*Math.sin((j+2/3)*Math.PI)+b+f],[E*Math.cos((j+4/3)*Math.PI)+y+v,E*Math.sin((j+4/3)*Math.PI)+b+f]],A=0;A<3;A++)e[O[A]]={x:x[A][0],y:x[A][1]},m.push({left:x[A][0],top:x[A][1],width:n.clusterWidth,height:n.clusterHeigth});var w=1.7*E+n.clusterWidth;(v+=w)+w>n.width&&(v=0,f+=w)}for(var L=0;L<d.length;L++){for(var C=d[L],N=Object.keys(C),D=[[v,f],[v+2*E,f]],M=0;M<2;M++)e[N[M]]={x:D[M][0],y:D[M][1]},m.push({left:D[M][0],top:D[M][1],width:n.clusterWidth,height:n.clusterHeigth});(v+=2*E+n.clusterWidth)>n.width-n.clusterWidth&&(v=0,f+=n.clusterHeigth+20)}f=a;for(var T=0;T<g.length;T++){for(var I=g[T],R=Object.keys(I)[0],P={top:f,left:v,width:n.clusterWidth,height:n.clusterHeigth};je(P,m);)P.left+=n.clusterWidth,P.left+n.clusterWidth>n.width&&(P.left=0,P.top+=n.clusterHeigth+20);e[R]={x:P.left,y:P.top},v=P.left+n.clusterWidth+20,f=P.top,v+n.clusterWidth>n.width&&(v=0,f+=n.clusterHeigth)}},Se=function(e,t){var r=0;for(var s in e){var n=e[s];r=n.y>r?n.y:r}return r+t},Oe=function(e,t,r,s){return e<s&&r<t},je=function(e,t){return t.reduce((function(t,r){return t||(n=e,Oe((s=r).left,s.left+s.width,n.left,n.left+n.width)&&Oe(s.top,s.top+s.height,n.top,n.top+n.height));var s,n}),!1)},xe=function(e,t,r,s,n){var a=[],i=Math.floor(e/r),o=Math.floor(t/s);i=0===i?1:i,o=0===o?1:o;for(var c=[],l=0,u=0;u<o;u++){a[u]=[];for(var p=0;p<i;p++){var h={top:u*s,left:p*r,width:r,height:s};je(h,n)?a[u][p]=0:(l+=1,a[u][p]=l,c.push(h))}}return{possibleRectanglePositions:c,freeRectMatrix:a}},Ae=r(14),we=(r(29),r(35)),Le=r(22),Ce=r.n(Le),Ne=r(34),De=function(e,t,r,s,n){var a,i,o,c;e>r?(i=r,o=e-r):(i=e,o=r-e),t>s?(a=s,c=t-s):(a=t,c=s-t);var l=c,u=0+n;return(t>s&&e>r||t<s&&e<r)&&(l=0+n,u=c),{x1fin:0+n,y1fin:l,x2fin:o,y2fin:u,top:a,left:i,hei:c,wid:o}},Me=function(e){Object(k.a)(r,e);var t=Object(S.a)(r);function r(){return Object(b.a)(this,r),t.apply(this,arguments)}return Object(E.a)(r,[{key:"render",value:function(){var e=2*this.props.weigth,t=De(this.props.x1,this.props.y1,this.props.x2,this.props.y2,e),r=t.x1fin,s=t.y1fin,a=t.x2fin,i=t.y2fin,o=t.top,c=t.left,l=t.hei,u=t.wid,p={top:o+30,left:c+this.props.artistWidth/2},h="rgb(".concat(2,", ",250,", ",240,", ",this.props.weigth/this.props.maximumEdgeWeigth,")");return n.a.createElement("svg",{style:p,className:"position-absolute",width:u+e+20,height:l+e+20},n.a.createElement("path",{d:"M ".concat(r,",").concat(s," \n                        C ").concat(r+20,",").concat(s+20," ").concat(a+20,",").concat(i+20," ").concat(a,",").concat(i),strokeWidth:e,fill:"none",stroke:h}))}}]),r}(n.a.Component),Te={lightAzureBlue:"rgb(132, 237, 243)",darkAzureBlue:"rgb(2, 109, 104)",pink:"rgb(255, 51, 153)",green:"rgb(0, 204, 0)",grey:"rgb(191, 191, 191)",orange:"rgb(242,225,31)"},Ie=(r(41),r(52),function(e){Object(k.a)(r,e);var t=Object(S.a)(r);function r(e){var s;return Object(b.a)(this,r),(s=t.call(this,e)).state={currentPositionX:e.positionX,currentPositionY:e.positionY,dragging:!1},s.onDrag=s.onDrag.bind(Object(w.a)(s)),s.onStop=s.onStop.bind(Object(w.a)(s)),s}return Object(E.a)(r,[{key:"onDrag",value:function(e,t){e.stopPropagation(),e.preventDefault(),this.setState({dragging:!0});var r=this.state.currentPositionX+t.deltaX,s=this.state.currentPositionY+t.deltaY;this.setState({currentPositionX:r,currentPositionY:s}),this.props.positionChangedCallback(r,s,this.props.artist.id)}},{key:"onStop",value:function(e){e.stopPropagation(),e.preventDefault();var t=this.state.dragging;this.setState({dragging:!1}),t||this.handleClick()}},{key:"handleClick",value:function(){if(this.props.accessToken){if(this.props.chosenArtist&&this.props.chosenArtist.id===this.props.artist.id)return;this.props.setChosenArtistDataAllFunc(this.props.artist,this.props.accessToken)}}},{key:"render",value:function(){var e=Te.lightAzureBlue;this.props.chosenArtist&&(this.props.chosenArtist.id===this.props.artist.id&&(e=Te.pink),this.props.chosenArtist.id in this.props.artistDict||-1!==this.props.chosenArtist.relatedArtistsIds.indexOf(this.props.artist.id)&&(e=Te.orange));var t={backgroundImage:"url(".concat(this.props.artist.image,")"),backgroundSize:"".concat(60,"px ").concat(60,"px"),width:"".concat(60,"px"),height:"".concat(60,"px"),borderRadius:"10px",alignSelf:"center"};return this.props.artist.score<this.props.minimumScore?n.a.createElement("div",null):n.a.createElement(Ce.a,{key:this.props.artist.id,bounds:"parent",defaultPosition:{x:this.props.positionX,y:this.props.positionY},onDrag:this.onDrag,onStop:this.onStop},n.a.createElement("div",{className:"artist-node-outer-wrapper"},n.a.createElement("div",{style:Object(Ae.a)(Object(Ae.a)({},t),{},{backgroundColor:Te.lightAzureBlue})},n.a.createElement("div",{style:t})),n.a.createElement("div",{className:"artist-node-artist-name-div",style:{backgroundColor:e}},this.props.artist.name)))}}]),r}(n.a.Component)),Re=Object(o.b)((function(e){return{accessToken:e.accessToken,chosenArtist:e.chosenArtist,artistDict:e.graph.artistDict}}),(function(e){return{setChosenArtistDataAllFunc:function(t,r){return e(ve(t,r))}}}))(Ie),Pe=(r(82),function(e){Object(k.a)(r,e);var t=Object(S.a)(r);function r(e){var s;Object(b.a)(this,r),(s=t.call(this,e)).boxRef=void 0,s.wrapperRef=void 0;var a=s.getSliderLimits(400),i=a.artistsSliderLimits,o=a.edgesSliderLimits,c=a.currSliderValue;return s.state={width:0,height:0,nodes:[],artistsPositions:{},artistSliderValue:i.minimum,edgesSliderValue:c,artistsSliderLimits:i,edgesSliderLimits:o,descriptionHover:!1,minimumEdgeWeight:.5,maximumEdges:400},s.wrapperRef=n.a.createRef(),s.boxRef=n.a.createRef(),s.positionChangedHandler=s.positionChangedHandler.bind(Object(w.a)(s)),s.changeArtistSliderValue=s.changeArtistSliderValue.bind(Object(w.a)(s)),s.changeEdgeSliderValue=s.changeEdgeSliderValue.bind(Object(w.a)(s)),s}return Object(E.a)(r,[{key:"componentDidUpdate",value:function(e,t){e.graphElements!==this.props.graphElements?this.prepareAfterGraphDataUpdate():t.artistSliderValue!==this.state.artistSliderValue&&this.prepareAfterSliderUpdate()}},{key:"componentDidMount",value:function(){this.prepareAfterGraphDataUpdate()}},{key:"prepareAfterGraphDataUpdate",value:function(){var e=this.getSliderLimits(this.state.maximumEdges),t=e.artistsSliderLimits,r=e.edgesSliderLimits,s=e.currSliderValue;this.setState({artistsSliderLimits:t,edgesSliderLimits:r,artistSliderValue:t.minimum,edgesSliderValue:s});var n=this.boxRef.current.clientWidth,a=this.boxRef.current.clientHeight;this.setState({width:n,height:a});var i=this.createNodes(n,a);this.setState({nodes:i.nodes,artistsPositions:i.positions})}},{key:"prepareAfterSliderUpdate",value:function(){for(var e=[],t=0;t<this.props.graphElements.nodes.length;t++){var r=this.props.graphElements.nodes[t];e.push(n.a.createElement(Re,{key:r.artist.id,positionChangedCallback:this.positionChangedHandler,positionX:this.state.artistsPositions[r.artist.id].x,positionY:this.state.artistsPositions[r.artist.id].y,artist:r.artist,minimumScore:this.state.artistSliderValue}))}this.setState({nodes:e})}},{key:"createNodes",value:function(e,t){for(var r=[],s={},a=0;a<this.props.graphElements.nodes.length;a++){var i=this.props.graphElements.nodes[a],o=i.position.x*(e-100-30)+15,c=i.position.y*(t-100-30)+15;s[i.artist.id]={x:o,y:c},r.push(n.a.createElement(Re,{key:i.artist.id,positionChangedCallback:this.positionChangedHandler,positionX:o,positionY:c,artist:i.artist,minimumScore:this.state.artistSliderValue}))}return{nodes:r,positions:s}}},{key:"getSliderLimits",value:function(e){for(var t={minimum:1e3,maximum:-1e3},r={minimum:1e3,maximum:-1e3},s=0;s<this.props.graphElements.nodes.length;s++){var n=this.props.graphElements.nodes[s].artist.score;t.maximum=n>t.maximum?n:t.maximum,t.minimum=n<t.minimum?n:t.minimum}var a=this.props.graphElements.edges.map((function(e){return e.weigth})).sort((function(e,t){return e-t}));r.minimum=a[0],r.maximum=a[a.length-1],t.maximum=Math.ceil(t.maximum),t.minimum=Math.ceil(t.minimum)-1,r.maximum=Math.ceil(r.maximum),r.minimum=Math.ceil(r.minimum)-1;var i=a.length;return{artistsSliderLimits:t,edgesSliderLimits:r,currSliderValue:i>e?a[i-e]+.1:r.minimum}}},{key:"positionChangedHandler",value:function(e,t,r){if(null==this.state.artistsPositions)return[];var s=this.state.artistsPositions;s[r]={x:e,y:t},this.setState({artistsPositions:s})}},{key:"createEdges",value:function(){var e=[];if(null==this.state.artistsPositions)return[];try{for(var t=0;t<this.props.graphElements.edges.length;t++){var r=this.props.graphElements.edges[t],s=r.id1,a=r.id2,i=r.weigth,o=s+a,c=this.props.idArtistDict[s],l=this.props.idArtistDict[a];c!==l&&i>this.state.edgesSliderValue&&i>this.state.minimumEdgeWeight&&c.score>=this.state.artistSliderValue&&l.score>=this.state.artistSliderValue&&e.push(n.a.createElement(Me,{key:o,x1:this.state.artistsPositions[s].x,y1:this.state.artistsPositions[s].y,x2:this.state.artistsPositions[a].x,y2:this.state.artistsPositions[a].y,weigth:r.weigth,artistWidth:70,maximumEdgeWeigth:this.state.edgesSliderLimits.maximum}))}}catch(u){e.push(n.a.createElement("div",null))}return e}},{key:"changeArtistSliderValue",value:function(e){this.setState({artistSliderValue:e.currentTarget.valueAsNumber})}},{key:"createArtistSlider",value:function(){var e=this.state.artistsSliderLimits.minimum,t=this.state.artistsSliderLimits.maximum;return n.a.createElement("div",{className:"inner-slider-wrapper"},n.a.createElement("input",{type:"range",min:e,max:t,step:(t-e)/10,value:this.state.artistSliderValue,onChange:this.changeArtistSliderValue,className:"slider-input"}))}},{key:"changeEdgeSliderValue",value:function(e){this.setState({edgesSliderValue:e.currentTarget.valueAsNumber})}},{key:"createEdgeSlider",value:function(){var e=Math.max(this.state.edgesSliderLimits.minimum,this.state.minimumEdgeWeight),t=this.state.edgesSliderLimits.maximum;return n.a.createElement("div",{className:"inner-slider-wrapper"},n.a.createElement("input",{type:"range",min:e,max:t,step:(t-e)/10,value:this.state.edgesSliderValue,onChange:this.changeEdgeSliderValue,className:"slider-input"}))}},{key:"changeHover",value:function(){this.setState({descriptionHover:!this.state.descriptionHover})}},{key:"getDraggableSlider",value:function(){var e=this,t=this.state.descriptionHover?{}:{display:"none"};return n.a.createElement(Ce.a,{handle:"strong",bounds:"parent"},n.a.createElement("div",{className:"draggable-slider-div"},n.a.createElement("div",null,n.a.createElement("div",{className:"outer-slider-wrapper"},this.createEdgeSlider(),"edges"),n.a.createElement("div",{className:"outer-slider-wrapper"},this.createArtistSlider(),"artists")),n.a.createElement(Ne.a,{onMouseEnter:function(){return e.changeHover()},onMouseLeave:function(){return e.changeHover()},size:30}),n.a.createElement("strong",null,n.a.createElement(we.b,{size:30})),n.a.createElement("div",{className:"slider-description",style:t},n.a.createElement("p",null,"Drag the sliders to control how many edges and artists will be shown."),n.a.createElement("p",null,"The artists will be hidden in the order based on their importance to you - less important first, more important remainig."),n.a.createElement("p",null,"The importance takes into account these factors: how many their songs you like, if you follow them and popularity on Spotify."),n.a.createElement("p",null,'The score of an edge between two artists is calculated from the number of common genres and Spotify "related artists" information.'))))}},{key:"render",value:function(){return n.a.createElement("div",{className:"noselect chosen-cluster-wrapper",ref:this.wrapperRef},n.a.createElement("div",{className:"insideClusterBox",ref:this.boxRef,style:{width:this.state.width}},this.getDraggableSlider(),0!==this.state.width&&0!==this.state.nodes.length&&this.createEdges(),0!==this.state.width&&this.state.nodes))}}]),r}(n.a.Component)),ze=Object(o.b)((function(e){return{idArtistDict:e.graph.artistDict}}),{})(Pe),Ge=r(37),Ue=r(46),He=r(58),We=(r(83),function(e){Object(k.a)(r,e);var t=Object(S.a)(r);function r(e){var s;Object(b.a)(this,r);var n=(s=t.call(this,e)).prepareSongs(),a=n.liked,i=n.notLiked;return s.state={chosenSongId:"",likedSongs:a,notLikedSongs:i},s}return Object(E.a)(r,[{key:"setChosenSong",value:function(e){e===this.state.chosenSongId?this.setState({chosenSongId:""}):this.setState({chosenSongId:e})}},{key:"componentDidUpdate",value:function(e,t){e.chosenArtistData!==this.props.chosenArtistData&&this.props.chosenArtistData&&this.setState({chosenSongId:"",likedSongs:this.props.chosenArtistData.likedSongs,notLikedSongs:this.props.chosenArtistData.notLikedSongs})}},{key:"prepareSongs",value:function(){if(!this.props.chosenArtistData||Object(C.isUndefined)(this.props.chosenArtist))return{liked:[],notLiked:[]};for(var e=[],t=[],r=0;r<this.props.chosenArtistData.likedSongs.length;r++){var s=this.props.chosenArtistData.likedSongs[r];this.props.chosenArtist.likedSongs&&!e.includes(s)?e.push(s):t.includes(s)||t.push(s)}return console.debug("liked:",e),console.debug("liked by artist",this.props.chosenArtist.likedSongs),console.debug("not liked:",t),{liked:e,notLiked:t}}},{key:"getSongDiv",value:function(e,t){var r=this,s=this.state.chosenSongId===e.id?{maxHeight:80}:{maxHeight:0},a=n.a.createElement(Ge.b,{size:40,onClick:function(t){t.stopPropagation(),r.props.setSongToPlay(e)}}),i=Te.lightAzureBlue;this.props.songToPlay&&this.props.songToPlay.id===e.id&&(i=Te.pink,a=this.props.paused?n.a.createElement(Ge.b,{size:40,onClick:function(e){e.stopPropagation(),r.props.setPause(!1)}}):n.a.createElement(Ge.a,{size:40,onClick:function(e){e.stopPropagation(),r.props.setPause(!0)}}));var o=Te.lightAzureBlue;return t&&(o=Te.green),(""===e.previewLink||null===e.previewLink||Object(C.isUndefined)(e.previewLink))&&(a=n.a.createElement(He.a,{size:40,onClick:function(e){e.stopPropagation(),alert("No preview found on Spotify")}}),i=Te.grey),n.a.createElement("div",{key:e.id,className:"flex-column song-div",style:{backgroundColor:i}},n.a.createElement("div",{className:"song-preview",style:{backgroundColor:o},onClick:function(){return r.setChosenSong(e.id)}},n.a.createElement("div",{className:"pointer",style:{marginRight:"5px",display:"inline-flex",flexDirection:"column",justifyContent:"center",alignContent:"center"}},a),n.a.createElement("div",{className:"song-wrapper"},e.name)),n.a.createElement("div",{className:"song-description",style:s},n.a.createElement("div",{className:"full-song-link-div",onClick:function(){window.open(e.externalUrl)}},n.a.createElement(Ue.b,null),"Full song"),!t&&n.a.createElement("div",{className:"full-song-link-div",onClick:function(){r.props.spotifyApiObject.addToMySavedTracks([e.id]).then((function(){console.debug("TRACK SAVED");var t=r.state.likedSongs;t=t.concat(e);var s=r.state.notLikedSongs.filter((function(t){return t.id!==e.id}));r.setState({likedSongs:t,notLikedSongs:s})})).catch((function(e){console.debug("THIS ERROR DURING TRACK SAVING OCCURED:",e)}))}},n.a.createElement(Ue.a,null),"Save to liked songs")))}},{key:"getSongsDivs",value:function(e,t){if(!e)return[];for(var r=[],s=0;s<e.length;s++)r.push(this.getSongDiv(e[s],t));return r}},{key:"render",value:function(){return this.props.chosenArtistError?n.a.createElement("div",{className:"chosen-artist-bar"},n.a.createElement("h2",null,n.a.createElement("i",null,this.props.chosenArtistError))):Object(C.isUndefined)(this.props.chosenArtist)||Object(C.isUndefined)(this.props.chosenArtistData)?n.a.createElement("div",{className:"chosen-artist-bar"},n.a.createElement("h2",null,"CLICK SOME ARTIST")):this.props.chosenArtistLoading?n.a.createElement("div",{className:"chosen-artist-bar"},n.a.createElement("h2",null,"LOADING...")):n.a.createElement("div",{className:"chosen-artist-bar"},n.a.createElement("div",{className:"chosen-artist-bar-top"},n.a.createElement("h1",{style:{margin:0}},this.props.chosenArtist.name),n.a.createElement("div",{style:{backgroundImage:"url(".concat(this.props.chosenArtist.image,")"),width:70,height:70,borderRadius:"".concat(20,"%"),backgroundSize:"70px 70px",display:"inline-grid"}}),this.props.chosenArtist.isFollowed&&n.a.createElement("h2",{style:{margin:"5px 0px 0px 0px"}},"You are following this artist.")),n.a.createElement("div",{className:"chosen-artist-bar-scroll"},this.getSongsDivs(this.state.likedSongs,!0),this.getSongsDivs(this.state.notLikedSongs,!1)))}}]),r}(n.a.Component)),_e=Object(o.b)((function(e){return{songToPlay:e.songToPlay,chosenArtist:e.chosenArtist,chosenArtistLoading:e.chosenArtistLoading,chosenArtistError:e.chosenArtistError,chosenArtistData:e.chosenArtistData,spotifyApiObject:e.spotifyWebApiObject,paused:e.paused}}),(function(e){return{setPause:function(t){return e(me(t))},setSongToPlay:function(t){return e(function(e){return{type:"SET_SONG_TO_PLAY",payload:e,reducer:Object(T.a)((function(t){t.songToPlay&&t.songToPlay.id===e.id||(t.songToPlay=e,t.paused=!1)}))}}(t))}}}))(We),Fe=(r(84),function(e){Object(k.a)(r,e);var t=Object(S.a)(r);function r(e){var s;return Object(b.a)(this,r),(s=t.call(this,e)).state={questionMarkHover:!1,artistsToRecommend:[]},s.getArtistsToRecommend(),s}return Object(E.a)(r,[{key:"getArtistsToRecommend",value:function(){var e=this,t=this.getCounter(this.props.clusterArtistsIds.map((function(t){return e.props.artistDict[t]})));console.debug("COUNTER",t);var r=this.getTopIds(t);if(0===r.length)return n.a.createElement("div",null);var s=V(this.props.sp,r);Promise.resolve(s).then((function(r){for(var s=[],n=0;n<r.length;n++){var a=r[n],i=a.images&&a.images.length>0?a.images[a.images.length-1].url:"";s.push({genres:a.genres,id:a.id,name:a.name,relatedArtistsIds:t[a.id].related,image:i,isFollowed:!1,likedSongs:[],score:1})}e.setState({artistsToRecommend:s})}))}},{key:"getCounter",value:function(e){for(var t={},r=0;r<e.length;r++)for(var s=e[r],n=0;n<s.relatedArtistsIds.length;n++){var a=s.relatedArtistsIds[n];if(!(a in this.props.artistDict))if(a in t){var i=t[a];t[a]={count:i.count+1,related:i.related.concat([s.id])}}else t[a]={count:1,related:[s.id]}}return t}},{key:"getTopIds",value:function(e){for(var t=Object.keys(e),r=Object.values(e),s=[],n=0;n<t.length;n++){var a=t[n],i=r[n];s.push({id:a,count:i.count,related:i.related})}s.sort((function(e,t){return t.count-e.count}));for(var o=[],c=0;c<15&&!(c>=s.length)&&!(s[c].count<2);c++)o.push(s[c]);return o.map((function(e){return e.id}))}},{key:"componentDidMount",value:function(){}},{key:"componentDidUpdate",value:function(){}},{key:"createRecommendArtistDiv",value:function(e){var t=this,r=Te.darkAzureBlue;this.props.chosenArtist&&this.props.chosenArtist.id===e.id&&(r=Te.pink);var s={backgroundColor:r,display:"flex",padding:"".concat(2,"px"),height:"".concat(64,"px"),borderRadius:"10px",margin:"0px 1px 0px 1px"},a={backgroundImage:"url(".concat(e.image,")"),backgroundSize:"".concat(60,"px ").concat(60,"px"),width:"".concat(60,"px"),height:"".concat(60,"px"),borderRadius:"10px",alignSelf:"center",margin:"2px"},i=Object(C.isUndefined)(this.props.accessToken)?"":this.props.accessToken;return n.a.createElement("div",{style:s,title:e.name,onClick:function(){t.props.updateNotFavouriteArtists([e]),t.props.setChosenArtistDataAll(e,i)}},n.a.createElement("div",{style:Object(Ae.a)(Object(Ae.a)({},a),{},{borderColor:Te.lightAzureBlue})}))}},{key:"changeHover",value:function(){this.setState({questionMarkHover:!this.state.questionMarkHover})}},{key:"render",value:function(){var e=this;if(0===this.state.artistsToRecommend.length)return n.a.createElement("div",{className:"recommendation-panel"},n.a.createElement("div",{style:{flex:"1 1 auto",textAlign:"center"}},n.a.createElement("p",{style:{margin:"0px"}},"No artists to recommend"),n.a.createElement("p",null,"Either there are not enough artists in this cluster, or they are not really related.")));var t=this.state.artistsToRecommend.map((function(t){return e.createRecommendArtistDiv(t)})),r=this.state.questionMarkHover?{}:{display:"none"};return n.a.createElement("div",null,n.a.createElement("div",{className:"you-might-like-description",style:Object(Ae.a)({},r)},n.a.createElement("p",null,"Based on the artists in the current cluster, you could like the following artists."),n.a.createElement("p",null,"After some of the artists is clicked, their related artists are highlighted yellow in the graph.")),n.a.createElement("div",{className:"you-might-like"},n.a.createElement("b",null,"You might also like:"),n.a.createElement(Ne.a,{onMouseEnter:function(){return e.changeHover()},onMouseLeave:function(){return e.changeHover()},size:25})),n.a.createElement("div",{className:"recommendation-panel"},t))}}]),r}(n.a.Component)),Ye=Object(o.b)((function(e){return{artistDict:e.graph.artistDict,sp:e.spotifyWebApiObject,accessToken:e.accessToken,chosenArtist:e.chosenArtist}}),(function(e){return{setChosenArtistDataAll:function(t,r){return e(ve(t,r))},updateNotFavouriteArtists:function(t){return e(fe(t))}}}))(Fe),Ve=function(e){Object(k.a)(r,e);var t=Object(S.a)(r);function r(e){var s;return Object(b.a)(this,r),(s=t.call(this,e)).onClick=function(){s.props.closeChosenClusterGraph(),s.props.closeChosenArtist()},s.state={elements:s.getChosenClusterGraphElements(s.props.chosenCluster)},s}return Object(E.a)(r,[{key:"getChosenClusterGraphElements",value:function(e){for(var t=[],r=[],s=0;s<e.artistsIds.length;s++){var n=e.artistsIds[s],a=e.artistsPositions[n];t.push({artist:this.props.artistDict[n],position:{x:a.x,y:a.y}})}for(var i=0;i<this.props.artistEdges.length;i++){var o=this.props.artistEdges[i].id1,c=this.props.artistEdges[i].id2;e.artistsIds.includes(o)&&e.artistsIds.includes(c)&&r.push({id:o+c,id1:o,id2:c,weigth:this.props.artistEdges[i].weight})}return{nodes:t,edges:r}}},{key:"getSimilarClusters",value:function(){for(var e=this,t=this.props.chosenCluster.id,r=[],n=0;n<this.props.clusterEdges.length;n++){var a=this.props.clusterEdges[n];a.id2===a.id1||a.id1!==t&&a.id2!==t||r.push(a)}r.sort((function(e,t){return e.weight>t.weight?-1:1}));for(var i=[],o={width:"".concat(60,"px"),height:"".concat(60,"px"),backgroundSize:"".concat(60,"px ").concat(60,"px")},c=0;c<r.length;c++){var l=r[c];l.weight>2&&function(){for(var r=t===l.id1?l.id2:l.id1,n=e.props.clusters[e.props.clusters.map((function(e){return e.id})).indexOf(r)],a=[],c=0;c<Math.min(n.artistsIds.length,3);c++){var u=n.artistsIds[c],p=e.props.artistDict[u],h=Object(Ae.a)(Object(Ae.a)({},o),{},{backgroundImage:"url(".concat(p.image,")")});a.push(s.createElement("div",{className:"artistWrapper"},s.createElement("div",{title:p.name,style:h,className:"artistDiv"})))}i.push(s.createElement("div",{className:"similar-cluster-div padding-margin pointer",onClick:function(){e.props.closeChosenArtist(),e.props.setChosenCluster(n),e.setState({elements:e.getChosenClusterGraphElements(n)})}},s.createElement("p",null,"Similar to: ",n.genres[0]),s.createElement("div",{className:"artistsRow"},a)))}()}return i}},{key:"render",value:function(){var e=this.getSimilarClusters();return s.createElement("div",{className:"chosen-cluster-div"},s.createElement("div",{className:"chosen-cluster-column"},s.createElement("div",{className:"similar-cluster-row"},s.createElement("div",{className:"go-back-div padding-margin pointer",onClick:this.onClick},s.createElement(we.a,{size:50}),s.createElement("h3",{className:"h3-no-padding"},"Go back to the graph")),e),s.createElement("div",{className:"chosen-cluster-graph-div"},s.createElement(ze,{graphElements:this.state.elements})),s.createElement(Ye,{clusterArtistsIds:this.props.chosenCluster.artistsIds})),s.createElement(_e,null))}}]),r}(s.Component),Xe=Object(o.b)((function(e){return{artistEdges:e.graph.artistEdges,clusters:e.graph.clusters,clusterEdges:e.graph.clusterEdges,artistDict:e.graph.artistDict}}),{closeChosenClusterGraph:function(){return{type:"CLOSE_CHOSEN_CLUSTER_GRAPH",reducer:Object(T.a)((function(e){e.chosenCluster=void 0}))}},closeChosenArtist:function(){return{type:"CLOSE_CHOSEN_ARTIST",reducer:Object(T.a)((function(e){e.chosenArtist=void 0}))}},setChosenCluster:ae})(Ve),Be=r(59),Qe=r(85);Qe.registerLocale(r(88));var qe=function(e){Object(k.a)(r,e);var t=Object(S.a)(r);function r(e){var s;return Object(b.a)(this,r),(s=t.call(this,e)).state={positionX:e.positionX,positionY:e.positionY,dragging:!1,fontSizeDefault:12},s.onDrag=s.onDrag.bind(Object(w.a)(s)),s.onStop=s.onStop.bind(Object(w.a)(s)),s}return Object(E.a)(r,[{key:"componentDidUpdate",value:function(e,t){e.positionX!==this.props.positionX&&this.setState({positionX:this.props.positionX})}},{key:"onDrag",value:function(e,t){e.stopPropagation(),e.preventDefault();var r=this.state.positionX,s=this.state.positionY,n=r+t.deltaX,a=s+t.deltaY;this.setState({dragging:!0,positionX:n,positionY:a}),this.props.positionChanged(n,a,this.props.cluster.id)}},{key:"onStop",value:function(e){e.stopPropagation(),e.preventDefault();var t=this.state.dragging;this.setState({dragging:!1}),t||this.handleClick(e)}},{key:"handleClick",value:function(e){this.props.setChosenCluster(this.props.cluster)}},{key:"createArtistWrapper",value:function(e,t,r){return n.a.createElement("div",{key:r,className:"artistWrapper"},n.a.createElement("div",{className:"colourWrapper"},n.a.createElement("div",{title:e,style:t,className:"artistDiv"})))}},{key:"createEmptyWrapper",value:function(e){return n.a.createElement("div",{key:e,className:"artistWrapper"},n.a.createElement("div",null))}},{key:"clusterDiv",value:function(){for(var e=this.props.clusterWidth/4.6,t={width:"".concat(e,"px"),height:"".concat(e,"px"),backgroundSize:"".concat(e,"px ").concat(e,"px")},r=[],s=this.props.cluster.artistsIds.length,a=0,i=[],o=0;o<Math.min(s,4);o++){var c=this.props.artistDict[this.props.cluster.artistsIds[o]],l=Object(Ae.a)(Object(Ae.a)({},t),{},{backgroundImage:"url(".concat(c.image,")")});i.push(this.createArtistWrapper(c.name,l,a++))}if(r.push(n.a.createElement("div",{key:1,className:"artistsRow"},i)),i=[],s>4){i.push(this.createEmptyWrapper(a++)),i.push(this.createEmptyWrapper(a++));for(var u=4;u<Math.min(6,s);u++){var p=this.props.artistDict[this.props.cluster.artistsIds[u]],h=Object(Ae.a)(Object(Ae.a)({},t),{},{backgroundImage:"url(".concat(p.image,")")});i.push(this.createArtistWrapper(p.name,h,a++))}if(s>6){var d=Object(Ae.a)(Object(Ae.a)({},t),{},{backgroundImage:"url(".concat("/spotifygraph/three-dots.png",")")});i.push(this.createArtistWrapper("AND OTHERS",d,a++))}i.push(this.createEmptyWrapper(a++)),i.push(this.createEmptyWrapper(a++)),r.push(n.a.createElement("div",{key:2,className:"artistsRow"},i))}var g="",m=this.props.cluster.genres.length;if(0===m)g="...unknown genre...";else for(var f=0;f<Math.min(m,this.props.fontSizeConst+1);f++)g+=0===f?this.props.cluster.genres[f]:", "+this.props.cluster.genres[f];var v={width:"".concat(this.props.clusterWidth,"px")};return n.a.createElement("div",{className:"nodeWrapper",style:v},this.props.cluster.country&&n.a.createElement("div",{style:{position:"absolute",margin:0,left:0,opacity:.4,zIndex:-1,alignItems:"center"}},n.a.createElement(Be.a,{countryCode:Qe.alpha3ToAlpha2(this.props.cluster.country),svg:!0,style:{width:this.props.clusterWidth+30,height:"260px"}})),n.a.createElement("div",{className:"nodeHeader"},n.a.createElement("div",{className:"header noselect",style:{fontSize:this.state.fontSizeDefault/this.props.fontSizeConst+this.props.fontSizeConst}},g)),r)}},{key:"render",value:function(){var e=this.clusterDiv();return n.a.createElement(Ce.a,{onDrag:this.onDrag,onStop:this.onStop,onStart:function(e){e.stopPropagation(),e.preventDefault()},bounds:"parent",defaultPosition:{x:this.props.positionX,y:this.props.positionY},position:{x:this.state.positionX,y:this.state.positionY}},e)}}]),r}(n.a.Component),Je=Object(o.b)((function(e){return{artistDict:e.graph.artistDict}}),{setChosenCluster:ae})(qe),Ze=function(e){Object(k.a)(r,e);var t=Object(S.a)(r);function r(){return Object(b.a)(this,r),t.apply(this,arguments)}return Object(E.a)(r,[{key:"render",value:function(){var e=this.props.weigth,t=De(this.props.x1,this.props.y1,this.props.x2,this.props.y2,e),r=t.x1fin,s=t.y1fin,a=t.x2fin,i=t.y2fin,o=t.top,c=t.left,l=t.hei,u=t.wid,p={top:o+30,left:c+this.props.clusterWidth/2};return n.a.createElement("svg",{style:p,className:"position-absolute",width:u+e+20,height:l+e+20},n.a.createElement("path",{d:"M ".concat(r,",").concat(s,"\n                        C ").concat(r+20,",").concat(s+20," ").concat(a+20,",").concat(i+20," ").concat(a,",").concat(i),strokeWidth:e,fill:"none",stroke:"black"}))}}]),r}(n.a.Component),Ke=function(e){Object(k.a)(r,e);var t=Object(S.a)(r);function r(e){return Object(b.a)(this,r),t.call(this,e)}return Object(E.a)(r,[{key:"render",value:function(){return n.a.createElement("div",{className:"progressbar"},n.a.createElement("div",{className:"progress",style:{width:"".concat(100*this.props.progress,"%")}}))}}]),r}(n.a.Component),$e=(r(53),function(e){Object(k.a)(r,e);var t=Object(S.a)(r);function r(e){var s;return Object(b.a)(this,r),(s=t.call(this,e)).boxRef=void 0,s.wrapperRef=void 0,s.state={clusterWidth:150,clusterHeight:150,currentScale:1,originalRefHeight:0,originalRefWidth:0},s.wrapperRef=n.a.createRef(),s.boxRef=n.a.createRef(),s.positionChangedHandler=s.positionChangedHandler.bind(Object(w.a)(s)),s}return Object(E.a)(r,[{key:"positionChangedHandler",value:function(e,t,r){if(null==this.state.clusterPositions)return[];var s=this.state.clusterPositions;s[r]={x:e,y:t},this.setState({clusterPositions:s})}},{key:"graphLoadedCallback",value:function(e,t){var r=this.state.clusterWidth,s=this.state.clusterHeight,n=t;this.props.graph.clusters.length<15?n-=s+20:this.props.graph.clusters.length>30&&(n+=s);var a=function(e,t,r,s,n){var a={};e-=15;for(var i=[],o=[],c=[],l=[],u=0;u<n.length;u++){var p=n[u],h=Object.keys(p).length;1===h?i.push(p):2===h?o.push(p):3===h?c.push(p):l.push(p)}var d={width:e,height:t,clusterWidth:r+25,clusterHeigth:s+10};be(l,a,d);var g=Se(a,s);return ke(a,i,o,c,d,g),a}(e,n,r,s,this.props.graph.clusterSquares),i=Se(a,s);(this.state.dimensions?this.state.dimensions:{w:500,h:1e3}).h=i,this.setState({clusterPositions:a})}},{key:"onResizeRecomputePositions",value:function(){if(!Object(C.isUndefined)(this.state.dimensions)&&!Object(C.isUndefined)(this.state.clusterPositions)){var e=this.state.dimensions.w,t=this.state.dimensions.h,r=this.wrapperRef.current.clientWidth;if(e!==r){var s=this.state.clusterPositions,n=Math.floor(r/e*1024)/1024;for(var a in s)s[a].x=n*s[a].x;this.setState({dimensions:{w:r,h:t},clusterPositions:s})}}}},{key:"componentDidMount",value:function(){var e=this;window.addEventListener("resize",(function(){e.onResizeRecomputePositions()}));var t=this.wrapperRef.current.clientWidth,r=this.wrapperRef.current.clientHeight;this.setState({dimensions:{w:t,h:r},originalRefWidth:t,originalRefHeight:r},(function(){return e.props.loadGraph(e.props.accessToken,e.props.sp,(function(){return e.graphLoadedCallback(t,r)}))}))}},{key:"componentDidUpdate",value:function(e,t){if(this.props.isGraphFromFileLoaded){var r=500,s=500;Object(C.isUndefined)(this.state.dimensions)||(r=this.state.dimensions.w,s=this.state.dimensions.h),s=this.state.originalRefHeight,this.graphLoadedCallback(r,s),this.props.graphFromFileIsLoaded(!1)}}},{key:"createNodes",value:function(){if(null===this.state.clusterPositions||Object(C.isUndefined)(this.state.clusterPositions))return[];for(var e=[],t=0;t<this.props.graph.clusters.length;t++){var r=this.props.graph.clusters[t];e.push(n.a.createElement(Je,{key:r.id,fontSizeConst:this.state.currentScale,cluster:r,positionX:this.state.clusterPositions[r.id].x,positionY:this.state.clusterPositions[r.id].y,positionChanged:this.positionChangedHandler,clusterWidth:this.state.clusterWidth}))}return e}},{key:"createEdges",value:function(){var e=[];if(null==this.state.clusterPositions)return[];for(var t=0;t<this.props.graph.clusterEdges.length;t++){var r=this.props.graph.clusterEdges[t].id1,s=this.props.graph.clusterEdges[t].id2,a=r+s;if(r!==s){var i=3*Math.log2(this.props.graph.clusterEdges[t].weight);e.push(n.a.createElement(Ze,{key:a,x1:this.state.clusterPositions[r].x,y1:this.state.clusterPositions[r].y,x2:this.state.clusterPositions[s].x,y2:this.state.clusterPositions[s].y,weigth:i,clusterWidth:this.state.clusterWidth}))}}return e}},{key:"createGraphLoadingDiv",value:function(){return n.a.createElement("div",{className:"page-wrapper"},n.a.createElement("div",{className:"generic-description"},this.props.graphLoadingMessage),n.a.createElement(Ke,{progress:this.props.graphLoadingRelatedArtistsProgress}))}},{key:"createSpotifyErrorDiv",value:function(){var e="Error while loading!\n\n";return this.props.graphLoadingErrorMessage&&(e+=this.props.graphLoadingErrorMessage),n.a.createElement("div",{className:"page-wrapper"},n.a.createElement("div",{className:"generic-description"},e))}},{key:"render",value:function(){var e=this;if(this.props.graphLoading)return this.createGraphLoadingDiv();if(this.props.isGraphLoadingError)return this.createSpotifyErrorDiv();var t=void 0!==this.props.chosenCluster,r=t?"none":"",s=this.state.dimensions?this.state.dimensions.w:500,a=this.state.dimensions?this.state.dimensions.h:500;return n.a.createElement("div",{className:"wrapper",ref:this.wrapperRef},n.a.createElement(L.b,{defaultScale:1,defaultPositionX:1,defaultPositionY:1,options:{maxScale:4,limitToWrapper:!0},onWheelStop:function(t){e.setState({currentScale:t.scale})}},(function(i){i.zoomIn,i.zoomOut,i.setTransform,Object(A.a)(i,["zoomIn","zoomOut","setTransform"]);return n.a.createElement(n.a.Fragment,null,t&&n.a.createElement(Xe,{key:e.props.chosenCluster.id,chosenCluster:e.props.chosenCluster}),n.a.createElement(L.a,null,n.a.createElement("div",{className:"box",ref:e.boxRef,style:{width:s,height:a,display:r}},e.state.dimensions&&e.createEdges(),e.state.dimensions&&e.createNodes())))})))}}]),r}(n.a.Component)),et=Object(o.b)((function(e){return{graphLoaded:e.graphLoaded,graphLoading:e.graphLoading,isGraphLoadingError:e.isGraphLoadingError,graphLoadingMessage:e.graphLoadingMessage,graphLoadingErrorMessage:e.graphLoadingErrorMessage,graphLoadingRelatedArtistsProgress:e.graphLoadingRelatedArtistsProgress,graph:e.graph,chosenCluster:e.chosenCluster,accessToken:e.accessToken,sp:e.spotifyWebApiObject,isGraphFromFileLoaded:e.isGraphFromFileLoaded}}),(function(e){return{setGraph:ie,graphFromFileIsLoaded:function(t){return e(ye(t))},loadGraph:function(t,r,s){return e(function(e,t,r){return function(){var s=Object(M.a)(D.a.mark((function s(n){return D.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:n(oe()),Q(e,t,(function(e){n(ce(e))}),(function(e){n(ue(e))}),(function(e){n(le(e))})).then((function(e){return n(ie(e))})).then((function(){return r()})).then((function(){return n(pe())})).catch((function(e){console.debug(e),n({type:"GRAPH_LOADING_ERROR",reducer:Object(T.a)((function(e){e.graphLoading=!1,e.isGraphLoadingError=!0}))})}));case 2:case"end":return s.stop()}}),s)})));return function(e){return s.apply(this,arguments)}}()}(t,r,s))}}}))($e),tt=function(e){Object(k.a)(r,e);var t=Object(S.a)(r);function r(e){var s;return Object(b.a)(this,r),(s=t.call(this,e)).playerRef=void 0,s.playerRef=n.a.createRef(),s}return Object(E.a)(r,[{key:"componentDidUpdate",value:function(){null!==this.playerRef.current&&(this.props.paused?this.playerRef.current.pause():this.playerRef.current.play())}},{key:"render",value:function(){var e=this;if(Object(C.isUndefined)(this.props.accessToken))return n.a.createElement("div",null);if(Object(C.isUndefined)(this.props.songToPlay))return n.a.createElement("div",{className:"empty-player"},n.a.createElement("div",{className:"generic-description-small-margin"},"Choose some artist and some song and listen to a preview"));for(var t,r=[],s=0;s<this.props.songToPlay.artistsIds.length;s++){var a=this.props.songToPlay.artistsIds[s];a in this.props.favouriteArtistDict?r.push(this.props.favouriteArtistDict[a].name):a in this.props.nonFavouriteArtistDict?r.push(this.props.nonFavouriteArtistDict[a].name):r.push(a)}var i=r.join(", ");return t=null==this.props.songToPlay.previewLink?"":this.props.songToPlay.previewLink,n.a.createElement("div",{className:"player"},n.a.createElement("div",{className:"flex1"},n.a.createElement("p",{className:"playingSongName"},n.a.createElement("b",null,this.props.songToPlay.name)),n.a.createElement("p",{className:"playingSongArtists"},i)),n.a.createElement("audio",{onPlay:function(){return e.props.setPaused(!1)},onPause:function(){return e.props.setPaused(!0)},ref:this.playerRef,autoPlay:!0,controls:!0,src:t,className:"playerControls"},"Your browser does not support the",n.a.createElement("code",null,"audio")," element."))}}]),r}(n.a.Component),rt=Object(o.b)((function(e){return{paused:e.paused,accessToken:e.accessToken,songToPlay:e.songToPlay,favouriteArtistDict:e.graph.artistDict,nonFavouriteArtistDict:e.nonFavouriteArtistDict}}),{setPaused:me})(tt),st=(r(89),function(e){Object(k.a)(r,e);var t=Object(S.a)(r);function r(){return Object(b.a)(this,r),t.apply(this,arguments)}return Object(E.a)(r,[{key:"render",value:function(){return s.createElement("div",{className:"mainDiv"},s.createElement("div",{className:"mainDivContent"},s.createElement(et,null)),s.createElement(rt,null))}}]),r}(s.Component)),nt=(r(90),function(e){Object(k.a)(r,e);var t=Object(S.a)(r);function r(e){var s;return Object(b.a)(this,r),(s=t.call(this,e)).dowloadGraph=s.dowloadGraph.bind(Object(w.a)(s)),s.uploadGraph=s.uploadGraph.bind(Object(w.a)(s)),s}return Object(E.a)(r,[{key:"dowloadGraph",value:function(){if(this.props.graph){var e=document.createElement("a");e.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(JSON.stringify(this.props.graph,null,4))),e.setAttribute("download","mySpotifyGraph.json"),e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e)}}},{key:"uploadGraph",value:function(e){var t=this,r="Sorry, this file seems to be not in the correct format.\n Error:";console.log(e);var s=e[0],n=new FileReader;n.onload=function(e){if(null!==e.target&&null!==e.target.result)try{var s=e.target.result.toString();!function(e){t.props.loadGraphFromFile(e)}(Object(C.isUndefined)(s)?{}:JSON.parse(s))}catch(n){alert(r+n),console.debug("error while graph loading from file:",n)}else alert(r)},n.readAsText(s)}},{key:"createChosenClusterArtists",value:function(){var e=this;return Object(C.isUndefined)(this.props.chosenCluster)?s.createElement("div",null):s.createElement("ul",null,this.props.chosenCluster.artistsIds.map((function(t){return s.createElement("li",{className:"shift-left"},e.props.artistDict[t].name)})))}},{key:"createChosenClusterGenres",value:function(){var e=[];return void 0!==this.props.chosenCluster&&(e=this.props.chosenCluster.genres.map((function(e){return s.createElement("li",{className:"shift-left"},e)}))),s.createElement("ul",null,e)}},{key:"render",value:function(){var e=this;return s.createElement("div",{className:"sideBar"},s.createElement("div",{className:"sideBarHeader"},s.createElement("img",{width:40,height:40,className:"spotify-image",alt:"",src:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiPjxwYXRoIGQ9Ik0xOS4wOTggMTAuNjM4Yy0zLjg2OC0yLjI5Ny0xMC4yNDgtMi41MDgtMTMuOTQxLTEuMzg3LS41OTMuMTgtMS4yMi0uMTU1LTEuMzk5LS43NDgtLjE4LS41OTMuMTU0LTEuMjIuNzQ4LTEuNCA0LjIzOS0xLjI4NyAxMS4yODUtMS4wMzggMTUuNzM4IDEuNjA1LjUzMy4zMTcuNzA4IDEuMDA1LjM5MiAxLjUzOC0uMzE2LjUzMy0xLjAwNS43MDktMS41MzguMzkyem0tLjEyNiAzLjQwM2MtLjI3Mi40NC0uODQ3LjU3OC0xLjI4Ny4zMDgtMy4yMjUtMS45ODItOC4xNDItMi41NTctMTEuOTU4LTEuMzk5LS40OTQuMTUtMS4wMTctLjEyOS0xLjE2Ny0uNjIzLS4xNDktLjQ5NS4xMy0xLjAxNi42MjQtMS4xNjcgNC4zNTgtMS4zMjIgOS43NzYtLjY4MiAxMy40OCAxLjU5NS40NC4yNy41NzguODQ3LjMwOCAxLjI4NnptLTEuNDY5IDMuMjY3Yy0uMjE1LjM1NC0uNjc2LjQ2NS0xLjAyOC4yNDktMi44MTgtMS43MjItNi4zNjUtMi4xMTEtMTAuNTQyLTEuMTU3LS40MDIuMDkyLS44MDMtLjE2LS44OTUtLjU2Mi0uMDkyLS40MDMuMTU5LS44MDQuNTYyLS44OTYgNC41NzEtMS4wNDUgOC40OTItLjU5NSAxMS42NTUgMS4zMzguMzUzLjIxNS40NjQuNjc2LjI0OCAxLjAyOHptLTUuNTAzLTE3LjMwOGMtNi42MjcgMC0xMiA1LjM3My0xMiAxMiAwIDYuNjI4IDUuMzczIDEyIDEyIDEyIDYuNjI4IDAgMTItNS4zNzIgMTItMTIgMC02LjYyNy01LjM3Mi0xMi0xMi0xMnoiLz48L3N2Zz4="}),s.createElement("h1",null,"Spotify graph")),s.createElement("div",null,"Graph of your musical taste \u266c\u266b"),this.props.graphLoaded&&s.createElement("div",{className:"download-button pointer",onClick:this.dowloadGraph},"Download graph to JSON"),(this.props.graphLoaded||this.props.graphLoadingError)&&s.createElement("input",{className:"download-button",type:"file",accept:".json",onChange:function(t){null!==t.target.files&&e.uploadGraph(t.target.files)}}),s.createElement("div",{className:"sideBarContent"},this.props.chosenCluster&&s.createElement("div",{className:"box-with-margin"},s.createElement("h2",null,"mostly these genres"),this.createChosenClusterGenres()),this.props.chosenCluster&&s.createElement("div",{className:"box-with-margin"},s.createElement("h2",{className:"text-align-center"},"group of artists"),this.createChosenClusterArtists()),!this.props.chosenCluster&&this.props.graph&&s.createElement("div",{className:"box-with-margin"},s.createElement("p",null,"We took the artists from your ",s.createElement("b",null,"liked")," songs and the artists that ",s.createElement("b",null,"you follow"),"."),s.createElement("p",null,"We found ",s.createElement("b",null,Object.values(this.props.graph.artistDict).length," artist")," that you like."),s.createElement("p",null,"We divided them into clusters you're seing right now. The clusters are based on ",s.createElement("b",null,"genres")," and ",s.createElement("b",null,"preferences")," of other users of Spotify"),s.createElement("p",null,"Click the cluster and explore how the artists are connected."))))}}]),r}(s.Component)),at=Object(o.b)((function(e){return{chosenCluster:e.chosenCluster,graph:e.graph,sp:e.spotifyWebApiObject,artistDict:e.graph.artistDict,graphLoaded:e.graphLoaded,graphLoadingError:e.isGraphLoadingError}}),{loadGraphFromFile:function(e){return function(){var t=Object(M.a)(D.a.mark((function t(r){var s,n,a;return D.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=se.decode(e),Object(q.isRight)(s)){t.next=4;break}return alert("SORRY, THE FILE IS CORRUPTED!"),t.abrupt("return");case 4:for(n=0;n<e.clusters.length;n++)a=e.clusters[n],(Object(C.isUndefined)(a.artistsIds)||0===a.artistsIds.length)&&(a.artistsIds=Object.keys(a.artistsPositions));return t.next=7,Promise.resolve(r({type:"CLEAR_CHOSEN_CLUSTER_ARTIST",reducer:Object(T.a)((function(e){e.chosenCluster=void 0,e.chosenArtist=void 0}))})).then((function(){return r(oe())})).then((function(){return r(ie(e))})).then((function(){return r(ye(!0))})).then((function(){return r(pe())}));case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}})(nt),it=function(e){Object(k.a)(r,e);var t=Object(S.a)(r);function r(e){var s;return Object(b.a)(this,r),(s=t.call(this,e)).state={loggingLoading:!0,loggingFailed:!1},s.afterSpotifyLogin(),s}return Object(E.a)(r,[{key:"afterSpotifyLogin",value:function(){var e=this,t=window.location.search.substr(1),r={};if(t.split("&").forEach((function(e){var t=e.split("=");r[t[0]]=decodeURIComponent(t[1])})),"code"in r&&""!==r.code&&null!==r.code){var s=this.props.history.location.pathname;this.props.history.push({pathname:s,search:""});var n="https://spotify-graph-gajdusek.herokuapp.com/graphapp/logged_in/?code="+r.code,a="";fetch(n).then((function(t){if(200!==t.status)throw t.status;var r=t.headers.get("access-token");null!==r&&(a=r,e.props.setAccessToken(a)),e.setState({loggingLoading:!1})})).catch((function(t){console.debug(t),e.setState({loggingFailed:!0,loggingLoading:!1}),alert("Sorry, we did not manage to log you in Spotify.")}))}else this.state={loggingFailed:!0,loggingLoading:!1}}},{key:"render",value:function(){return this.state.loggingLoading?n.a.createElement("div",{className:"App"},n.a.createElement("div",{className:"page-wrapper"},n.a.createElement("div",{className:"loader"}),n.a.createElement("div",{className:"generic-description"},"Logging into Spotify"))):this.state.loggingFailed?n.a.createElement(y.a,{to:"/login"}):n.a.createElement("div",{className:"App"},n.a.createElement(at,null),n.a.createElement(st,null))}}]),r}(n.a.Component),ot=Object(y.g)(Object(o.b)((function(e){return{}}),(function(e){return{setAccessToken:function(t){return e(function(e){return{type:"SET_ACCESS_TOKEN",payload:e,reducer:Object(T.a)((function(t){t.accessToken=e,t.userLoggedIn=!0}))}}(t))}}}))(it)),ct=Object(c.d)(f,m(),Object(c.c)(c.a.apply(void 0,d))),lt=function(){return n.a.createElement(o.a,{store:ct},n.a.createElement(v.a,{basename:"/spotifygraph"},n.a.createElement(y.d,null,n.a.createElement(y.b,{path:"/login",component:x}),n.a.createElement(y.b,{path:"/mygraph",component:ot}),n.a.createElement(y.b,{path:"/",component:j}))))};i.a.render(n.a.createElement(lt,null),document.getElementById("root"))}},[[61,1,2]]]);
//# sourceMappingURL=main.76920ce4.chunk.js.map