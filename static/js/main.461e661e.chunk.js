(this.webpackJsonpspotifygraph=this.webpackJsonpspotifygraph||[]).push([[0],{28:function(e,t,r){},29:function(e,t,r){},43:function(e,t,r){},45:function(e,t,r){},46:function(e,t,r){},55:function(e,t,r){e.exports=r(78)},60:function(e,t,r){},69:function(e,t,r){},70:function(e,t,r){},71:function(e,t,r){},72:function(e,t,r){},77:function(e,t,r){},78:function(e,t,r){"use strict";r.r(t);var s=r(1),n=r.n(s),i=r(26),a=r.n(i),o=(r(60),r(8)),c=r(24),l=r(48),u=r(49),p=r(31),h=r.n(p),d=[],g=Object(u.createLogger)({predicate:function(e,t){return!1},collapsed:function(e,t){return!0}});d.push(l.a),d.push(g);var f=function(){return{isGraphLoadingError:!1,graphLoaded:!1,graphLoading:!1,chosenArtistLoading:!1,userLoggedIn:!1,graph:{clusters:[],clusterEdges:[],artistEdges:[],clusterSquares:[],artistDict:{}},spotifyWebApiObject:new h.a,graphLoadingRelatedArtistsProgress:0,graphLoadingMessage:"",paused:!1,isGraphFromFileLoaded:!1,nonFavouriteArtistDict:{}}},m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f(),t=arguments.length>1?arguments[1]:void 0;return t.reducer?t.reducer(e):e},v=r(21),y=r(20),b=r(2),E=r(3),S=r(5),O=r(4),j=r(6),k=(r(43),r(28),function(e){function t(e){Object(b.a)(this,t);return Object(S.a)(this,Object(O.a)(t).call(this,e))}return Object(j.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this;return n.a.createElement("div",{className:"App"},n.a.createElement("div",{className:"page-wrapper"},n.a.createElement("div",{className:"page-description-div"},n.a.createElement("h1",null,"Spotify graph"),n.a.createElement("p",null,"a project that will show you your musical taste in form of a graph")),n.a.createElement("button",{className:"very-big-button",onClick:function(){e.props.history.push("/login")}},"Continue to get your graph")))}}]),t}(n.a.Component)),w=Object(y.g)(Object(o.b)((function(e){return{loggedIn:e.userLoggedIn}}),{})(k)),A=r(11),x=r.n(A),C=r(18),L=r(10),N=r(9),D=r(25),M=r(33),T=function(e,t){for(var r=[],s=0;s<t.length;s++){for(var n=t[s].id,i=[],a={},o=0,c=Object.entries(t[s].artistsPositions);o<c.length;o++){var l=c[o],u=Object(M.a)(l,2),p=u[0],h=u[1];i.push(e[p]),a[p]={x:h.x,y:h.y}}i.sort((function(e,t){return t.score-e.score}));var d={id:n,genres:t[s].genres,artistsIds:i.map((function(e){return e.id})),artistsPositions:a,country:t[s].country};r.push(d)}return r},P=function(e){for(var t=[],r=0;r<e.length;r++){var s=e[r],n={};if(Object.values(s).length>0){for(var i in s){var a=s[i].x,o=s[i].y;n[i]={x:a,y:o}}t.push(n)}}return t},I=function(e){return new Promise((function(t){return setTimeout(t,e)}))},R=function(e){if(!document.cookie)return"";var t=document.cookie.split(";").map((function(e){return e.trim()})).filter((function(t){return t.startsWith(e+"=")}));return 0===t.length?"":decodeURIComponent(t[0].split("=")[1])},W=function(e){return null===e.preview_url&&console.debug(e.id,":",e.name,e),{name:e.name,id:e.id,previewLink:e.preview_url,artistsIds:e.artists.map((function(e){return e.id})),externalUrl:e.external_urls.spotify}},z=function(){var e=Object(C.a)(x.a.mark((function e(t){var r,s,n,i,a,o,c,l;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=50,s=[],i=3,a=null;case 4:o=!0,c=0;case 6:return e.prev=6,l=a?{limit:r,after:a}:{limit:r},e.next=10,t.getFollowedArtists(l);case 10:n=e.sent,e.next=19;break;case 13:return e.prev=13,e.t0=e.catch(6),e.next=17,I(e.t0.getResponseHeader["retry-after"]?1e3*parseInt(e.t0.headers["retry-after"]+1):4e3);case 17:o=!1,c+=1;case 19:if(!1===o&&c<i){e.next=6;break}case 20:Object(N.isUndefined)(n)?a=null:(s.push.apply(s,Object(D.a)(n.artists.items.map((function(e){return e.id})))),a=n.artists.cursors.after);case 21:if(a){e.next=4;break}case 22:return e.abrupt("return",s);case 23:case"end":return e.stop()}}),e,null,[[6,13]])})));return function(t){return e.apply(this,arguments)}}(),U=function(){var e=Object(C.a)(x.a.mark((function e(t,r,s,n){var i,a,o,c,l,u,p,h,d;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=[],a=3,o=r.length,c=0;case 4:if(!(c<o)){e.next=31;break}if(l=r[c],n(c/o),!(l in s)){e.next=11;break}i.push(s[l]),e.next=28;break;case 11:u=void 0,p=!0,h=0;case 14:return e.prev=14,e.next=17,t.getArtistRelatedArtists(l);case 17:u=e.sent,e.next=26;break;case 20:return e.prev=20,e.t0=e.catch(14),e.next=24,I(e.t0.getResponseHeader["retry-after"]?1e3*parseInt(e.t0.headers["retry-after"]+1):4e3);case 24:p=!1,h+=1;case 26:if(!1===p&&h<a){e.next=14;break}case 27:Object(N.isUndefined)(u)?i.push([]):(d=u.artists.map((function(e){return e.id})),s[l]=d,i.push(d));case 28:c++,e.next=4;break;case 31:return e.abrupt("return",i);case 32:case"end":return e.stop()}}),e,null,[[14,20]])})));return function(t,r,s,n){return e.apply(this,arguments)}}(),G=function(){var e=Object(C.a)(x.a.mark((function e(t){var r,s,n,i,a,o,c,l;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=0,s=50,n=[],a=3,o=null;case 5:c=!0,l=0;case 7:return e.prev=7,e.next=10,t.getMySavedTracks({limit:50,offset:r});case 10:i=e.sent,e.next=19;break;case 13:return e.prev=13,e.t0=e.catch(7),e.next=17,I(e.t0.getResponseHeader["retry-after"]?1e3*parseInt(e.t0.headers["retry-after"]+1):4e3);case 17:c=!1,l+=1;case 19:if(!1===c&&l<a){e.next=7;break}case 20:Object(N.isUndefined)(i)?o=null:(r+=s,n.push.apply(n,Object(D.a)(i.items.map((function(e){return e.track})))),o=i.next);case 21:if(o){e.next=5;break}case 22:return e.abrupt("return",n);case 23:case"end":return e.stop()}}),e,null,[[7,13]])})));return function(t){return e.apply(this,arguments)}}(),H=function(e){var t=e.map((function(e){return e.artists})).reduce((function(e,t){return e.concat(t)}),[]).map((function(e){return e.id}));return Object(D.a)(new Set(t))},_=function(){var e=Object(C.a)(x.a.mark((function e(t,r){var s,n,i,a,o,c,l;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=[],n=3,i=0,a=50;case 4:o=void 0,c=!0,l=0;case 7:return e.prev=7,e.next=10,t.getArtists(r.slice(i,i+a));case 10:o=e.sent,e.next=19;break;case 13:return e.prev=13,e.t0=e.catch(7),e.next=17,I(e.t0.getResponseHeader["retry-after"]?1e3*parseInt(e.t0.headers["retry-after"]+1):4e3);case 17:c=!1,l+=1;case 19:if(!1===c&&l<n){e.next=7;break}case 20:Object(N.isUndefined)(o)||(s.push.apply(s,Object(D.a)(o.artists)),i+=a);case 21:if(i<r.length){e.next=4;break}case 22:return e.abrupt("return",s);case 23:case"end":return e.stop()}}),e,null,[[7,13]])})));return function(t,r){return e.apply(this,arguments)}}(),F=function(e,t,r,s){if(e.length!==t.length)return console.debug("ERROR: NOT EVERY ARTIST HAS RELATED ARTISTS"),{};for(var n={},i=0;i<e.length;i++){var a=e[i],o=a.images&&a.images.length>0?a.images[a.images.length-1].url:"",c=r.has(a.id),l=a.popularity,u=c?5:0;n[a.id]={genres:a.genres,id:a.id,image:o,isFollowed:c,likedSongs:[],name:a.name,relatedArtistsIds:t[i],score:.1*l+u}}for(var p=0;p<s.length;p++)for(var h=s[p],d=0;d<h.artists.length;d++){var g=h.artists[d];g.id in n&&n[g.id].likedSongs.push({artistsIds:h.artists.map((function(e){return e.id})),externalUrl:h.external_urls.spotify,name:h.name,id:h.id,previewLink:h.preview_url})}for(var f in n){var m=n[f];n[f].score+=1*m.likedSongs.length}return n},Y=function(e){var t={};for(var r in e){var s=e[r];t[r]={id:s.id,relatedArtistsIds:s.relatedArtistsIds,genres:s.genres}}return t},V=function(){var e=Object(C.a)(x.a.mark((function e(t,r,s,n,i){var a,o,c,l,u,p,h,d,g,f,m,v,y,b,E,S,O,j,k;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",{clusters:[],clusterEdges:[],artistEdges:[],clusterSquares:[],artistDict:{}});case 2:return r.setAccessToken(t),e.next=5,G(r);case 5:return a=e.sent,n("Getting your liked songs from Spotify..."),console.debug("liked songs: ",a),o=H(a),console.debug("liked songs artists ids: ",o),n("Getting the artists you follow from Spotify..."),e.next=13,z(r);case 13:if(c=e.sent,console.debug("followed artists ids: ",c),l=Object(D.a)(new Set(o.concat(c))),console.debug("all artists ids: ",l),!(l.length<1)){e.next=19;break}return e.abrupt("return",{clusters:[],clusterEdges:[],artistEdges:[],clusterSquares:[],artistDict:{}});case 19:return n("Getting information about all the artists you are interested it..."),e.next=22,Promise.resolve(_(r,l));case 22:if(u=e.sent,console.debug("artists full: ",u),p="relatedArtists",h=localStorage.getItem(p),d={},null===h);else{try{d=JSON.parse(h)}catch(x){d={}}null===d&&(d={})}return n("Getting information about the related artists of all of your favourite artists... \n This might take a while :("),e.next=31,U(r,l,d,i);case 31:if(g=e.sent,localStorage.setItem(p,JSON.stringify(d)),console.debug("related artists final",g),f=F(u,g,new Set(c),a),console.debug("artist dict",f),m=R("csrftoken"),n("We have all the data we need, now computing the graph!"),v="https://spotify-graph-gajdusek.herokuapp.com/graphapp/calculategraph/",!Object(N.isUndefined)(v)){e.next=41;break}return e.abrupt("return",{clusters:[],clusterEdges:[],artistEdges:[],clusterSquares:[],artistDict:{}});case 41:return y={},e.prev=42,e.next=45,fetch(v,{method:"POST",body:JSON.stringify(Y(f)),headers:{"Content-Type":"application/json","X-CSRFToken":m}});case 45:if(!(b=e.sent).ok){e.next=52;break}return e.next=49,b.json();case 49:y=e.sent,e.next=58;break;case 52:return e.next=54,b.json();case 54:throw e.t0=e.sent,e.t1=b.status,e.t2=b.statusText,{json:e.t0,status:e.t1,statusText:e.t2};case 58:e.next=65;break;case 60:if(e.prev=60,e.t3=e.catch(42),!e.t3.json){e.next=65;break}return alert(e.t3.json.message),e.abrupt("return",{clusters:[],clusterEdges:[],artistEdges:[],clusterSquares:[],artistDict:{}});case 65:return s({blbostToDelete:l.join("\n")}),console.debug(y),A=y.artistEdges,E=A.map((function(e){return{id1:e.id1,id2:e.id2,weight:e.weight}})),S=T(f,y.clusters),w=y.clusterEdges,O=w.map((function(e){return{id1:e.id1,id2:e.id2,weight:e.weight}})),j=P(y.clusterSquares),k=new Promise((function(e){return e({artistEdges:E,clusters:S,clusterEdges:O,clusterSquares:j,artistDict:f})})),e.t4=console,e.next=75,k;case 75:return e.t5=e.sent,e.t4.debug.call(e.t4,"graph from spotify fetch:",e.t5),e.abrupt("return",k);case 78:case"end":return e.stop()}var w,A}),e,null,[[42,60]])})));return function(t,r,s,n,i){return e.apply(this,arguments)}}(),X=function(e){return{type:"SET_CHOSEN_ARTIST",payload:e,reducer:Object(L.a)((function(t){t.chosenArtist=e}))}},Q=function(e){return{type:"SET_CHOSEN_CLUSTER",payload:e,reducer:Object(L.a)((function(t){t.chosenCluster=e}))}},B=function(e){return{type:"SET_GRAPH",payload:e,reducer:Object(L.a)((function(t){t.graph=e}))}},J=function(){return{type:"GRAPH_LOADING",reducer:Object(L.a)((function(e){e.graphLoading=!0}))}},q=function(e){return{type:"SET_GRAPH_LOADING_MESSAGE",reducer:Object(L.a)((function(t){t.graphLoadingMessage=e}))}},Z=function(e){return{type:"SET_GRAPH_LOADING_MESSAGE",reducer:Object(L.a)((function(t){t.graphLoadingRelatedArtistsProgress=e}))}},K=function(){return{type:"GRAPH_LOADING_SUCCESS",reducer:Object(L.a)((function(e){e.graphLoading=!1,e.graphLoaded=!0}))}},$=function(e){return{type:"SET_CHOSEN_ARTIST_ERROR",payload:e,reducer:Object(L.a)((function(t){t.chosenArtistError=e}))}},ee=function(e){return{type:"SET_CHOSEN_ARTIST_LOADING",payload:e,reducer:Object(L.a)((function(t){t.chosenArtistLoading=e}))}},te=function(e,t){return{type:"SET_CHOSEN_ARTIST_DATA",payload:e,reducer:Object(L.a)((function(r){r.chosenArtistData=e,r.chosenArtist=t}))}},re=function(e){return{type:"SET_PAUSED",payload:e,reducer:Object(L.a)((function(t){t.paused=e}))}},se=function(e){return{type:"GRAPH_FROM_FILE_IS_LOADED",payload:e,reducer:Object(L.a)((function(t){t.isGraphFromFileLoaded=e}))}},ne=function(e){function t(e){return Object(b.a)(this,t),Object(S.a)(this,Object(O.a)(t).call(this,e))}return Object(j.a)(t,e),Object(E.a)(t,[{key:"spotifyLoginLink",value:function(){var e,t={client_id:"dfb05fa5c36b41d48407ad5e3773d39b",response_type:"code",redirect_uri:"https://gajdusep.github.io/spotifygraph/mygraph",scope:["streaming","user-read-email","user-read-private","user-read-playback-state","user-modify-playback-state","user-library-read","user-library-modify","user-follow-read","playlist-modify-private","playlist-read-private"].join(" "),state:"rndstringsomehash"};return"https://accounts.spotify.com/authorize?"+(e=t,Object.entries(e).map((function(e){return e.map(encodeURIComponent).join("=")})).join("&"))}},{key:"loginWithSpotify",value:function(){window.location.assign(this.spotifyLoginLink())}},{key:"render",value:function(){var e=this;return this.props.loggedIn?n.a.createElement(y.a,{to:"/mygraph"}):n.a.createElement("div",{className:"App"},n.a.createElement("div",{className:"page-wrapper"},n.a.createElement("div",{className:"generic-description"},n.a.createElement("div",null,"Please login with your spotify account")),n.a.createElement("button",{className:"very-big-button",onClick:function(){return e.loginWithSpotify()}},"Log in with your Spotify account")))}}]),t}(n.a.Component),ie=Object(o.b)((function(e){return{loggedIn:e.userLoggedIn}}),{setUserLoggedIn:function(){return{type:"LOG_IN",reducer:Object(L.a)((function(e){e.userLoggedIn=!0}))}}})(ne),ae=(r(69),r(51)),oe=r(12),ce=r(40),le=function(e,t,r,s,n,i){1!==e&&2!==e&&3!==e&&r.length;var a=r.length,o=r[0].length;e:for(var c=0;c<t.length;c++){var l=!1,u=t[c];t:for(var p=0;p<r.length;p++)for(var h=0;h<r[p].length;h++){var d=[];1===e?d=[[[p,h]]]:2===e?d=[[[p,h],[p,h+1]],[[p,h],[p+1,h]]]:3===e&&(d=[[[p,h],[p,h+1],[p+1,h+1]],[[p,h],[p+1,h],[p+1,h+1]],[[p,h],[p,h+1],[p+1,h]],[[p+1,h+1],[p,h+1],[p+1,h]]]);for(var g=0;g<d.length;g++){var f=d[g],m=f.every((function(e){var t=Object(M.a)(e,2),s=t[0],n=t[1];return s<a&&n<o&&0!==r[s][n]})),v=Object.keys(u);if(m){for(var y=0;y<e;y++){var b=s[r[f[y][0]][f[y][1]]-1];i[v[y]]={x:b.left,y:b.top},r[f[y][0]][f[y][1]]=0}l=!0;break t}}}if(!l){for(var E=c;E<t.length;E++)n.push(t[E]);break e}}},ue=function(e,t,r,s,n){var i={};e-=15;for(var a=[],o=[],c=[],l=[],u=0;u<n.length;u++){var p=n[u],h=Object.keys(p).length;1===h?a.push(p):2===h?o.push(p):3===h?c.push(p):l.push(p)}var d={width:e,height:t,clusterWidth:r+25,clusterHeigth:s+10};return function(e,t,r){for(var s=0;s<e.length;s++){var n=e[s];for(var i in n){var a=n[i],o=a.x*(r.width-r.clusterWidth-40),c=a.y*r.height;t[i]={x:o,y:c}}}}(l,i,d),function(e,t,r,s,n,i){var a=[];for(var o in e){var c=e[o];a.push({left:c.x,top:c.y,width:n.clusterWidth,height:n.clusterHeigth})}var l=ge(n.width,i,n.clusterWidth+30,n.clusterHeigth+30,a),u=l.possibleRectanglePositions,p=l.freeRectMatrix,h=[],d=[],g=[];le(3,s,p,u,h,e),le(2,r,p,u,d,e),le(1,t,p,u,g,e);for(var f=[],m=i,v=0,y=.7*n.clusterWidth,b=.7*n.clusterHeigth,E=.7*n.clusterWidth,S=0;S<h.length;S++){for(var O=h[S],j=Object.keys(O),k=Math.random(),w=[[E*Math.cos(k*Math.PI)+y+v,E*Math.sin(k*Math.PI)+b+m],[E*Math.cos((k+2/3)*Math.PI)+y+v,E*Math.sin((k+2/3)*Math.PI)+b+m],[E*Math.cos((k+4/3)*Math.PI)+y+v,E*Math.sin((k+4/3)*Math.PI)+b+m]],A=0;A<3;A++)e[j[A]]={x:w[A][0],y:w[A][1]},f.push({left:w[A][0],top:w[A][1],width:n.clusterWidth,height:n.clusterHeigth});var x=1.7*E+n.clusterWidth;(v+=x)+x>n.width&&(v=0,m+=x)}for(var C=0;C<d.length;C++){for(var L=d[C],N=Object.keys(L),D=[[v,m],[v+2*E,m]],M=0;M<2;M++)e[N[M]]={x:D[M][0],y:D[M][1]},f.push({left:D[M][0],top:D[M][1],width:n.clusterWidth,height:n.clusterHeigth});(v+=2*E+n.clusterWidth)>n.width-n.clusterWidth&&(v=0,m+=n.clusterHeigth+20)}m=i;for(var T=0;T<g.length;T++){for(var P=g[T],I=Object.keys(P)[0],R={top:m,left:v,width:n.clusterWidth,height:n.clusterHeigth};de(R,f);)R.left+=n.clusterWidth,R.left+n.clusterWidth>n.width&&(R.left=0,R.top+=n.clusterHeigth+20);e[I]={x:R.left,y:R.top},v=R.left+n.clusterWidth+20,m=R.top,v+n.clusterWidth>n.width&&(v=0,m+=n.clusterHeigth)}}(i,a,o,c,d,pe(i,s)),i},pe=function(e,t){var r=0;for(var s in e){var n=e[s];r=n.y>r?n.y:r}return r+t},he=function(e,t,r,s){return e<s&&r<t},de=function(e,t){return t.reduce((function(t,r){return t||(n=e,he((s=r).left,s.left+s.width,n.left,n.left+n.width)&&he(s.top,s.top+s.height,n.top,n.top+n.height));var s,n}),!1)},ge=function(e,t,r,s,n){var i=[],a=Math.floor(e/r),o=Math.floor(t/s);a=0===a?1:a,o=0===o?1:o;for(var c=[],l=0,u=0;u<o;u++){i[u]=[];for(var p=0;p<a;p++){var h={top:u*s,left:p*r,width:r,height:s};de(h,n)?i[u][p]=0:(l+=1,i[u][p]=l,c.push(h))}}return{possibleRectanglePositions:c,freeRectMatrix:i}},fe=r(22),me=(r(29),function(e,t,r,s,n){var i,a,o,c;e>r?(a=r,o=e-r):(a=e,o=r-e),t>s?(i=s,c=t-s):(i=t,c=s-t);var l=c,u=0+n;return(t>s&&e>r||t<s&&e<r)&&(l=0+n,u=c),{x1fin:0+n,y1fin:l,x2fin:o,y2fin:u,top:i,left:a,hei:c,wid:o}}),ve=function(e){function t(){return Object(b.a)(this,t),Object(S.a)(this,Object(O.a)(t).apply(this,arguments))}return Object(j.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=2*this.props.weigth,t=me(this.props.x1,this.props.y1,this.props.x2,this.props.y2,e),r=t.x1fin,s=t.y1fin,i=t.x2fin,a=t.y2fin,o=t.top,c=t.left,l=t.hei,u=t.wid,p={top:o+30,left:c+this.props.artistWidth/2},h="rgb(".concat(2,", ",250,", ",240,", ",this.props.weigth/this.props.maximumEdgeWeigth,")");return n.a.createElement("svg",{style:p,className:"position-absolute",width:u+e+20,height:l+e+20},n.a.createElement("path",{d:"M ".concat(r,",").concat(s," \n                        C ").concat(r+20,",").concat(s+20," ").concat(i+20,",").concat(a+20," ").concat(i,",").concat(a),strokeWidth:e,fill:"none",stroke:h}))}}]),t}(n.a.Component),ye=r(23),be=r.n(ye),Ee={lightAzureBlue:"rgb(132, 237, 243)",darkAzureBlue:"rgb(2, 109, 104)",pink:"rgb(255, 51, 153)",green:"rgb(0, 204, 0)",grey:"rgb(191, 191, 191)"};r(45),r(70);function Se(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function Oe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Se(r,!0).forEach((function(t){Object(fe.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Se(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var je=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(S.a)(this,Object(O.a)(t).call(this,e))).state={currentPositionX:e.positionX,currentPositionY:e.positionY,dragging:!1},r.onDrag=r.onDrag.bind(Object(oe.a)(r)),r.onStop=r.onStop.bind(Object(oe.a)(r)),r}return Object(j.a)(t,e),Object(E.a)(t,[{key:"componentDidUpdate",value:function(){}},{key:"onDrag",value:function(e,t){e.stopPropagation(),e.preventDefault(),this.setState({dragging:!0});var r=this.state.currentPositionX+t.deltaX,s=this.state.currentPositionY+t.deltaY;this.setState({currentPositionX:r,currentPositionY:s}),this.props.positionChangedCallback(r,s,this.props.artist.id)}},{key:"onStop",value:function(e){e.stopPropagation(),e.preventDefault();var t=this.state.dragging;this.setState({dragging:!1}),t||this.handleClick()}},{key:"handleClick",value:function(){if(this.props.accessToken){if(this.props.chosenArtist&&this.props.chosenArtist.id===this.props.artist.id)return;this.props.setChosenArtistDataAllFunc(this.props.artist,this.props.accessToken)}}},{key:"render",value:function(){var e=Ee.lightAzureBlue;this.props.chosenArtist&&this.props.chosenArtist.id===this.props.artist.id&&(e=Ee.pink);var t={backgroundImage:"url(".concat(this.props.artist.image,")"),backgroundSize:"".concat(60,"px ").concat(60,"px"),width:"".concat(60,"px"),height:"".concat(60,"px"),borderRadius:"10px",alignSelf:"center"};return this.props.artist.score<this.props.minimumScore?n.a.createElement("div",null):n.a.createElement(be.a,{key:this.props.artist.id,bounds:"parent",defaultPosition:{x:this.props.positionX,y:this.props.positionY},onDrag:this.onDrag,onStop:this.onStop},n.a.createElement("div",{className:"artist-node-outer-wrapper"},n.a.createElement("div",{style:Oe({},t,{backgroundColor:Ee.lightAzureBlue})},n.a.createElement("div",{style:t})),n.a.createElement("div",{className:"artist-node-artist-name-div",style:{backgroundColor:e}},this.props.artist.name)))}}]),t}(n.a.Component),ke=Object(o.b)((function(e){return{accessToken:e.accessToken,chosenArtist:e.chosenArtist}}),(function(e){return{setChosenArtistDataAllFunc:function(t,r){return e(function(e,t){return function(){var r=Object(C.a)(x.a.mark((function r(s){var n,i,a,o,c;return x.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!Object(N.isUndefined)(t)&&null!==t&&""!==t){r.next=3;break}return s($("The token was not loaded, cannot obtain the artist data.")),r.abrupt("return");case 3:s(X(e)),s(ee(!0)),(n=new h.a).setAccessToken(t),i=[],a=[],o=[],c=function(e,t){return e.id===t.id||e.name===t.name},n.getArtistTopTracks(e.id,"CZ").then((function(t){for(var r=function(r){var s,n,l=(s=t.tracks[r],n=e.id,s.artists.reduce((function(e,t){return t.id!==n&&e.push({id:t.id,name:t.name}),e}),[]));o=o.concat(l);var u=W(t.tracks[r]),p=e.likedSongs.findIndex((function(e){return c(u,e)}));-1===p?a.push(u):(""===u.previewLink&&(u.previewLink=e.likedSongs[p].previewLink),i.push(u))},n=0;n<t.tracks.length;n++)r(n);for(var l,u=function(t){var r=e.likedSongs[t];-1===i.findIndex((function(e){return c(r,e)}))&&i.push(r)},p=0;p<e.likedSongs.length;p++)u(p);s({type:"UPDATE_NOT_FAVOURITE_ARTISTS",payload:l=o,reducer:Object(L.a)((function(e){for(var t=e.nonFavouriteArtistDict,r=e.graph.artistDict,s=0;s<l.length;s++){var n=l[s];n.id in r||(t[n.id]=n)}e.nonFavouriteArtistDict=t}))}),s(te({likedSongs:i,notLikedSongs:a},e))})).catch((function(e){console.debug(e),s($("During the artist data fetching, the following error occured:"+e))})).finally((function(){s(ee(!1))}));case 12:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()}(t,r))}}}))(je),we=r(32),Ae=r(52),xe=(r(71),function(e){function t(e){var r;Object(b.a)(this,t),(r=Object(S.a)(this,Object(O.a)(t).call(this,e))).boxRef=void 0,r.wrapperRef=void 0;var s=r.getIdArtistDictAndSliderLimits(),i=s.idArtistDict,a=s.artistsSliderLimits,o=s.edgesSliderLimits;return r.state={width:0,height:0,nodes:[],artistsPositions:{},dragging:!1,artistSliderValue:a.minimum,edgesSliderValue:o.minimum,idArtistDict:i,artistsSliderLimits:a,edgesSliderLimits:o,descriptionHover:!1,minimumEdgeWeight:.5},r.wrapperRef=n.a.createRef(),r.boxRef=n.a.createRef(),r.positionChangedHandler=r.positionChangedHandler.bind(Object(oe.a)(r)),r.changeArtistSliderValue=r.changeArtistSliderValue.bind(Object(oe.a)(r)),r.changeEdgeSliderValue=r.changeEdgeSliderValue.bind(Object(oe.a)(r)),r}return Object(j.a)(t,e),Object(E.a)(t,[{key:"componentDidUpdate",value:function(e,t){e.graphElements!==this.props.graphElements?this.prepareAfterGraphDataUpdate():t.artistSliderValue!==this.state.artistSliderValue&&this.prepareAfterSliderUpdate()}},{key:"componentDidMount",value:function(){this.prepareAfterGraphDataUpdate()}},{key:"getIdArtistDictAndSliderLimits",value:function(){for(var e={},t={minimum:1e3,maximum:-1e3},r={minimum:1e3,maximum:-1e3},s=0;s<this.props.graphElements.nodes.length;s++){var n=this.props.graphElements.nodes[s];e[n.artist.id]=n.artist,t.maximum=n.artist.score>t.maximum?n.artist.score:t.maximum,t.minimum=n.artist.score<t.minimum?n.artist.score:t.minimum}for(var i=0;i<this.props.graphElements.edges.length;i++){var a=this.props.graphElements.edges[i];r.maximum=a.weigth>r.maximum?a.weigth:r.maximum,r.minimum=a.weigth<r.minimum?a.weigth:r.minimum}return t.maximum=Math.ceil(t.maximum),t.minimum=Math.ceil(t.minimum)-1,r.maximum=Math.ceil(r.maximum),r.minimum=Math.ceil(r.minimum)-1,{idArtistDict:e,artistsSliderLimits:t,edgesSliderLimits:r}}},{key:"prepareAfterGraphDataUpdate",value:function(){var e=this.getIdArtistDictAndSliderLimits(),t=e.idArtistDict,r=e.artistsSliderLimits,s=e.edgesSliderLimits;this.setState({artistsSliderLimits:r,edgesSliderLimits:s,artistSliderValue:r.minimum,edgesSliderValue:s.minimum,idArtistDict:t});var n=this.boxRef.current.clientWidth,i=this.boxRef.current.clientHeight;this.setState({width:n,height:i});var a=this.createNodes(n,i);this.setState({nodes:a.nodes,artistsPositions:a.positions})}},{key:"prepareAfterSliderUpdate",value:function(){for(var e=[],t=0;t<this.props.graphElements.nodes.length;t++){var r=this.props.graphElements.nodes[t];e.push(n.a.createElement(ke,{key:r.artist.id,positionChangedCallback:this.positionChangedHandler,positionX:this.state.artistsPositions[r.artist.id].x,positionY:this.state.artistsPositions[r.artist.id].y,artist:r.artist,minimumScore:this.state.artistSliderValue}))}this.setState({nodes:e})}},{key:"positionChangedHandler",value:function(e,t,r){if(null==this.state.artistsPositions)return[];var s=this.state.artistsPositions;s[r]={x:e,y:t},this.setState({artistsPositions:s})}},{key:"createNodes",value:function(e,t){for(var r=[],s={},i=0;i<this.props.graphElements.nodes.length;i++){var a=this.props.graphElements.nodes[i],o=a.position.x*(e-100-30)+15,c=a.position.y*(t-100-30)+15;s[a.artist.id]={x:o,y:c},r.push(n.a.createElement(ke,{key:a.artist.id,positionChangedCallback:this.positionChangedHandler,positionX:o,positionY:c,artist:a.artist,minimumScore:this.state.artistSliderValue}))}return{nodes:r,positions:s}}},{key:"createEdges",value:function(){var e=[];if(null==this.state.artistsPositions)return[];try{for(var t=0;t<this.props.graphElements.edges.length;t++){var r=this.props.graphElements.edges[t],s=r.id1,i=r.id2,a=r.weigth,o=s+i,c=this.state.idArtistDict[s],l=this.state.idArtistDict[i];c!==l&&a>this.state.edgesSliderValue&&a>this.state.minimumEdgeWeight&&c.score>=this.state.artistSliderValue&&l.score>=this.state.artistSliderValue&&e.push(n.a.createElement(ve,{key:o,x1:this.state.artistsPositions[s].x,y1:this.state.artistsPositions[s].y,x2:this.state.artistsPositions[i].x,y2:this.state.artistsPositions[i].y,weigth:r.weigth,artistWidth:70,maximumEdgeWeigth:this.state.edgesSliderLimits.maximum}))}}catch(u){e.push(n.a.createElement("div",null))}return e}},{key:"changeArtistSliderValue",value:function(e){this.setState({artistSliderValue:e.currentTarget.valueAsNumber})}},{key:"createArtistSlider",value:function(){var e=this.state.artistsSliderLimits.minimum,t=this.state.artistsSliderLimits.maximum;return n.a.createElement("div",{className:"inner-slider-wrapper"},n.a.createElement("input",{type:"range",min:e,max:t,step:(t-e)/10,value:this.state.artistSliderValue,onChange:this.changeArtistSliderValue,className:"slider-input"}))}},{key:"changeEdgeSliderValue",value:function(e){this.setState({edgesSliderValue:e.currentTarget.valueAsNumber})}},{key:"createEdgeSlider",value:function(){var e=Math.max(this.state.edgesSliderLimits.minimum,this.state.minimumEdgeWeight),t=this.state.edgesSliderLimits.maximum;return n.a.createElement("div",{className:"inner-slider-wrapper"},n.a.createElement("input",{type:"range",min:e,max:t,step:(t-e)/10,value:this.state.edgesSliderValue,onChange:this.changeEdgeSliderValue,className:"slider-input"}))}},{key:"changeHover",value:function(){this.setState({descriptionHover:!this.state.descriptionHover})}},{key:"getDraggableSlider",value:function(){var e=this,t=this.state.descriptionHover?{}:{display:"none"};return n.a.createElement(be.a,{handle:"strong",bounds:"parent"},n.a.createElement("div",{className:"draggable-slider-div"},n.a.createElement("div",null,n.a.createElement("div",{className:"outer-slider-wrapper"},this.createEdgeSlider(),"edges"),n.a.createElement("div",{className:"outer-slider-wrapper"},this.createArtistSlider(),"artists")),n.a.createElement(Ae.a,{onMouseEnter:function(){return e.changeHover()},onMouseLeave:function(){return e.changeHover()},size:30}),n.a.createElement("strong",null,n.a.createElement(we.b,{size:30})),n.a.createElement("div",{className:"slider-description",style:t},n.a.createElement("p",null,"Drag the sliders to control how many edges and artists will be shown."),n.a.createElement("p",null,"The artists will be hidden in the order based on their importance to you - less important first, more important remainig."),n.a.createElement("p",null,"The importance takes into account these factors: how many their songs you like, if you follow them and popularity on Spotify."),n.a.createElement("p",null,'The score of an edge between two artists is calculated from the number of common genres and Spotify "related artists" information.'))))}},{key:"render",value:function(){return n.a.createElement("div",{className:"noselect chosen-cluster-wrapper",ref:this.wrapperRef},n.a.createElement("div",{className:"insideClusterBox",ref:this.boxRef,style:{width:this.state.width}},this.getDraggableSlider(),0!==this.state.width&&0!==this.state.nodes.length&&this.createEdges(),0!==this.state.width&&this.state.nodes))}}]),t}(n.a.Component)),Ce=Object(o.b)((function(e){return{accessToken:e.accessToken,chosenArtist:e.chosenArtist}}),{})(xe),Le=(r(72),r(34)),Ne=r(41),De=r(53),Me=function(e){function t(e){var r;Object(b.a)(this,t);var s=(r=Object(S.a)(this,Object(O.a)(t).call(this,e))).prepareSongs(),n=s.liked,i=s.notLiked;return r.state={chosenSongId:"",likedSongs:n,notLikedSongs:i},r}return Object(j.a)(t,e),Object(E.a)(t,[{key:"setChosenSong",value:function(e){e===this.state.chosenSongId?this.setState({chosenSongId:""}):this.setState({chosenSongId:e})}},{key:"componentDidUpdate",value:function(e,t){e.chosenArtistData!==this.props.chosenArtistData&&this.setState({chosenSongId:"",likedSongs:this.props.chosenArtistData.likedSongs,notLikedSongs:this.props.chosenArtistData.notLikedSongs})}},{key:"prepareSongs",value:function(){if(!this.props.chosenArtistData||Object(N.isUndefined)(this.props.chosenArtist))return{liked:[],notLiked:[]};for(var e=[],t=[],r=0;r<this.props.chosenArtistData.likedSongs.length;r++){var s=this.props.chosenArtistData.likedSongs[r];this.props.chosenArtist.likedSongs&&!e.includes(s)?e.push(s):t.includes(s)||t.push(s)}return console.debug("liked:",e),console.debug("liked by artist",this.props.chosenArtist.likedSongs),console.debug("not liked:",t),{liked:e,notLiked:t}}},{key:"getSongDiv",value:function(e,t){var r=this,s=this.state.chosenSongId===e.id?{maxHeight:80}:{maxHeight:0},i=n.a.createElement(Le.b,{size:40,onClick:function(t){t.stopPropagation(),r.props.setSongToPlay(e)}}),a=Ee.lightAzureBlue;this.props.songToPlay&&this.props.songToPlay.id===e.id&&(a=Ee.pink,i=this.props.paused?n.a.createElement(Le.b,{size:40,onClick:function(e){e.stopPropagation(),r.props.setPause(!1)}}):n.a.createElement(Le.a,{size:40,onClick:function(e){e.stopPropagation(),r.props.setPause(!0)}}));var o=Ee.lightAzureBlue;return t&&(o=Ee.green),(""===e.previewLink||null===e.previewLink||Object(N.isUndefined)(e.previewLink))&&(i=n.a.createElement(De.a,{size:40,onClick:function(e){e.stopPropagation(),alert("No preview found on Spotify")}}),a=Ee.grey),n.a.createElement("div",{key:e.id,className:"flex-column song-div",style:{backgroundColor:a}},n.a.createElement("div",{className:"song-preview",style:{backgroundColor:o},onClick:function(){return r.setChosenSong(e.id)}},n.a.createElement("div",{className:"pointer",style:{marginRight:"5px",display:"inline-flex",flexDirection:"column",justifyContent:"center",alignContent:"center"}},i),n.a.createElement("div",{className:"song-wrapper"},e.name)),n.a.createElement("div",{className:"song-description",style:s},n.a.createElement("div",{className:"full-song-link-div",onClick:function(){window.open(e.externalUrl)}},n.a.createElement(Ne.b,null),"Full song"),!t&&n.a.createElement("div",{className:"full-song-link-div",onClick:function(){r.props.spotifyApiObject.addToMySavedTracks([e.id]).then((function(){console.debug("TRACK SAVED");var t=r.state.likedSongs;t=t.concat(e);var s=r.state.notLikedSongs.filter((function(t){return t.id!==e.id}));r.setState({likedSongs:t,notLikedSongs:s})})).catch((function(e){console.debug("THIS ERROR DURING TRACK SAVING OCCURED:",e)}))}},n.a.createElement(Ne.a,null),"Save to liked songs")))}},{key:"getSongsDivs",value:function(e,t){if(!e)return[];for(var r=[],s=0;s<e.length;s++)r.push(this.getSongDiv(e[s],t));return r}},{key:"render",value:function(){return this.props.chosenArtistError?n.a.createElement("div",{className:"chosen-artist-bar"},n.a.createElement("h2",null,n.a.createElement("i",null,this.props.chosenArtistError))):Object(N.isUndefined)(this.props.chosenArtist)||Object(N.isUndefined)(this.props.chosenArtistData)?n.a.createElement("div",{className:"chosen-artist-bar"},n.a.createElement("h2",null,"CLICK SOME ARTIST")):this.props.chosenArtistLoading?n.a.createElement("div",{className:"chosen-artist-bar"},n.a.createElement("h2",null,"LOADING...")):n.a.createElement("div",{className:"chosen-artist-bar"},n.a.createElement("h1",null,this.props.chosenArtist.name),this.props.chosenArtist.isFollowed&&n.a.createElement("h2",null,"You are following this artist.."),this.getSongsDivs(this.state.likedSongs,!0),this.getSongsDivs(this.state.notLikedSongs,!1))}}]),t}(n.a.Component),Te=Object(o.b)((function(e){return{songToPlay:e.songToPlay,chosenArtist:e.chosenArtist,chosenArtistLoading:e.chosenArtistLoading,chosenArtistError:e.chosenArtistError,chosenArtistData:e.chosenArtistData,spotifyApiObject:e.spotifyWebApiObject,paused:e.paused}}),(function(e){return{setPause:function(t){return e(re(t))},setSongToPlay:function(t){return e(function(e){return{type:"SET_SONG_TO_PLAY",payload:e,reducer:Object(L.a)((function(t){t.songToPlay&&t.songToPlay.id===e.id||(t.songToPlay=e,t.paused=!1)}))}}(t))}}}))(Me);function Pe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function Ie(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Pe(r,!0).forEach((function(t){Object(fe.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Pe(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Re=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(S.a)(this,Object(O.a)(t).call(this,e))).onClick=function(){r.props.closeChosenClusterGraph(),r.props.closeChosenArtist()},r.state={elements:r.getChosenClusterGraphElements(r.props.chosenCluster)},r}return Object(j.a)(t,e),Object(E.a)(t,[{key:"getChosenClusterGraphElements",value:function(e){for(var t=[],r=[],s=0;s<e.artistsIds.length;s++){var n=e.artistsIds[s],i=e.artistsPositions[n];t.push({artist:this.props.artistDict[n],position:{x:i.x,y:i.y}})}for(var a=0;a<this.props.artistEdges.length;a++){var o=this.props.artistEdges[a].id1,c=this.props.artistEdges[a].id2;e.artistsIds.includes(o)&&e.artistsIds.includes(c)&&r.push({id:o+c,id1:o,id2:c,weigth:this.props.artistEdges[a].weight})}return{nodes:t,edges:r}}},{key:"getSimilarClusters",value:function(){for(var e=this,t=this.props.chosenCluster.id,r=[],n=0;n<this.props.clusterEdges.length;n++){var i=this.props.clusterEdges[n];i.id2===i.id1||i.id1!==t&&i.id2!==t||r.push(i)}r.sort((function(e,t){return e.weight>t.weight?-1:1}));for(var a=[],o={width:"".concat(60,"px"),height:"".concat(60,"px"),backgroundSize:"".concat(60,"px ").concat(60,"px")},c=0;c<r.length;c++){var l=r[c];l.weight>2&&function(){for(var r=t===l.id1?l.id2:l.id1,n=e.props.clusters[e.props.clusters.map((function(e){return e.id})).indexOf(r)],i=[],c=0;c<Math.min(n.artistsIds.length,3);c++){var u=n.artistsIds[c],p=e.props.artistDict[u],h=Ie({},o,{backgroundImage:"url(".concat(p.image,")")});i.push(s.createElement("div",{className:"artistWrapper"},s.createElement("div",{title:p.name,style:h,className:"artistDiv"})))}a.push(s.createElement("div",{className:"similar-cluster-div padding-margin pointer",onClick:function(){e.props.closeChosenArtist(),e.props.setChosenCluster(n),e.setState({elements:e.getChosenClusterGraphElements(n)})}},s.createElement("p",null,"Similar to: ",n.genres[0]),s.createElement("div",{className:"artistsRow"},i)))}()}return a}},{key:"render",value:function(){var e=this.getSimilarClusters();return s.createElement("div",{className:"chosen-cluster-div"},s.createElement("div",{className:"chosen-cluster-column"},s.createElement("div",{className:"similar-cluster-row"},s.createElement("div",{className:"go-back-div padding-margin pointer",onClick:this.onClick},s.createElement(we.a,{size:50}),s.createElement("h3",{className:"h3-no-padding"},"Go back to the graph")),e),s.createElement("div",{className:"chosen-cluster-graph-div"},s.createElement(Ce,{graphElements:this.state.elements}))),s.createElement(Te,null))}}]),t}(s.Component),We=Object(o.b)((function(e){return{artistEdges:e.graph.artistEdges,clusters:e.graph.clusters,clusterEdges:e.graph.clusterEdges,artistDict:e.graph.artistDict}}),{closeChosenClusterGraph:function(){return{type:"CLOSE_CHOSEN_CLUSTER_GRAPH",reducer:Object(L.a)((function(e){e.chosenCluster=void 0}))}},closeChosenArtist:function(){return{type:"CLOSE_CHOSEN_ARTIST",reducer:Object(L.a)((function(e){e.chosenArtist=void 0}))}},setChosenCluster:Q})(Re),ze=r(54);function Ue(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function Ge(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ue(r,!0).forEach((function(t){Object(fe.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ue(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var He=r(73);He.registerLocale(r(76));var _e=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(S.a)(this,Object(O.a)(t).call(this,e))).state={positionX:e.positionX,positionY:e.positionY,dragging:!1,fontSizeDefault:12},r.onDrag=r.onDrag.bind(Object(oe.a)(r)),r.onStop=r.onStop.bind(Object(oe.a)(r)),r}return Object(j.a)(t,e),Object(E.a)(t,[{key:"componentDidUpdate",value:function(e,t){e.positionX!==this.props.positionX&&this.setState({positionX:this.props.positionX})}},{key:"onDrag",value:function(e,t){e.stopPropagation(),e.preventDefault();var r=this.state.positionX,s=this.state.positionY,n=r+t.deltaX,i=s+t.deltaY;this.setState({dragging:!0,positionX:n,positionY:i}),this.props.positionChanged(n,i,this.props.cluster.id)}},{key:"onStop",value:function(e){e.stopPropagation(),e.preventDefault();var t=this.state.dragging;this.setState({dragging:!1}),t||this.handleClick(e)}},{key:"handleClick",value:function(e){this.props.setChosenCluster(this.props.cluster)}},{key:"createArtistWrapper",value:function(e,t,r){return n.a.createElement("div",{key:r,className:"artistWrapper"},n.a.createElement("div",{className:"colourWrapper"},n.a.createElement("div",{title:e,style:t,className:"artistDiv"})))}},{key:"createEmptyWrapper",value:function(e){return n.a.createElement("div",{key:e,className:"artistWrapper"},n.a.createElement("div",null))}},{key:"clusterDiv",value:function(){for(var e=this.props.clusterWidth/4.6,t={width:"".concat(e,"px"),height:"".concat(e,"px"),backgroundSize:"".concat(e,"px ").concat(e,"px")},r=[],s=this.props.cluster.artistsIds.length,i=0,a=[],o=0;o<Math.min(s,4);o++){var c=this.props.artistDict[this.props.cluster.artistsIds[o]],l=Ge({},t,{backgroundImage:"url(".concat(c.image,")")});a.push(this.createArtistWrapper(c.name,l,i++))}if(r.push(n.a.createElement("div",{key:1,className:"artistsRow"},a)),a=[],s>4){a.push(this.createEmptyWrapper(i++)),a.push(this.createEmptyWrapper(i++));for(var u=4;u<Math.min(6,s);u++){var p=this.props.artistDict[this.props.cluster.artistsIds[u]],h=Ge({},t,{backgroundImage:"url(".concat(p.image,")")});a.push(this.createArtistWrapper(p.name,h,i++))}if(s>6){var d=Ge({},t,{backgroundImage:"url(".concat("/spotifygraph/three-dots.png",")")});a.push(this.createArtistWrapper("AND OTHERS",d,i++))}a.push(this.createEmptyWrapper(i++)),a.push(this.createEmptyWrapper(i++)),r.push(n.a.createElement("div",{key:2,className:"artistsRow"},a))}var g="",f=this.props.cluster.genres.length;if(0===f)g="...unknown genre...";else for(var m=0;m<Math.min(f,this.props.fontSizeConst+1);m++)g+=0===m?this.props.cluster.genres[m]:", "+this.props.cluster.genres[m];var v={width:"".concat(this.props.clusterWidth,"px")};return n.a.createElement("div",{className:"nodeWrapper",style:v},this.props.cluster.country&&n.a.createElement("div",{style:{position:"absolute",margin:0,left:0,opacity:.4,zIndex:-1,alignItems:"center"}},n.a.createElement(ze.a,{countryCode:He.alpha3ToAlpha2(this.props.cluster.country),svg:!0,style:{width:this.props.clusterWidth+30,height:"260px"}})),n.a.createElement("div",{className:"nodeHeader"},n.a.createElement("div",{className:"header noselect",style:{fontSize:this.state.fontSizeDefault/this.props.fontSizeConst+this.props.fontSizeConst}},g)),r)}},{key:"render",value:function(){var e=this.clusterDiv();return n.a.createElement(be.a,{onDrag:this.onDrag,onStop:this.onStop,onStart:function(e){e.stopPropagation(),e.preventDefault()},bounds:"parent",defaultPosition:{x:this.props.positionX,y:this.props.positionY},position:{x:this.state.positionX,y:this.state.positionY}},e)}}]),t}(n.a.Component),Fe=Object(o.b)((function(e){return{chosenCluster:e.chosenCluster,artistDict:e.graph.artistDict}}),{setChosenCluster:Q})(_e),Ye=function(e){function t(){return Object(b.a)(this,t),Object(S.a)(this,Object(O.a)(t).apply(this,arguments))}return Object(j.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props.weigth,t=me(this.props.x1,this.props.y1,this.props.x2,this.props.y2,e),r=t.x1fin,s=t.y1fin,i=t.x2fin,a=t.y2fin,o=t.top,c=t.left,l=t.hei,u=t.wid,p={top:o+30,left:c+this.props.clusterWidth/2};return n.a.createElement("svg",{style:p,className:"position-absolute",width:u+e+20,height:l+e+20},n.a.createElement("path",{d:"M ".concat(r,",").concat(s," \n                        C ").concat(r+20,",").concat(s+20," ").concat(i+20,",").concat(a+20," ").concat(i,",").concat(a),strokeWidth:e,fill:"none",stroke:"black"}))}}]),t}(n.a.Component),Ve=(r(46),function(e){function t(e){return Object(b.a)(this,t),Object(S.a)(this,Object(O.a)(t).call(this,e))}return Object(j.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){return n.a.createElement("div",{className:"progressbar"},n.a.createElement("div",{className:"progress",style:{width:"".concat(100*this.props.progress,"%")}}))}}]),t}(n.a.Component)),Xe=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(S.a)(this,Object(O.a)(t).call(this,e))).boxRef=void 0,r.wrapperRef=void 0,r.state={clusterWidth:150,clusterHeight:150,currentScale:1,originalRefHeight:0,originalRefWidth:0},r.wrapperRef=n.a.createRef(),r.boxRef=n.a.createRef(),r.positionChangedHandler=r.positionChangedHandler.bind(Object(oe.a)(r)),r}return Object(j.a)(t,e),Object(E.a)(t,[{key:"getClusterPositions",value:function(e,t){var r=this.state.clusterWidth,s=this.state.clusterHeight,n=t;console.debug(this.props.graph.clusters.length),this.props.graph.clusters.length<15?n-=s+20:this.props.graph.clusters.length>30&&(n+=s);var i=ue(e,n,r,s,this.props.graph.clusterSquares),a=pe(i,s);return(this.state.dimensions?this.state.dimensions:{w:500,h:1e3}).h=a,i}},{key:"positionChangedHandler",value:function(e,t,r){if(null==this.state.clusterPositions)return[];var s=this.state.clusterPositions;s[r]={x:e,y:t},this.setState({clusterPositions:s})}},{key:"createNodes",value:function(){if(null===this.state.clusterPositions||Object(N.isUndefined)(this.state.clusterPositions))return[];for(var e=[],t=0;t<this.props.graph.clusters.length;t++){var r=this.props.graph.clusters[t];e.push(n.a.createElement(Fe,{key:r.id,fontSizeConst:this.state.currentScale,cluster:r,positionX:this.state.clusterPositions[r.id].x,positionY:this.state.clusterPositions[r.id].y,positionChanged:this.positionChangedHandler,clusterWidth:this.state.clusterWidth}))}return e}},{key:"createEdges",value:function(){var e=[];if(null==this.state.clusterPositions)return[];for(var t=0;t<this.props.graph.clusterEdges.length;t++){var r=this.props.graph.clusterEdges[t].id1,s=this.props.graph.clusterEdges[t].id2,i=r+s;if(r!==s){var a=3*Math.log2(this.props.graph.clusterEdges[t].weight);e.push(n.a.createElement(Ye,{key:i,x1:this.state.clusterPositions[r].x,y1:this.state.clusterPositions[r].y,x2:this.state.clusterPositions[s].x,y2:this.state.clusterPositions[s].y,weigth:a,clusterWidth:this.state.clusterWidth}))}}return e}},{key:"graphLoadedCallback",value:function(e,t){var r=this.getClusterPositions(e,t);this.setState({clusterPositions:r})}},{key:"onResizeRecomputePositions",value:function(){if(!Object(N.isUndefined)(this.state.dimensions)&&!Object(N.isUndefined)(this.state.clusterPositions)){var e=this.state.dimensions.w,t=this.state.dimensions.h,r=this.wrapperRef.current.clientWidth;if(e!==r){var s=this.state.clusterPositions,n=Math.floor(r/e*1024)/1024;for(var i in s)s[i].x=n*s[i].x;this.setState({dimensions:{w:r,h:t},clusterPositions:s})}}}},{key:"componentDidMount",value:function(){var e=this;window.addEventListener("resize",(function(){e.onResizeRecomputePositions()}));var t=this.wrapperRef.current.clientWidth,r=this.wrapperRef.current.clientHeight;this.setState({dimensions:{w:t,h:r},originalRefWidth:t,originalRefHeight:r},(function(){return e.props.loadGraph(e.props.accessToken,e.props.sp,(function(){return e.graphLoadedCallback(t,r)}))}))}},{key:"componentDidUpdate",value:function(e,t){if(this.props.isGraphFromFileLoaded){var r=500,s=500;Object(N.isUndefined)(this.state.dimensions)||(r=this.state.dimensions.w,s=this.state.dimensions.h),s=this.state.originalRefHeight,this.graphLoadedCallback(r,s),this.props.graphFromFileIsLoaded(!1)}}},{key:"render",value:function(){var e=this;if(this.props.graphLoading)return n.a.createElement("div",{className:"page-wrapper"},n.a.createElement("div",{className:"generic-description"},this.props.graphLoadingMessage),n.a.createElement(Ve,{progress:this.props.graphLoadingRelatedArtistsProgress}));if(this.props.spotifyError)return n.a.createElement("div",null,"Error while loading");var t=void 0!==this.props.chosenCluster,r="";t&&(r="none");var s=this.state.dimensions?this.state.dimensions.w:500,i=this.state.dimensions?this.state.dimensions.h:500;return n.a.createElement("div",{className:"wrapper",ref:this.wrapperRef},n.a.createElement(ce.b,{defaultScale:1,defaultPositionX:1,defaultPositionY:1,options:{maxScale:4,limitToWrapper:!0},onWheelStop:function(t){e.setState({currentScale:t.scale})}},(function(a){a.zoomIn,a.zoomOut,a.setTransform,Object(ae.a)(a,["zoomIn","zoomOut","setTransform"]);return n.a.createElement(n.a.Fragment,null,t&&n.a.createElement(We,{key:e.props.chosenCluster.id,chosenCluster:e.props.chosenCluster}),n.a.createElement(ce.a,null,n.a.createElement("div",{className:"box",ref:e.boxRef,style:{width:s,height:i,display:r}},e.state.dimensions&&e.createEdges(),e.state.dimensions&&e.createNodes())))})))}}]),t}(n.a.Component),Qe=Object(o.b)((function(e){return{graphLoaded:e.graphLoaded,graphLoading:e.graphLoading,spotifyError:e.isGraphLoadingError,graphLoadingMessage:e.graphLoadingMessage,graphLoadingRelatedArtistsProgress:e.graphLoadingRelatedArtistsProgress,graph:e.graph,chosenCluster:e.chosenCluster,accessToken:e.accessToken,sp:e.spotifyWebApiObject,isGraphFromFileLoaded:e.isGraphFromFileLoaded}}),(function(e){return{setGraph:B,graphFromFileIsLoaded:function(t){return e(se(t))},loadGraph:function(t,r,s){return e(function(e,t,r){return function(){var s=Object(C.a)(x.a.mark((function s(n){return x.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:n(J()),V(e,t,(function(){}),(function(e){n(q(e))}),(function(e){n(Z(e))})).then((function(e){return n(B(e))})).then((function(){return r()})).then((function(){return n(K())})).catch((function(e){console.debug(e),n({type:"GRAPH_LOADING_ERROR",reducer:Object(L.a)((function(e){e.graphLoading=!1,e.isGraphLoadingError=!0}))})}));case 2:case"end":return s.stop()}}),s)})));return function(e){return s.apply(this,arguments)}}()}(t,r,s))}}}))(Xe),Be=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(S.a)(this,Object(O.a)(t).call(this,e))).playerRef=void 0,r.playerRef=n.a.createRef(),r}return Object(j.a)(t,e),Object(E.a)(t,[{key:"componentDidUpdate",value:function(){null!==this.playerRef.current&&(this.props.paused?this.playerRef.current.pause():this.playerRef.current.play())}},{key:"render",value:function(){var e=this;if(Object(N.isUndefined)(this.props.accessToken))return n.a.createElement("div",null);if(Object(N.isUndefined)(this.props.songToPlay))return n.a.createElement("div",{className:"empty-player"},n.a.createElement("div",{className:"generic-description-small-margin"},"Choose some artist and some song and listen to a preview"));for(var t,r=[],s=0;s<this.props.songToPlay.artistsIds.length;s++){var i=this.props.songToPlay.artistsIds[s];i in this.props.favouriteArtistDict?r.push(this.props.favouriteArtistDict[i].name):i in this.props.nonFavouriteArtistDict?r.push(this.props.nonFavouriteArtistDict[i].name):r.push(i)}var a=r.join(", ");return t=this.props.songToPlay.previewLink,n.a.createElement("div",{className:"player"},n.a.createElement("div",{className:"flex1"},n.a.createElement("p",{className:"playingSongName"},n.a.createElement("b",null,this.props.songToPlay.name)),n.a.createElement("p",{className:"playingSongArtists"},a)),n.a.createElement("audio",{onPlay:function(){return e.props.setPaused(!1)},onPause:function(){return e.props.setPaused(!0)},ref:this.playerRef,autoPlay:!0,controls:!0,src:t,className:"playerControls"},"Your browser does not support the",n.a.createElement("code",null,"audio")," element."))}}]),t}(n.a.Component),Je=Object(o.b)((function(e){return{paused:e.paused,accessToken:e.accessToken,songToPlay:e.songToPlay,favouriteArtistDict:e.graph.artistDict,nonFavouriteArtistDict:e.nonFavouriteArtistDict}}),{setPaused:re})(Be),qe=function(e){function t(){return Object(b.a)(this,t),Object(S.a)(this,Object(O.a)(t).apply(this,arguments))}return Object(j.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){return s.createElement("div",{className:"mainDiv"},s.createElement("div",{className:"mainDivContent"},s.createElement(Qe,null)),s.createElement(Je,null))}}]),t}(s.Component),Ze=(r(77),function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(S.a)(this,Object(O.a)(t).call(this,e))).dowloadGraph=r.dowloadGraph.bind(Object(oe.a)(r)),r.uploadGraph=r.uploadGraph.bind(Object(oe.a)(r)),r}return Object(j.a)(t,e),Object(E.a)(t,[{key:"chosenClusterArtists",value:function(){var e=this,t=[];return void 0!==this.props.chosenCluster&&(t=this.props.chosenCluster.artistsIds.map((function(t){return s.createElement("li",{className:"shift-left"},e.props.artistDict[t].name)}))),s.createElement("ul",null,t)}},{key:"chosenClusterProperties",value:function(){var e=[];return void 0!==this.props.chosenCluster&&(e=this.props.chosenCluster.genres.map((function(e){return s.createElement("li",{className:"shift-left"},e)}))),s.createElement("ul",null,e)}},{key:"dowloadGraph",value:function(){if(this.props.graph){var e=document.createElement("a");e.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(JSON.stringify(this.props.graph,null,4))),e.setAttribute("download","mySpotifyGraph.json"),e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e)}}},{key:"uploadGraph",value:function(e){var t=this;console.log(e);var r=e[0],s=new FileReader;s.onload=function(e){if(null!==e.target&&null!==e.target.result){var r=e.target.result.toString(),s=Object(N.isUndefined)(r)?{}:JSON.parse(r);try{!function(e){t.props.loadGraphFromFile(e)}(s)}catch(n){alert("Sorry, this file seems to be not in the correct format"+n),console.debug("error while graph loading from file:",n)}}else alert("Sorry, this file seems to be not in the correct format")},s.readAsText(r)}},{key:"render",value:function(){var e=this;return s.createElement("div",{className:"sideBar"},s.createElement("div",{className:"sideBarHeader"},s.createElement("img",{width:40,height:40,className:"spotify-image",alt:"",src:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiPjxwYXRoIGQ9Ik0xOS4wOTggMTAuNjM4Yy0zLjg2OC0yLjI5Ny0xMC4yNDgtMi41MDgtMTMuOTQxLTEuMzg3LS41OTMuMTgtMS4yMi0uMTU1LTEuMzk5LS43NDgtLjE4LS41OTMuMTU0LTEuMjIuNzQ4LTEuNCA0LjIzOS0xLjI4NyAxMS4yODUtMS4wMzggMTUuNzM4IDEuNjA1LjUzMy4zMTcuNzA4IDEuMDA1LjM5MiAxLjUzOC0uMzE2LjUzMy0xLjAwNS43MDktMS41MzguMzkyem0tLjEyNiAzLjQwM2MtLjI3Mi40NC0uODQ3LjU3OC0xLjI4Ny4zMDgtMy4yMjUtMS45ODItOC4xNDItMi41NTctMTEuOTU4LTEuMzk5LS40OTQuMTUtMS4wMTctLjEyOS0xLjE2Ny0uNjIzLS4xNDktLjQ5NS4xMy0xLjAxNi42MjQtMS4xNjcgNC4zNTgtMS4zMjIgOS43NzYtLjY4MiAxMy40OCAxLjU5NS40NC4yNy41NzguODQ3LjMwOCAxLjI4NnptLTEuNDY5IDMuMjY3Yy0uMjE1LjM1NC0uNjc2LjQ2NS0xLjAyOC4yNDktMi44MTgtMS43MjItNi4zNjUtMi4xMTEtMTAuNTQyLTEuMTU3LS40MDIuMDkyLS44MDMtLjE2LS44OTUtLjU2Mi0uMDkyLS40MDMuMTU5LS44MDQuNTYyLS44OTYgNC41NzEtMS4wNDUgOC40OTItLjU5NSAxMS42NTUgMS4zMzguMzUzLjIxNS40NjQuNjc2LjI0OCAxLjAyOHptLTUuNTAzLTE3LjMwOGMtNi42MjcgMC0xMiA1LjM3My0xMiAxMiAwIDYuNjI4IDUuMzczIDEyIDEyIDEyIDYuNjI4IDAgMTItNS4zNzIgMTItMTIgMC02LjYyNy01LjM3Mi0xMi0xMi0xMnoiLz48L3N2Zz4="}),s.createElement("h1",null,"Spotify graph")),s.createElement("div",null," Graph of your musical taste \u266c\u266b "),s.createElement("div",{className:"download-button pointer",onClick:this.dowloadGraph},"Download graph to JSON"),s.createElement("input",{className:"download-button",type:"file",onChange:function(t){null!==t.target.files&&e.uploadGraph(t.target.files)}}),s.createElement("div",{className:"sideBarContent"},this.props.chosenCluster&&s.createElement("div",{className:"box-with-margin"},s.createElement("h2",null,"mostly these genres"),this.chosenClusterProperties()),this.props.chosenCluster&&s.createElement("div",{className:"box-with-margin"},s.createElement("h2",{className:"text-align-center"},"group of artists"),this.chosenClusterArtists()),!this.props.chosenCluster&&this.props.graph&&s.createElement("div",{className:"box-with-margin"},s.createElement("p",null,"We took the artists from your ",s.createElement("b",null,"liked")," songs and the artists that ",s.createElement("b",null,"you follow"),"."),s.createElement("p",null,"We found ",s.createElement("b",null,Object.values(this.props.graph.artistDict).length," artist")," that you like."),s.createElement("p",null,"We divided them into clusters you're seing right now. The clusters are based on ",s.createElement("b",null,"genres")," and ",s.createElement("b",null,"preferences")," of other users of Spotify"),s.createElement("p",null,"Click the cluster and explore how the artists are connected."))))}}]),t}(s.Component)),Ke=Object(o.b)((function(e){return{chosenCluster:e.chosenCluster,chosenArtist:e.chosenArtist,graph:e.graph,sp:e.spotifyWebApiObject,artistDict:e.graph.artistDict}}),{loadGraphFromFile:function(e){return function(){var t=Object(C.a)(x.a.mark((function t(r){var s,n;return x.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(s=0;s<e.clusters.length;s++)n=e.clusters[s],(Object(N.isUndefined)(n.artistsIds)||0===n.artistsIds.length)&&(n.artistsIds=Object.keys(n.artistsPositions));return t.next=3,Promise.resolve(r({type:"CLEAR_CHOSEN_CLUSTER_ARTIST",reducer:Object(L.a)((function(e){e.chosenCluster=void 0,e.chosenArtist=void 0}))})).then((function(){return r(J())})).then((function(){return r(B(e))})).then((function(){return r(se(!0))})).then((function(){return r(K())}));case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}})(Ze),$e=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(S.a)(this,Object(O.a)(t).call(this,e))).state={loggingLoading:!0,loggingFailed:!1},r.afterSpotifyLogin(),r}return Object(j.a)(t,e),Object(E.a)(t,[{key:"afterSpotifyLogin",value:function(){var e=this,t=window.location.search.substr(1),r={};if(t.split("&").forEach((function(e){var t=e.split("=");r[t[0]]=decodeURIComponent(t[1])})),"code"in r&&""!==r.code&&null!==r.code){var s=this.props.history.location.pathname;this.props.history.push({pathname:s,search:""});var n="https://spotify-graph-gajdusek.herokuapp.com/graphapp/logged_in/?code="+r.code,i="";fetch(n).then((function(t){if(200!==t.status)throw t.status;var r=t.headers.get("access-token");null!==r&&(i=r,e.props.setAccessToken(i)),e.setState({loggingLoading:!1})})).catch((function(t){console.debug(t),e.setState({loggingFailed:!0,loggingLoading:!1}),alert("Sorry, we did not manage to log you in Spotify.")}))}else this.state={loggingFailed:!0,loggingLoading:!1}}},{key:"render",value:function(){return this.state.loggingLoading?n.a.createElement("div",{className:"App"},n.a.createElement("div",{className:"page-wrapper"},n.a.createElement("div",{className:"loader"}),n.a.createElement("div",{className:"generic-description"},"Logging into Spotify"))):this.state.loggingFailed?n.a.createElement(y.a,{to:"/login"}):n.a.createElement("div",{className:"App"},n.a.createElement(Ke,null),n.a.createElement(qe,null))}}]),t}(n.a.Component),et=Object(y.g)(Object(o.b)((function(e){return{loggedIn:e.userLoggedIn}}),(function(e){return{setAccessToken:function(t){return e(function(e){return{type:"SET_ACCESS_TOKEN",payload:e,reducer:Object(L.a)((function(t){t.accessToken=e,t.userLoggedIn=!0}))}}(t))}}}))($e)),tt=Object(c.d)(m,f(),Object(c.c)(c.a.apply(void 0,d))),rt=function(){return n.a.createElement(o.a,{store:tt},n.a.createElement(v.a,{basename:"/spotifygraph"},n.a.createElement(y.d,null,n.a.createElement(y.b,{path:"/login",component:ie}),n.a.createElement(y.b,{path:"/mygraph",component:et}),n.a.createElement(y.b,{path:"/",component:w}))))};a.a.render(n.a.createElement(rt,null),document.getElementById("root"))}},[[55,1,2]]]);
//# sourceMappingURL=main.461e661e.chunk.js.map